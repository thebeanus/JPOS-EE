<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>jPOS Extended Edition</title><link rel="stylesheet" type="text/css" href="css/manual.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div lang="en" class="book"><div class="titlepage"><div><div><h1 class="title"><a name="d0e3"></a>jPOS Extended Edition</h1></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Alejandro</span> <span class="surname">Revilla</span></h3><div class="affiliation"><span class="orgname">jPOS Consulting<br></span></div></div><div class="author"><h3 class="author"><span class="firstname">Victor</span> <span class="surname">Salaman</span></h3><div class="affiliation"><span class="orgname">VMAN Technologies, Inc.<br></span></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">jPOS</span> <span class="othername">Software</span> <span class="surname">SRL</span></h3><code class="email">&lt;<a class="email" href="mailto:support@jpos.org">support@jpos.org</a>&gt;</code></div></div><div><p class="releaseinfo">jPOS-EE 2.2.7-SNAPSHOT</p></div><div><p class="copyright">Copyright &copy; 2000-2015 Alejandro P. Revilla d/b/a jPOS.org</p></div><div><div class="legalnotice"><a name="d0e59"></a><p>
All rights reserved. No part of this document may be reproduced in
any form or by any electronic or mechanical means, including
information storage and retrieval systems, without permission in
writing from Alejandro P. Revilla, company number\# 212 752 380
016, Uruguay, except by a reviewer who may quote brief passages in
a review.
</p></div></div><div><p class="pubdate">2015</p></div><div><div class="revhistory"><table style="border-style:solid; width:100%;" summary="Revision History"><tr><th align="left" valign="top" colspan="3"><b>Revision History</b></th></tr><tr><td align="left">Revision 2.2.9-SNAPSHOT</td><td align="left">2022-09-10</td><td align="left">jSS</td></tr></table></div></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="part"><a href="#_introduction">I. Introduction</a></span></dt><dd><dl><dt><span class="chapter"><a href="#_project_overview">1. Project Overview</a></span></dt><dd><dl><dt><span class="section"><a href="#_background">1.1. Background</a></span></dt><dt><span class="section"><a href="#_about_this_document">1.2. About this document</a></span></dt><dt><span class="section"><a href="#_objectives">1.3. Objectives</a></span></dt><dt><span class="section"><a href="#_copyright_and_license">1.4. Copyright and License</a></span></dt><dt><span class="section"><a href="#_getting_involved">1.5. Getting involved</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_contributing_to_the_project">2. Contributing to the project</a></span></dt><dd><dl><dt><span class="section"><a href="#_github_workflow">2.1. GitHub Workflow</a></span></dt><dd><dl><dt><span class="section"><a href="#_quickfire_dos_and_donts">2.1.1. Quickfire Do&#8217;s and Don&#8217;t&#8217;s</a></span></dt><dt><span class="section"><a href="#_step_by_step_the_short_version">2.1.2. Step-by-step (the short version)</a></span></dt><dt><span class="section"><a href="#_commit_messages">2.1.3. Commit messages</a></span></dt></dl></dd><dt><span class="section"><a href="#_coding_conventions">2.2. Coding conventions</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_getting_started">3. Getting Started</a></span></dt><dd><dl><dt><span class="section"><a href="#_prerequisites">3.1. Prerequisites</a></span></dt><dt><span class="section"><a href="#_using_an_ide">3.2. Using an IDE</a></span></dt><dt><span class="section"><a href="#_using_an_application_server">3.3. Using an application server</a></span></dt><dt><span class="section"><a href="#_preparing_your_environment">3.4. Preparing your environment</a></span></dt><dt><span class="section"><a href="#_maven_coordinates">3.5. Maven coordinates</a></span></dt><dt><span class="section"><a href="#_downloading_the_sources">3.6. Downloading the sources</a></span></dt><dt><span class="section"><a href="#_installing_the_sdk">3.7. Installing the SDK</a></span></dt><dt><span class="section"><a href="#_five_minute_tutorial">3.8. Five minute tutorial</a></span></dt><dd><dl><dt><span class="section"><a href="#_initial_setup_jpos_project">3.8.1. Initial setup, jPOS project</a></span></dt><dt><span class="section"><a href="#_adding_a_jpos_ee_module">3.8.2. Adding a jPOS-EE Module</a></span></dt><dt><span class="section"><a href="#_pulling_configuration_from_modules">3.8.3. Pulling configuration from modules</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="part"><a href="#_modules">II. Modules</a></span></dt><dd><dl><dt><span class="chapter"><a href="#_introduction_to_modules">4. Introduction to modules</a></span></dt><dd><dl><dt><span class="section"><a href="#_how_do_modules_work">4.1. How do modules work?</a></span></dt><dd><dl><dt><span class="section"><a href="#_hibernate_mappings">4.1.1. Hibernate Mappings</a></span></dt><dt><span class="section"><a href="#_installables">4.1.2. Installables</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#_core_modules">5. Core Modules</a></span></dt><dd><dl><dt><span class="section"><a href="#_core">5.1. CORE</a></span></dt><dt><span class="section"><a href="#_transaction_support">5.2. Transaction Support</a></span></dt><dt><span class="section"><a href="#_txnid">5.3. TxnId</a></span></dt><dt><span class="section"><a href="#QI">5.4. QI Basics</a></span></dt><dd><dl><dt><span class="section"><a href="#_main_xml">5.4.1. Main XML</a></span></dt><dd><dl><dt><span class="section"><a href="#_title">Title</a></span></dt><dt><span class="section"><a href="#_locale">Locale</a></span></dt><dt><span class="section"><a href="#_messages">Messages</a></span></dt><dt><span class="section"><a href="#_menubar">Menubar</a></span></dt><dt><span class="section"><a href="#_sidebar">Sidebar</a></span></dt><dt><span class="section"><a href="#_view">View</a></span></dt></dl></dd><dt><span class="section"><a href="#_qi_permissions">5.4.2. QI Permissions</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#_database_support">6. Database Support</a></span></dt><dd><dl><dt><span class="section"><a href="#_db_support_configuration">6.1. DB Support configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#_accessing_a_secondaryslave_database">6.1.1. Accessing a secondary/slave database</a></span></dt></dl></dd><dt><span class="section"><a href="#_mysql_support">6.2. MySQL &reg; Support</a></span></dt><dt><span class="section"><a href="#_postgresql_support">6.3. PostgreSQL &reg; support</a></span></dt><dt><span class="section"><a href="#_h2_embedded_database_support">6.4. H2 Embedded Database support</a></span></dt><dt><span class="section"><a href="#_mssql_database_support">6.5. MSSQL Database support</a></span></dt><dt><span class="section"><a href="#_flyway_support">6.6. FlyWay Support</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_binary_log">7. Binary Log</a></span></dt><dd><dl><dt><span class="section"><a href="#_binlog">7.1. BinLog</a></span></dt><dd><dl><dt><span class="section"><a href="#_implementation_notes">7.1.1. Implementation notes</a></span></dt><dt><span class="section"><a href="#_supporting_cli_commands">7.1.2. Supporting CLI commands</a></span></dt><dt><span class="section"><a href="#_binlog_quartz_support">7.1.3. BinLog Quartz Support</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#_rest_support">8. Rest Support</a></span></dt><dd><dl><dt><span class="section"><a href="#_qrest">8.1. QRest</a></span></dt><dd><dl><dt><span class="section"><a href="#_static_and_dynamic_html_content">8.1.1. Static and Dynamic HTML content</a></span></dt></dl></dd><dt><span class="section"><a href="#_httpclient">8.2. HttpClient</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_tools">9. Tools</a></span></dt><dd><dl><dt><span class="section"><a href="#_freemarker_decorator">9.1. Freemarker Decorator</a></span></dt><dd><dl><dt><span class="section"><a href="#_activation_steps">9.1.1. Activation steps</a></span></dt><dt><span class="section"><a href="#_introduction_2">9.1.2. Introduction</a></span></dt></dl></dd><dt><span class="section"><a href="#_groovy_support">9.2. Groovy Support</a></span></dt><dd><dl><dt><span class="section"><a href="#_groovy_qbean">9.2.1. Groovy QBean</a></span></dt><dt><span class="section"><a href="#_groovyparticipant">9.2.2. GroovyParticipant</a></span></dt><dt><span class="section"><a href="#_groovyrequestlistener">9.2.3. GroovyRequestListener</a></span></dt><dd><dl><dt><span class="section"><a href="#_examples">Examples:</a></span></dt></dl></dd><dt><span class="section"><a href="#_groovygroupselector">9.2.4. GroovyGroupSelector</a></span></dt><dd><dl><dt><span class="section"><a href="#_examples_2">Examples:</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#cryptoservice">9.3. Crypto Service</a></span></dt><dd><dl><dt><span class="section"><a href="#_using_gnupg_to_generate_keys">9.3.1. Using GnuPG to generate keys</a></span></dt></dl></dd><dt><span class="section"><a href="#_crypto_server">9.4. Crypto Server</a></span></dt><dd><dl><dt><span class="section"><a href="#_encrypt">9.4.1. encrypt</a></span></dt><dt><span class="section"><a href="#_decrypt">9.4.2. decrypt</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#_simulators">10. Simulators</a></span></dt><dd><dl><dt><span class="section"><a href="#_server_simulator">10.1. Server Simulator</a></span></dt><dt><span class="section"><a href="#_client_simulator">10.2. Client Simulator</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_operation_services">11. Operation services</a></span></dt><dd><dl><dt><span class="section"><a href="#_sshd">11.1. SSHD</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_contributed_modules">12. Contributed modules</a></span></dt><dd><dl><dt><span class="section"><a href="#_fsdmsgx">12.1. FSDMsgX</a></span></dt><dd><dl><dt><span class="section"><a href="#_introduction_to_using_the_packagers">12.1.1. Introduction to using the packagers</a></span></dt><dd><dl><dt><span class="section"><a href="#_fixedfieldpackager">FixedFieldPackager</a></span></dt><dt><span class="section"><a href="#_variablefieldpackager">VariableFieldPackager</a></span></dt><dt><span class="section"><a href="#_branchfieldpackager">BranchFieldPackager</a></span></dt></dl></dd></dl></dd></dl></dd></dl></dd><dt><span class="part"><a href="#_jpos_ee_entities">III. jPOS-EE Entities</a></span></dt><dd><dl><dt><span class="chapter"><a href="#sysconfig">13. SysConfig</a></span></dt><dt><span class="chapter"><a href="#_syslog">14. SysLog</a></span></dt><dt><span class="chapter"><a href="#_eeuser_module">15. EEUser module</a></span></dt><dd><dl><dt><span class="section"><a href="#_visitor">15.1. Visitor</a></span></dt><dt><span class="section"><a href="#_user">15.2. User</a></span></dt><dt><span class="section"><a href="#_roles_and_permissions">15.3. Roles and Permissions</a></span></dt><dt><span class="section"><a href="#_roles_realm">15.4. Role&#8217;s realm</a></span></dt><dt><span class="section"><a href="#_consumer">15.5. Consumer</a></span></dt><dt><span class="section"><a href="#_password_history">15.6. Password History</a></span></dt><dt><span class="section"><a href="#_userconsumer_properties">15.7. User/Consumer properties</a></span></dt></dl></dd><dt><span class="chapter"><a href="#seqno">16. SeqNo</a></span></dt></dl></dd><dt><span class="part"><a href="#_appendices">IV. Appendices</a></span></dt><dd><dl><dt><span class="appendix"><a href="#appendix_copyright">A. Copyright</a></span></dt><dt><span class="appendix"><a href="#appendix_license">B. License</a></span></dt><dt><span class="appendix"><a href="#appendix_CLA">C. Contributor License Agreement</a></span></dt><dt><span class="appendix"><a href="#appendix_CCLA">D. Corporate CLA</a></span></dt></dl></dd></dl></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a name="_introduction"></a>Part&nbsp;I.&nbsp;Introduction</h1></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="_project_overview"></a>1.&nbsp;Project Overview</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_background"></a>1.1&nbsp;Background</h2></div></div></div><p>Back in the late nineties, our company was awarded the development of a
jPOS-based application for our local VISANet <a href="#ftn.d0e73" class="footnote" name="d0e73"><sup class="footnote">[1]</sup></a>
acquirer.</p><p>At that time, we thought that going for a J2EE solution was the way to
go. We went with the great Orion application server and we called the application
<span class="strong"><strong>jPOS-EE</strong></span>, it was kind of a jPOS "Enterprise" Edition.</p><p>But we soon got to hit some of the major problems of running an early
J2EE application in a demanding 7x24x365 environment, the deployment of
new versions was both stressful and costly in terms of time (a one
minute downtime can feel like a week when you are manning the telephones
 in a call center). So we designed a lightweight solution that we could
deploy and redeploy quickly, without obscure RMI-IIOP related issues
that could only be solved with an application server restart.</p><p>In addition, we started to see how O/R mapping tools such as Hibernate
offered greater sophistication than EJB 2.1 could offer, and EJB 3.0 was
not on the horizon yet.</p><p>So we decided to build our own tiny environment and began by building
<span class="strong"><strong>Q2</strong></span>, our JMX-based IoC micro kernel. <a href="#ftn.d0e93" class="footnote" name="d0e93"><sup class="footnote">[2]</sup></a></p><p>We consider jPOS-EE as a <span class="strong"><strong>Meta-Project</strong></span> where we encompass many other
compatible (from a technical as well as license perspective) Open Source
projects such as:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Hibernate</li><li class="listitem">Jetty</li><li class="listitem">Velocity</li><li class="listitem">XStream</li><li class="listitem">JDOM</li><li class="listitem">JDBM</li><li class="listitem">Apache Commons</li><li class="listitem">Etcetera</li></ul></div><p>In order to easily assemble different types of jPOS-EE applications
whilst fostering code reuse as much as possible, we have developed a
very simple, module-based jPOS-EE Software Development Kit (jPOS-EE
SDK), now replaced by Gradle <a href="#ftn.d0e128" class="footnote" name="d0e128"><sup class="footnote">[3]</sup></a>.</p><p>We kept the name jPOS-EE, but we replaced the first E from Enterprise to
Extended. This document describes the <span class="strong"><strong>jPOS Extended Edition</strong></span>.</p><p>We don&#8217;t claim that using the jPOS-EE framework and our choice of
supporting projects is the best way to write a jPOS application, people
could argue that JEE is the way to go, or Spring is the way to go, or
Pico/Nano container does better IoC, or that we should use
JBoss/Jeronimo, Guice, OSGI, QI4J, you name
it. In the same way, we choose to use Jetty but there&#8217;s people that may
say that Tomcat is the way to go.</p><p>jPOS-EE is just the way we at jPOS.org write our applications and we are
sharing this "technology" on an as-is basis. You can use it, or you can
write your jPOS application using whatever technology/framework you feel
more comfortable with.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_about_this_document"></a>1.2&nbsp;About this document</h2></div></div></div><p>This is the official jPOS-EE documentation that intends to
aggregate everything related to jPOS-EE, including but not limited to:
its objectives, specifications, schedule, priorities, organizational
chart, road map, change log, coding conventions, core modules, optional
modules, license information, etc.</p><p>It complements, but doesn&#8217;t replace the
<a class="link" href="http://jpos.org/products/proguide" target="_top">jPOS Programmer&#8217;s Guide</a>. It is not a
user guide nor a tutorial, it is a development master workbook, written
by developers for developers.</p><p>You&#8217;re currently reading revision 2.2.9-SNAPSHOT.</p><p>New versions of this document are regularly posted in
<a class="link" href="http://jpos.org/doc/jPOS-EE.pdf" target="_top">jpos.org/doc/jPOS-EE.pdf</a>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_objectives"></a>1.3&nbsp;Objectives</h2></div></div></div><p>Our main objective is to avoid repeating ourselves. <span class="strong"><strong>DRY</strong></span>
<a href="#ftn.d0e168" class="footnote" name="d0e168"><sup class="footnote">[4]</sup></a> is a good paradigm to keep in mind.</p><p>We at jPOS.org have a small company with very limited development
resources and a large number of customers. Most of our end user
applications are very specific, yet they share a large number of
features.</p><p>jPOS-EE is all about code reuse. We developed a very simple SDK based on
a pluggable module architecture that can be bundled together at compile
time to create&#8201;&#8212;&#8201;as fast as possible&#8201;&#8212;&#8201;highly reliable jPOS
applications.</p><p>The more we use jPOS-EE to create applications for our customers, the
more we tend to make these modules smaller, with as few
dependencies on each other as possible.</p><p>We expect developers using jPOS-EE to create their own modules based
upon our public ones, and to interact with the jPOS-EE community in
order to engage into the formal process of requesting changes to the jPOS-EE
codebase whenever it is deemed necessary.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/admon/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Local changes to the jPOS-EE code base may seem the easy way to solve a
given requirement, but it forces you to apply the same change over and
over as new jPOS-EE versions become available.</p><p>We encourage you to go the formal route and send us a pull request
that can be included in jPOS-EE, reviewed by other jPOS-EE developers,
tested in multiple platforms and disparate environments, properly
documented and maintained in future releases.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_copyright_and_license"></a>1.4&nbsp;Copyright and License</h2></div></div></div><p>jPOS-EE is copyrighted code licensed under the GNU Affero General Public
License version 3.</p><p>A copy of the copyright notice is available in every source file and can
be found in link <a class="xref" href="#appendix_copyright" title="Appendix&nbsp;A.&nbsp;Copyright">Appendix&nbsp;A, <i>Copyright</i></a>.</p><p>A copy of the GNU Affero General Public License version 3 is also
available in <a class="xref" href="#appendix_license" title="Appendix&nbsp;B.&nbsp;License">Appendix&nbsp;B, <i>License</i></a>.</p><p>We strongly recommend you to review our license terms before using jPOS
or jPOS-EE. You can find very useful information in the official Free
Software Foundation GPL FAQ page
(<a class="link" href="http://www.fsf.org/licensing/licenses/gpl-faq.html" target="_top">www.fsf.org/licensing/licenses/gpl-faq.html</a>).</p><p>The AGPL covers applications that runs over the network (SaaS) such as
most credit/debit card verification/authorization systems like those
deployed by most people using jPOS, meaning that you probably need a
commercial license.</p><p>If in doubt, you can contact us using
<a class="link" href="http://jpos.org/contact?p=EECL" target="_top">jpos.org/contact</a></p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_getting_involved"></a>1.5&nbsp;Getting involved</h2></div></div></div><p>jPOS-EE is a centralized open source project. jPOS.org retain full
control of the release cycle because the code placed in the jposee
repository is regularly checked out by our production customers.</p><p>Whilst we have experimental modules, and a sandbox/incoming area where
we can put alpha and even PoC code, there are fundamental modules that
we use over and over at production sites. These modules may have been
audited or even certified by third parties and we can&#8217;t afford to modify
them without being absolutely sure of their impact in the rest of the systems.</p><p>That said, we are very happy to accept contributions, and publish them
for review by the jPOS-EE community.</p><p>We license jPOS-EE commercially, so companies or individuals willing to
include code in the jPOS-EE distribution will need to sign a CLA (see
<a class="xref" href="#appendix_CLA" title="Appendix&nbsp;C.&nbsp;Contributor License Agreement">Appendix&nbsp;C, <i>Contributor License Agreement</i></a>) and
if working for a company, a CCLA agreement (see <a class="xref" href="#appendix_CCLA" title="Appendix&nbsp;D.&nbsp;Corporate CLA">Appendix&nbsp;D, <i>Corporate CLA</i></a>) as well.</p><p>The best way to stay up-to-date with jPOS and jPOS-EE is to monitor the
following resources:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="http://feeds.feedburner.com/jpos" target="_top">The jPOS Blog</a></li><li class="listitem"><a class="link" href="http://feeds.feedburner.com/jpos-commits" target="_top">jPOS and jPOS-EE commit
notifications</a></li><li class="listitem"><a class="link" href="http://groups.google.com/group/jpos-users/feed/msgs.xml" target="_top">jPOS users
forum</a></li><li class="listitem"><a class="link" href="http://rss.gmane.org/gmane.comp.java.jpos.devel" target="_top">jPOS developers forum</a></li><li class="listitem"><a class="link" href="http://twitter.com/jposcommits" target="_top">@jposcommits</a></li><li class="listitem"><a class="link" href="https://jpos.org/issues/issues/jPOS-EE" target="_top">Issue Tracker</a></li><li class="listitem">If tweeting about jPOS, please use the <a class="link" href="https://twitter.com/search?q=%23jPOS" target="_top">#jPOS</a> hashtag</li></ul></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: Resources Page"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/admon/tip.png"></td><th align="left">Resources Page</th></tr><tr><td align="left" valign="top"><p>There is a handy <a class="link" href="http://jpos.org/resources" target="_top">jpos.org/resources</a> page at our website.</p></td></tr></table></div></div><div class="footnotes"><br><hr style="width:100; text-align:left;margin-left: 0"><div id="ftn.d0e73" class="footnote"><p><a href="#d0e73" class="simpara"><sup class="simpara">[1] </sup></a>Visanet/Uruguay <a class="link" href="http://visanet.com.uy" target="_top">http://visanet.com.uy</a></p></div><div id="ftn.d0e93" class="footnote"><p><a href="#d0e93" class="simpara"><sup class="simpara">[2] </sup></a>Q2 is QSP version 2, described in the jPOS Programmer&#8217;s Guide</p></div><div id="ftn.d0e128" class="footnote"><p><a href="#d0e128" class="simpara"><sup class="simpara">[3] </sup></a>Gradle Project <a class="link" href="http://gradle.org/" target="_top">http://gradle.org/</a></p></div><div id="ftn.d0e168" class="footnote"><p><a href="#d0e168" class="simpara"><sup class="simpara">[4] </sup></a>Do not repeat yourself</p></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="_contributing_to_the_project"></a>2.&nbsp;Contributing to the project</h2></div></div></div><p>This project uses Fork &amp; Pull collaborative development model
as described in: <a class="link" href="https://help.github.com/articles/using-pull-requests" target="_top">https://help.github.com/articles/using-pull-requests</a>.</p><p>The following sections provide the guidelines to follow before a contribution
is made to the project.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_github_workflow"></a>2.1&nbsp;GitHub Workflow</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_quickfire_dos_and_donts"></a>2.1.1&nbsp;Quickfire Do&#8217;s and Don&#8217;t&#8217;s</h3></div></div></div><p>If you&#8217;re familiar with git and GitHub, here&#8217;s the short version of what you need to know.
Once you fork and clone the jPOS-EE code:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><span class="strong"><strong>Don&#8217;t develop on the master branch</strong></span>. Always create a development branch specific to
the issue (see <a class="link" href="https://jpos.org/issues/issues/jPOS-EE" target="_top">https://jpos.org/issues/issues/jPOS-EE</a>) you&#8217;re working on. Name it by issue # and description.
For example, if you&#8217;re working on Issue jPOS-EE-359, an aspect naming fix, your development branch
should be called jPOS-EE-359-aspect-names. If you decide to work on another issue mid-stream,
create a new branch for that issue&#8212;&#8203;don&#8217;t work on both in one branch.</li><li class="listitem"><span class="strong"><strong>Do not merge the upstream master with your development branch</strong></span>;
rebase your branch on top of the upstream master.</li><li class="listitem"><span class="strong"><strong>A single development branch should represent changes related to a single issue.</strong></span>
If you decide to work on another issue, create another branch.</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_step_by_step_the_short_version"></a>2.1.2&nbsp;Step-by-step (the short version)</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Fork on GitHub (click Fork button)</li><li class="listitem">Clone to computer (<code class="literal">$ git clone git@github.com:~you~/jPOS-EE.git</code>)</li><li class="listitem">Don&#8217;t forget to cd into your repo: (<code class="literal">$ cd jPOS-EE/</code>)</li><li class="listitem">Set up remote upstream (<code class="literal">$ git remote add upstream git://github.com/jpos/jPOS-EE.git</code>)</li><li class="listitem">Create a branch for new issue (<code class="literal">$ git checkout -b 100-new-feature</code>,
if you don&#8217;t have a bug report no worries just skip the number)</li><li class="listitem">Develop on issue branch. [Time passes, the main jPOS repository accumulates new commits]</li><li class="listitem">Commit changes to issue branch. (<code class="literal">$ git add . ; git commit</code>)</li><li class="listitem">Fetch upstream (<code class="literal">$ git fetch upstream</code>)</li><li class="listitem">Update local master (<code class="literal">$ git checkout master; git pull upstream master</code>)</li><li class="listitem">Repeat steps 5-8 till dev is complete</li><li class="listitem">Rebase issue branch (<code class="literal">$ git checkout 100-new-feature; git rebase master</code>)</li><li class="listitem">Push branch to GitHub (<code class="literal">$ git push origin 100-new-feature</code>)</li><li class="listitem">Issue pull request (Click Pull Request button)</li></ul></div><p>Extra reading material on forking can be found at : <a class="link" href="http://gun.io/blog/how-to-github-fork-branch-and-pull-request/" target="_top">http://gun.io/blog/how-to-github-fork-branch-and-pull-request/</a></p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/admon/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Item 11 (rebase) in the previous list is very often forgotten, but it&#8217;s
extremely important. Be kind with the rest of the team and do it.
Read this <a class="link" href="http://www.mail-archive.com/dri-devel@lists.sourceforge.net/msg39091.html" target="_top">post by Git author Linus Torvalds</a>
to understand why.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_commit_messages"></a>2.1.3&nbsp;Commit messages</h3></div></div></div><p>Please read <a class="link" href="http://tbaggery.com/2008/04/19/a-note-about-git-commit-messages.html" target="_top">http://tbaggery.com/2008/04/19/a-note-about-git-commit-messages.html</a> for
guidelines in creating good commit messages.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_coding_conventions"></a>2.2&nbsp;Coding conventions</h2></div></div></div><p>We adhere to standard
<a class="link" href="http://www.oracle.com/technetwork/java/codeconventions-150003.pdf" target="_top">Sun&#8217;s java &reg;
coding conventions</a> for the Java Language, that among other things it
specifies: Four spaces should be used as the unit of indentation. The
exact construction of the indentation (spaces vs. tabs) is unspecified.
Tabs must be set exactly every 8 spaces (not 4).</p><p>Due to our revision control system, we also need that hard tabs (ASCII
0x09) are not used in source code and configuration files (in order for
diff to work properly among platforms).</p><p>For <span class="emphasis"><em>vi</em></span> users, we are using the following .vimrc:</p><pre class="screen">      set ts=8
      set sts=4
      set sw=4
      set expandtab</pre><p>For your Git commits and pull requests, we recommend you normalize your
end of lines. This is specially important if you use a Windows platform.</p><pre class="screen">git config --global core.autocrlf input</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/admon/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Eclipse users, go to Preferences -&gt; Java -&gt; Editor -&gt; Typing and check the
<span class="emphasis"><em>Insert space for tabs</em></span> checkbox.</p></td></tr></table></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="_getting_started"></a>3.&nbsp;Getting Started</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_prerequisites"></a>3.1&nbsp;Prerequisites</h2></div></div></div><p>jPOS-EE-SDK assumes that the following software is installed in your
development environment:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">JDK 1.8 or higher</li><li class="listitem">A git client</li></ul></div><p>While jPOS and jPOS-EE can be used in a Windows environment, we develop
it in an Unix environment, so you&#8217;ll find many useful Unix scripts
with no Windows counterpart. If you use windows, you may choose to install
a Unix-like environment such as <a class="link" href="http://www.cygwin.com" target="_top">Cygwin</a> so you can
make use of the unix scripts directly.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_an_ide"></a>3.2&nbsp;Using an IDE</h2></div></div></div><p>jPOS-EE is known to work with most modern IDEs such as Eclipse,
NetBeans, Jetbrain&#8217;s IDEA&reg;. The Gradle configuration uses the
IDEA and Eclipse plugins allowing you to create suitable IDE
configurations by running <code class="literal">gradle idea</code> or <code class="literal">gradle eclipse</code>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_an_application_server"></a>3.3&nbsp;Using an application server</h2></div></div></div><p>jPOS-EE is a stand-alone application that runs off jPOS' Q2 container.</p><p>We are aware that there are companies and institutions that standardize
on using a given application server or JEE container. That&#8217;s great, but
jPOS-EE is a stand-alone application. If you master your application
server, you will certainly be able to integrate jPOS-EE, either as a
client EJB application, as a Resource Adapter, a WAR, EAR, etc. In
addition, some application servers have proprietary extensions that
facilitates such integration.</p><p>But let us repeat this one more time. jPOS-EE is a stand alone
application. If you know how to run it inside application server XYZ,
that&#8217;s perfect; if we can make your life easier by doing something on
our end that makes that integration easier, and you have the expertise
in both jPOS-EE and your application server to provide us detailed
instructions on what you need, and the changes won&#8217;t break any existing
jPOS or jPOS-EE functionality, then we are willing to do so, but if you
decide to go that route, you&#8217;ll be on your own.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_preparing_your_environment"></a>3.4&nbsp;Preparing your environment</h2></div></div></div><p>In this chapter we will work through setting up the development environment consisting of:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Downloading the jPOS-EE SDK source code using Git.</li><li class="listitem">Compiling and installing the components locally on your system.</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_maven_coordinates"></a>3.5&nbsp;Maven coordinates</h2></div></div></div><p>jPOS-EE modules are regularly published to jPOS' maven repository. You can use its
dependencies by adding</p><pre class="literallayout">&lt;repository&gt;
    &lt;id&gt;jpos-ee&lt;/id&gt;
    &lt;name&gt;jPOS Maven Repository&lt;/name&gt;
    &lt;url&gt;http://jpos.org/maven&lt;/url&gt;
&lt;/repository&gt;</pre><p>to your Maven or</p><pre class="literallayout">repositories {
    ...
    maven { url 'http://jpos.org/maven' }
    ...
}</pre><p>to your Gradle configuration.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/admon/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>We recommend you use the <a class="link" href="https://github.com/jpos/jPOS-template" target="_top">jPOS Template</a>,
in particular its <code class="literal">multimodule</code> branch when building jPOS-EE based applications.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_downloading_the_sources"></a>3.6&nbsp;Downloading the sources</h2></div></div></div><p>In order to get a copy of it, and keep your copy up-to-date with
the latest revision, you need to use a Git client.</p><p>Git installation instructions for Windows, Linux and MacOS X are available here:
<a class="link" href="http://help.github.com/set-up-git-redirect" target="_top">Git Setup</a>.</p><p>jPOS-EE is hosted at <a class="link" href="https://github.com/jpos/jPOS-EE" target="_top">GitHub</a>. By visiting
the project page you will be provided information on how to Checkout,
Browse and see a history of changes to the system.</p><p>If you are on an Unix/Unix-like environment, an initial checkout would
look something like :-</p><pre class="screen">$ git clone https://github.com/jpos/jPOS-EE.git
Cloning into 'jPOS-EE'...
remote: Counting objects: 627, done.
remote: Compressing objects: 100% (355/355), done.
remote: Total 627 (delta 250), reused 528 (delta 151)
Receiving objects: 100% (627/627), 127.72 KiB, done.
Resolving deltas: 100% (250/250), done.
$</pre><p>This will create a new directory <span class="quote">&#8220;<span class="quote">jPOS-EE</span>&#8221;</span> containing a clone of what&#8217;s currently in the master branch at our central GitHub repository.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_installing_the_sdk"></a>3.7&nbsp;Installing the SDK</h2></div></div></div><p>If you&#8217;re not using jPOS Maven repo, you can install your dependencies locally
by calling:</p><pre class="literallayout">gradle install</pre><p>If your build completes with <span class="quote">&#8220;<span class="quote">BUILD SUCCESSFUL</span>&#8221;</span> , you are ready to proceed to create your first project!</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/admon/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Gradle just built and installed all of its components into your local Maven
repository, where they can be accessed by any of your projects.</p><p>If you have made local changes to the jPOS-EE sources, followed by a call
to <code class="literal">gradle install</code>, make sure that your <code class="literal">mavenLocal()</code> repository comes
<span class="strong"><strong>before</strong></span> <code class="literal">http://jpos.org/maven</code> in your repository list so that dependencies
are taken from your local <code class="literal">$HOME/.m2/repository</code> directory.</p><p>Please note that while this is OK during development, it&#8217;s a bad practice
if you expect to produce repeatable builds.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_five_minute_tutorial"></a>3.8&nbsp;Five minute tutorial</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_initial_setup_jpos_project"></a>3.8.1&nbsp;Initial setup, jPOS project</h3></div></div></div><p>Once you have jPOS-EE installed, in order to create your own project,
you can take advantage of our companion <span class="quote">&#8220;<span class="quote">jPOS Template</span>&#8221;</span>.</p><p>Download the latest copy of the jPOS Template
in <code class="literal">zip</code> (<a class="link" href="https://github.com/jpos/jPOS-template/archive/master.zip" target="_top">https://github.com/jpos/jPOS-template/archive/master.zip</a>)
or <code class="literal">tar.gz</code> format (<a class="link" href="https://github.com/jpos/jPOS-template/archive/master.tar.gz" target="_top">https://github.com/jpos/jPOS-template/archive/master.tar.gz</a>).</p><p>Move the directory <code class="literal">jPOS-template-master</code> into your desired project name, i.e.: <span class="quote">&#8220;<span class="quote">myjposproject</span>&#8221;</span>.</p><p>For an initial sanity test, let&#8217;s build a simple jPOS application first before moving to jPOS-EE.</p><p>Call <code class="literal">gradle installApp</code> (or <code class="literal">gradlew installApp</code> if you don&#8217;t have Gradle installed)</p><p>Then go to the directory <code class="literal">build/install/myjposproject/bin</code> and you will find a script called <code class="literal">q2</code>
(along with a Windows version <code class="literal">q2.bat</code>). Running it should start jPOS, that you can stop using <code class="literal">Ctrl-C</code>.</p><p>Here is a full transcript of this session:</p><pre class="screen">$ cd /tmp
$ wget https://github.com/jpos/jPOS-template/archive/master.tar.gz
...
...
Saving to: `master.tar.gz'

$ tar zxvf master.tar.gz
x jPOS-template-master/
x jPOS-template-master/.gitignore
x jPOS-template-master/COPYRIGHT
x jPOS-template-master/LICENSE
x jPOS-template-master/README.md
x jPOS-template-master/build.gradle
x jPOS-template-master/gradle/
...
...
...

$ mv jPOS-template-master myjposproject
$ cd myjposproject
$ ./gradlew installApp
:compileJava UP-TO-DATE
:processResources UP-TO-DATE
:classes UP-TO-DATE
:jar
:installApp

BUILD SUCCESSFUL

$ build/install/myjposproject/bin/q2

...
...
&lt;log realm="Q2.system" at="Fri Jan 25 18:30:37 UYST 2013.335"&gt;
  &lt;info&gt;
   deploy:/private/tmp/myjposproject/build/install/myjposproject/deploy/99_sysmon.xml
  &lt;/info&gt;
&lt;/log&gt;
...
...</pre><p>The jPOS template creates a standard jPOS application with its
<code class="literal">lib</code>, <code class="literal">deploy</code>, <code class="literal">cfg</code> and <code class="literal">log</code> directories that you can review in the
<code class="literal">build/install/myjposproject</code> directory.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_adding_a_jpos_ee_module"></a>3.8.2&nbsp;Adding a jPOS-EE Module</h3></div></div></div><p>Now lets add a jPOS-EE module. We&#8217;ll start with a simple one, the <a class="link" href="#server-simulator">Server Simulator</a>.</p><p>Edit <code class="literal">build.gradle</code> and add the following dependency:</p><pre class="screen">compile group:'org.jpos.ee',
   name:'jposee-server-simulator',
   version:'2.0.2-SNAPSHOT'</pre><p>so that the dependencies would look like this:</p><pre class="screen">dependencies {
    compile group:'org.jpos', name:'jpos', version:'1.9.2'
    compile group:'org.jpos.ee',
      name:'jposee-server-simulator',
      version:'2.0.2-SNAPSHOT'
    testCompile group:'junit', name:'junit', version:'4.8.2'
}</pre><p>If you build again the system by calling <code class="literal">gradle installApp</code> and you
review the generated <code class="literal">lib</code> directory now in <code class="literal">build/install/myjposproject/lib</code>
you&#8217;ll see two new libraries:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">jposee-core-2.0.2-SNAPSHOT.jar</code> and</li><li class="listitem"><code class="literal">jposee-server-simulator-2.0.2-SNAPSHOT.jar</code></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_pulling_configuration_from_modules"></a>3.8.3&nbsp;Pulling configuration from modules</h3></div></div></div><p>Now a little hack: jPOS-EE modules contain sample configuration files
inside their distributed jars. Those are intended as a reference and need to be
reviewed by the developer, but they provide a good starting point.</p><p>If you try the command:</p><pre class="screen">jar tvf build/install/myjposproject/lib/jposee-server-simulator-2.0.2-SNAPSHOT.jar</pre><p>You&#8217;ll see content like this:</p><pre class="screen"> META-INF/
 META-INF/MANIFEST.MF
 META-INF/org/
 META-INF/org/jpos/
 META-INF/org/jpos/ee/
 META-INF/org/jpos/ee/installs/
 META-INF/org/jpos/ee/installs/cfg/
 META-INF/org/jpos/ee/installs/cfg/serversimulator.bsh         <a name="CO1-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>
 META-INF/org/jpos/ee/installs/deploy/
 META-INF/org/jpos/ee/installs/deploy/05_serversimulator.xml   <a name="CO1-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO1-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>Server Simulator configuration script</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO1-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>Server Simulator QBean descriptor</p></td></tr></table></div><p>If you try <code class="literal">gradle tasks</code> you&#8217;ll see that there&#8217;s a task called <span class="quote">&#8220;<span class="quote">installResources</span>&#8221;</span>
which is defined in <code class="literal">jpos-app.gradle</code> like this:</p><pre class="programlisting">task installResources(dependsOn: 'classes', type: JavaExec) {
    classpath = sourceSets.main.runtimeClasspath
    main = 'org.jpos.q2.install.Install'
    args = ["--outputDir=src/dist"]
}</pre><p>This basically pulls all the sample configuration files from jPOS-EE modules
and place them into the <code class="literal">src/dist</code> directory of your application, where you can
edit them, add them to your SCM, etc.</p><p>So if we call <code class="literal">gradle installResources</code> in the previous example, we would endup
with a couple of new files in <code class="literal">src/dist</code>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">src/dist/cfg/serversimulator.bsh</code></li><li class="listitem"><code class="literal">src/dist/deploy/05_serversimulator.xml</code></li></ul></div><p>Those files will land in the <code class="literal">build/install/myjposproject</code> on your next call to <code class="literal">gradle installApp</code>
or inside your distribution in <code class="literal">build/distributions</code> the next time you call <code class="literal">gradle dist</code>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/admon/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>At this point, you should be able to run <code class="literal">q2</code> from the install directory and
have a server listening to port 10000 (the default port). It&#8217;s an XML server
so you can <code class="literal">telnet localhost 10000</code> and fire an XML message like this.</p><pre class="programlisting">  <span class="hl-tag">&lt;isomsg&gt;</span>
   <span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"0"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"0800"</span><span class="hl-tag"> /&gt;</span>
   <span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"3"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"000000"</span><span class="hl-tag"> /&gt;</span>
   <span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"11"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"000001"</span><span class="hl-tag"> /&gt;</span>
   <span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"41"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"00000001"</span><span class="hl-tag"> /&gt;</span>
   <span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"70"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"901"</span><span class="hl-tag"> /&gt;</span>
  <span class="hl-tag">&lt;/isomsg&gt;</span></pre><p>If everything works alright, you should get a 0810 response.</p></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/admon/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>You may want to visit the jPOS <a class="link" href="http://jpos.org/tutorials" target="_top">Tutorials</a> page for
additional tutorials.</p></td></tr></table></div></div></div></div></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a name="_modules"></a>Part&nbsp;II.&nbsp;Modules</h1></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="_introduction_to_modules"></a>4.&nbsp;Introduction to modules</h2></div></div></div><p>In our traditional Ant based build system, the developer chooses which modules
to use from the <span class="emphasis"><em>opt</em></span> directory, and creates symbolic links to the <span class="emphasis"><em>modules</em></span> directory. The build
system merges them into a flat structure, and does some processing such as:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Concatenate constants files from all modules into single addressable constant files.</li><li class="listitem">Create the hibernate configuration file from all the "mapping file" snippets from all the selected modules</li><li class="listitem">Resolve any property placeholders from all modules using property files</li></ul></div><p>Compiled classes for all selected modules, static definitions for database connections, static constants file(s), etc. are
then used to generate a jar archive (jposee.jar).</p><p>With the introduction of Gradle-based jPOS-EE project structure,
we are also introducing a new module system, based on Maven type artifacts.</p><p>Some immediate benefits are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">The SDK is built independently from your project.</li><li class="listitem">Your project just uses the modules as versioned dependencies. As a result your project&#8217;s
footprint is reduced, as now only need to track your code, not all the jPOS-EE dependencies in your version control system.</li><li class="listitem">The barrier to entry is greatly reduced, since a new developer could setup a
jPOS-EE project in five minutes.</li><li class="listitem">No need to track module dependencies.</li><li class="listitem">Each module contains "sample" configurations used during project setup at runtime.</li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_how_do_modules_work"></a>4.1&nbsp;How do modules work?</h2></div></div></div><p>A module is nothing more than a simple jar artifact with special features.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_hibernate_mappings"></a>4.1.1&nbsp;Hibernate Mappings</h3></div></div></div><p>A Module defines a "module descriptor", stored in <span class="strong"><strong>/META-INF/org/jpos/ee/modules</strong></span>. This descriptor
contains the hibernate mapping entries for the persistent entities defined in this module.</p><p>Here is an example,</p><pre class="programlisting"><span class="hl-tag">&lt;module</span> <span class="hl-attribute">name</span>=<span class="hl-value">"status"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;mappings&gt;</span>
        <span class="hl-tag">&lt;mapping</span> <span class="hl-attribute">resource</span>=<span class="hl-value">"org/jpos/ee/status/Status.hbm.xml"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;mapping</span> <span class="hl-attribute">resource</span>=<span class="hl-value">"org/jpos/ee/status/StatusTag.hbm.xml"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/mappings&gt;</span>

<span class="hl-tag">&lt;/module&gt;</span></pre><p>It is best practice to name the module descriptor the same as the module name suffixed with the ".xml" extension.</p><p>Instead of defining them statically in a central <span class="emphasis"><em>hibernate.cfg.xml</em></span>, the persistent class mappings are
resolved at runtime from all the module descriptors visible in the classpath.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_installables"></a>4.1.2&nbsp;Installables</h3></div></div></div><p>There&#8217;s a very special resource path, <span class="strong"><strong>/META-INF/org/jpos/ee/installs</strong></span>. Any resource stored below that path,
gets installed to the filesystem during the setup process (as shown in the tutorial).</p><p>So for example, if we have the <span class="emphasis"><em>jposee-core</em></span> module as one of our dependencies, and the core modules has the following structure</p><pre class="screen">META-INF
`-- org
    `-- jpos
        `-- ee
            `-- installs
                |-- cfg
                |   `-- README.txt
                |-- deploy
                |   |-- 00_logger.xml
                |   `-- 99_sysmon.xml
                `-- log
                    `-- q2.log</pre><p>and we do:</p><pre class="literallayout">$ java -jar q2.jar -cli
q2&gt; setup .</pre><p>We&#8217;d get the following structure copied to our current working directory:</p><pre class="screen">.
|-- cfg
|   `-- README.txt
|-- deploy
|   |-- 00_logger.xml
|   `-- 99_sysmon.xml
`-- log
    `-- q2.log</pre><p>If now we added the <span class="emphasis"><em>jposee-db-mysql</em></span> module as one of our dependencies,
which contains the following structure and ran setup again:</p><pre class="screen">META-INF
`-- org
    `-- jpos
        `-- ee
            `-- installs
                `-- cfg
                    `-- db.properties</pre><p>We&#8217;d end up with the following files in our filesystem:</p><pre class="screen">.
|-- cfg
|   |-- README.txt
|   `-- db.properties
|-- deploy
|   |-- 00_logger.xml
|   `-- 99_sysmon.xml
`-- log
    `-- q2.log</pre></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="_core_modules"></a>5.&nbsp;Core Modules</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_core"></a>5.1&nbsp;CORE</h2></div></div></div><div class="informaltable"><table style="border: none;"><colgroup><col class="col_1"><col class="col_2"></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>What</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The core module contains all basic jPOS-EE functionality.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>When</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Available in all versions of jPOS-EE.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Who</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The jPOS.org team.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Where</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Directory modules/core available in git repository at github.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Why</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>This is a core module required in all jPOS-EE applications.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Status</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Stable.</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>License</strong></span></p></td><td style="" align="left" valign="top"><p><a class="link" href="#appendix_license" title="Appendix&nbsp;B.&nbsp;License">GNU Affero General Public License version 3</a></p></td></tr></tbody></table></div><p><b>Maven Coordinates.&nbsp;</b>
</p><pre class="programlisting">        <span class="hl-tag">&lt;dependency&gt;</span>
            <span class="hl-tag">&lt;groupId&gt;</span>org.jpos.ee<span class="hl-tag">&lt;/groupId&gt;</span>
            <span class="hl-tag">&lt;artifactId&gt;</span>jposee-core<span class="hl-tag">&lt;/artifactId&gt;</span>
            <span class="hl-tag">&lt;version&gt;</span>${jposee.version}<span class="hl-tag">&lt;/version&gt;</span>
        <span class="hl-tag">&lt;/dependency&gt;</span></pre><p>
</p><p>The core module serves two purposes:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">It includes all basic dependencies needed to run any jPOS-EE application.</li><li class="listitem">It contains base functionality shared by all jPOS-EE applications.</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_transaction_support"></a>5.2&nbsp;Transaction Support</h2></div></div></div><div class="informaltable"><table style="border: none;"><colgroup><col class="col_1"><col class="col_2"></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>What</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The <span class="emphasis"><em>txn</em></span> module contains <span class="strong"><strong>Transaction Manager</strong></span>
                   support code as well as common transaction manager participants.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>When</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Available in all versions of jPOS-EE.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Who</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The jPOS.org team.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Where</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Directory modules/txn available in git repository at github.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Why</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>This module is useful if your jPOS-EE application uses the <span class="strong"><strong>Transaction Manager</strong></span>.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Status</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Stable.</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>License</strong></span></p></td><td style="" align="left" valign="top"><p><a class="link" href="#appendix_license" title="Appendix&nbsp;B.&nbsp;License">GNU Affero General Public License version 3</a></p></td></tr></tbody></table></div><p><b>Maven Coordinates.&nbsp;</b>
</p><pre class="programlisting">        <span class="hl-tag">&lt;dependency&gt;</span>
            <span class="hl-tag">&lt;groupId&gt;</span>org.jpos.ee<span class="hl-tag">&lt;/groupId&gt;</span>
            <span class="hl-tag">&lt;artifactId&gt;</span>jposee-txn<span class="hl-tag">&lt;/artifactId&gt;</span>
            <span class="hl-tag">&lt;version&gt;</span>${jposee.version}<span class="hl-tag">&lt;/version&gt;</span>
        <span class="hl-tag">&lt;/dependency&gt;</span></pre><p>
</p><p>There is nothing worse than re-inventing the wheel for every project. With this in mind,
the jPOS team identified a series of activities that were common to almost every
enterprise grade jPOS-EE based project, and created a module to provide the basis for building
great TransactionManager participants that follow best practice patterns.</p><p>Instead of showing a boring table with a description of what every component does,
I think an example Transaction Manager instance is in order:</p><pre class="programlisting"><span class="hl-tag">&lt;txnmgr</span> <span class="hl-attribute">name</span>=<span class="hl-value">"txnmgr"</span> <span class="hl-attribute">logger</span>=<span class="hl-value">"Q2"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.transaction.TransactionManager"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"space"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"transient:default"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"queue"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"TXN"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"max-sessions"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"10"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;participant</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.transaction.Open"</span> <span class="hl-attribute">logger</span>=<span class="hl-value">"Q2"</span> <span class="hl-attribute">realm</span>=<span class="hl-value">"open-db"</span><span class="hl-tag">&gt;</span>     <a name="CO2-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"checkpoint"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"db-open"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/participant&gt;</span>

    <span class="hl-tag">&lt;participant</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mydemo.DemoParticipant"</span>                                 <a name="CO2-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span>
                 logger="Q2" realm="demo-participant"/&gt;

    <span class="hl-tag">&lt;participant</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.transaction.Close"</span> <span class="hl-attribute">logger</span>=<span class="hl-value">"Q2"</span> <span class="hl-attribute">realm</span>=<span class="hl-value">"close-db"</span><span class="hl-tag">&gt;</span>   <a name="CO2-3"></a><span><img src="images/icons/callouts/3.png" alt="3" border="0"></span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"checkpoint"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"close"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/participant&gt;</span>
<span class="hl-tag">&lt;/txnmgr&gt;</span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO2-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>The <span class="emphasis"><em>Open</em></span> Participant opens a new DB session and transaction.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO2-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>Our demo participant does some processing</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO2-3"><span><img src="images/icons/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>The <span class="emphasis"><em>Close</em></span> Participant commits or rollbacks the existing transaction based on overall outcome, and closes the session.</p></td></tr></table></div><p>In our demo scenario, the transaction manager will open a database session,
execute our DemoParticipant and close the database session (although our DemoParticipant does not need a DB session!).</p><p>In case we wanted to add some debugging, we could definitely add to the end of the file:</p><pre class="programlisting">    <span class="hl-tag">&lt;participant</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.transaction.ProtectDebugInfo"</span>
                 <span class="hl-attribute">logger</span>=<span class="hl-value">"Q2"</span> <span class="hl-attribute">realm</span>=<span class="hl-value">"protect-debug"</span><span class="hl-tag">&gt;</span>                                 <a name="CO3-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"checkpoint"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"protect-debug-info"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-comment">&lt;!-- Wipes entries from context --&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"wipe-entry"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"PAN"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"wipe-entry"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"EXP"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-comment">&lt;!-- Protects contents from any ISOMsg in context --&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"protect-ISOMsg"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"2"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"protect-ISOMsg"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"35"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"protect-ISOMsg"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"45"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-comment">&lt;!-- Wipes contents from any ISOMsg in context --&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"wipe-ISOMsg"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"48"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"wipe-ISOMsg"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"52"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/participant&gt;</span>

    <span class="hl-tag">&lt;participant</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.transaction.Debug"</span> <span class="hl-attribute">logger</span>=<span class="hl-value">"Q2"</span> <span class="hl-attribute">realm</span>=<span class="hl-value">"debug"</span><span class="hl-tag">&gt;</span>      <a name="CO3-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"checkpoint"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"debug"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/participant&gt;</span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO3-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>The <span class="emphasis"><em>ProtectDebugInfo</em></span> Participant protects sensitive material from logs.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO3-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>The <span class="emphasis"><em>Debug</em></span> participant dumps the contents of the context to the log.</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/admon/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>As of jPOS 2.1.1 and beyond, the TransactionManager automatically logs the Context, as
well as profiling information, whenever the <code class="literal">debug</code> property is set to <code class="literal">true</code>.
The <code class="literal">Debug</code> participant is hence not required (and actually useless/annoying as it
would log the Context twice).</p></td></tr></table></div><p>This would result in the contents of the context being dumped to the log, protecting
sensitive material on the way.</p><p>In case you are wondering what the <code class="literal">DemoParticipant</code> might look like:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DemoParticipant <span class="hl-keyword">extends</span> TxnSupport <span class="hl-keyword">implements</span> MyConstants           <a name="CO4-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>
{
    <span class="hl-keyword">protected</span> <span class="hl-keyword">int</span> doPrepare(<span class="hl-keyword">long</span> id, Context ctx) <span class="hl-keyword">throws</span> Exception               <a name="CO4-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span>
    {
        ISOMsg message = (ISOMsg) ctx.get(REQUEST);
        ISOSource source = (ISOSource) ctx.get(SOURCE);

        assertNotNull(message,<span class="hl-string">"A valid 'REQUEST' is expected in the context"</span>);   <a name="CO4-3"></a><span><img src="images/icons/callouts/3.png" alt="3" border="0"></span>
        assertNotNull(source,<span class="hl-string">"A valid 'SOURCE' is expected in the context"</span>);
        assertTrue(message.hasField(<span class="hl-number">4</span>),                                          <a name="CO4-4"></a><span><img src="images/icons/callouts/4.png" alt="4" border="0"></span>
            <span class="hl-string">"The message needs to have an amount (ISOMsg:4)"</span>);

        message.setResponseMTI();

        Random random = <span class="hl-keyword">new</span> Random(System.currentTimeMillis());
        message.set (<span class="hl-number">37</span>, Integer.toString(Math.abs(random.nextInt()) % <span class="hl-number">1000000</span>));
        message.set (<span class="hl-number">38</span>, Integer.toString(Math.abs(random.nextInt()) % <span class="hl-number">1000000</span>));

        <span class="hl-keyword">if</span> (<span class="hl-string">"000000009999"</span>.equals (message.getString (<span class="hl-number">4</span>)))
            message.set (<span class="hl-number">39</span>, <span class="hl-string">"01"</span>);
        <span class="hl-keyword">else</span>
            message.set (<span class="hl-number">39</span>, <span class="hl-string">"00"</span>);

        source.send (message);
        <span class="hl-keyword">return</span> PREPARED | NO_JOIN | READONLY;
    }
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> commit(<span class="hl-keyword">long</span> id, Serializable context) { }
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> abort(<span class="hl-keyword">long</span> id, Serializable context)  { }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO4-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>Our demo participant extends TxnSupport, the supporting class provided by this module.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO4-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>TxnSupport overrides the "prepare" method and delegates to <span class="emphasis"><em>doPrepare</em></span></p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO4-3"><span><img src="images/icons/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>As you can see, not-null assertions are quite easy!</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO4-4"><span><img src="images/icons/callouts/4.png" alt="4" border="0"></span></a> </p></td><td valign="top" align="left"><p>So are boolean assertions.</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/admon/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you are serious about jPOS-EE development involving Transaction Manager, we advise
you to study the <code class="literal">TxnSupport</code> class further.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_txnid"></a>5.3&nbsp;TxnId</h2></div></div></div><p>The <code class="literal">txn</code> module has a handy <code class="literal">TxnId</code> class that can be used to generate ids in a distributed way.</p><p>The id is composed of:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">1-digit century</li><li class="listitem">2-digits year</li><li class="listitem">3-digits day of year</li><li class="listitem">5-digits second of day</li><li class="listitem">3-digits node id</li><li class="listitem">5-digits transaction id</li></ul></div><p>A typical ID long value would look like this: <code class="literal">173000348000000001</code>,
and the <code class="literal">toString()</code> method would show as <code class="literal">017-300-03480-000-00001</code>.</p><p><code class="literal">TxnId</code> also has a handy <code class="literal">toRrn()</code> method that can be used to create
(and parse) 12-characters strings suitable to be used as retrieval
reference numbers.</p><p><code class="literal">TxnId</code> can be used instead of UUIDs. It puts less pressure in the database
index and provides chronological order.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/icons/admon/warning.png"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top"><p>The last two groups, <code class="literal">node-id</code> and <code class="literal">transaction-id</code> are supposed to be unique.
transaction-id is easy to get from the transaction manager. <code class="literal">node-id</code> is a
tricky one, use has to ensure each node has a unique <code class="literal">node-id</code> to avoid
collisions.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="QI"></a>5.4&nbsp;QI Basics</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_main_xml"></a>5.4.1&nbsp;Main XML</h3></div></div></div><p>The main configuration is done on <code class="literal">00_qi.xml</code></p><p>The main contents of this file are:</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_title"></a>Title</h4></div></div></div><p>Example:
<code class="literal">&lt;title&gt;jPOS QI&lt;/title&gt;</code></p><p>Indicates the title for the app.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_locale"></a>Locale</h4></div></div></div><p>Indicates the available locales for the app, it can have more than one.
The first one will be the default locale.</p><p>Examples:</p><p><code class="literal">&lt;locale&gt;en-US&lt;/locale&gt;</code></p><p><code class="literal">&lt;locale&gt;es-UY&lt;/locale&gt;</code></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_messages"></a>Messages</h4></div></div></div><p>Indicates the names of the <code class="literal">.properties</code> files available. It can contain more than one.</p><p>Example:</p><pre class="literallayout">&lt;messages&gt;qi-core-messages&lt;/messages&gt;</pre><pre class="literallayout">&lt;messages&gt;qi-eeuser-messages&lt;/messages&gt;</pre><pre class="literallayout">&lt;messages&gt;qi-sysconfig-messages&lt;/messages&gt;</pre><p>The naming convention for these files is: <code class="literal">packagename_locale.properties</code></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_menubar"></a>Menubar</h4></div></div></div><p>A menubar represents the horizontal menu at the top of the app.
It is represented with the <code class="literal">&lt;menubar&gt;</code> element.
It contains "menus".</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_menu"></a>Menu</h5></div></div></div><p>It represents the menu item.
It has a <code class="literal">name</code>, an <code class="literal">icon</code>, a <code class="literal">style</code>, and an <code class="literal">action</code>.</p><p>Example:</p><p><code class="literal">&lt;menu name="System" icon="COG" style="icon-cog" action="system" /&gt;</code></p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_sidebar"></a>Sidebar</h4></div></div></div><p>Represents the sidebar, it can contain <a class="link" href="#">sections</a> and <a class="link" href="#">options</a>.
It is represented with the <code class="literal">sidebar</code> element.
It can also be identified by an <code class="literal">id</code>. Example: <code class="literal">&lt;sidebar id="info"&gt; ... &lt;/sidebar&gt;</code></p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_section"></a>Section</h5></div></div></div><p>Represents a section of the sidebar, represented with the <code class="literal">&lt;section&gt;</code> element. It has the following properties:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">name</code>: String, required.</li></ul></div><p>Example: <code class="literal">&lt;section name="System"/&gt;</code></p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_option"></a>Option</h5></div></div></div><p>Represents an option on the sidebar, represented with the <code class="literal">&lt;option&gt;</code> element. It has the following properties:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">name</code> (string, required).  The name that will be shown on the sidebar.</li><li class="listitem"><code class="literal">action</code> (string, required). What will be executed on click.</li><li class="listitem"><code class="literal">perm</code> (string, optional). The permission required to execute the action.</li></ul></div><p>Example:</p><p><code class="literal">&lt;option name="Exception log" action="exceptions"/&gt;</code></p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_view"></a>View</h4></div></div></div><p>Represents a view, it has the following properties:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">route</code> (string, required). The <code class="literal">route</code> of the view to show.</li><li class="listitem"><code class="literal">class</code></li><li class="listitem"><code class="literal">perm</code> (<span class="emphasis"><em>*</em></span> means any perm).</li><li class="listitem"><code class="literal">sidebar</code> optional sidebar id. Indicates to which sidebar the view corresponds.</li></ul></div><p>Example:</p><p><code class="literal">&lt;view route="home" class="org.jpos.qi.views.DefaultView" perm="*" sidebar = "system"/&gt;</code></p><p>Views can <span class="strong"><strong>can/will</strong></span> contain different <a class="link" href="#">properties</a> &amp; <a class="link" href="#">attributes</a>.</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_properties"></a>Properties</h5></div></div></div><p>Represented with the <code class="literal">&lt;property&gt;</code> element. It has a <code class="literal">name</code> and a <code class="literal">value</code>.
Some views require:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">entityName</code> (string, required for entities). The name of the entity. For example, for <code class="literal">users</code>, it is <code class="literal">user</code>.  It must be included like this: <code class="literal">&lt;property name="entityName" value="aName"/&gt;</code></li><li class="listitem"><code class="literal">name</code> (string, required when extending a class). The name for the view. When extending a class (Ex: when extending from SysConfig), it is a required field. 	It must be included like this: <code class="literal">&lt;property name="name" value="aName"/&gt;</code></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_attribute"></a>Attribute</h5></div></div></div><p>Represented with the <code class="literal">&lt;attribute&gt;</code> element.
It has:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">name</code> (string, required) The name of the attribute, it will be shown on the column, or field.</li><li class="listitem"><code class="literal">field</code> (boolean, optional) Boolean value indicating whether the attribute should be shown as a field, on the specific view.</li><li class="listitem"><code class="literal">column</code> (boolean, optional) Boolean value indicating whether the attribute should be shown as a columnn on the general view.</li><li class="listitem"><code class="literal">read-only</code> (boolean, optional) Boolean value indicating if the attribute should be editable</li><li class="listitem"><code class="literal">required</code> (boolean, optional) Indicates if the field is required. Default is false.</li><li class="listitem"><code class="literal">regex</code> (string, optional) A string indicating the regex used for validating the field.</li><li class="listitem"><code class="literal">length</code> (numeric,optional) A number, indicating the max length for the field value.</li><li class="listitem"><code class="literal">expand-ratio</code> (numeric,optional) A number, indicating if the field&#8217;s expandRatio to be used. (Check link:https://vaadin.com/docs/-/part/framework/layout/layout-settings.html#layout.settings.size.expanding(Vaadin docs)[Vaadin Docs] for more info).</li><li class="listitem"><code class="literal">perm</code> (string, optional) The permission needed to access the field.</li><li class="listitem"><code class="literal">link</code> (string, optional) The URL for which the link will be generated.</li><li class="listitem"><code class="literal">position</code> (string, optional) left/center/right/bottom: Indicates if field is displayed on the left, center, right or bottom of form layout.</li></ul></div><p>Example:</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_different_classes_of_views_tabview"></a>Different classes of views  - TabView</h5></div></div></div><p>If the view has a class of type <code class="literal">TabView</code>. It can contain views within the <code class="literal">&lt;view&gt;</code> elements. This views accept an additional property:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">caption</code> Indicates the caption for the tab.</li></ul></div></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_qi_permissions"></a>5.4.2&nbsp;QI Permissions</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><span class="emphasis"><em>sysadmin</em></span> : Needed to access <code class="literal">/roles</code>, <code class="literal">/permissions</code> and roles field in <code class="literal">/users</code>.</li><li class="listitem"><span class="emphasis"><em>login</em></span> : Needed to login to <span class="strong"><strong>QI</strong></span> and access <code class="literal">/about</code>, <code class="literal">/memory</code>, <code class="literal">/log</code>.</li><li class="listitem"><span class="emphasis"><em>sysconfig</em></span> : Needed to access <code class="literal">/sysconfig</code>.</li><li class="listitem"><span class="emphasis"><em>users.write</em></span>: Needed to access <code class="literal">/users</code>.</li><li class="listitem"><span class="emphasis"><em>accounting</em></span>: Needed to access <code class="literal">/accounts</code> and <code class="literal">/transactions</code>.</li></ul></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="_database_support"></a>6.&nbsp;Database Support</h2></div></div></div><p>Several jPOS-EE components rely on the <code class="literal">dbsupport</code> module to configure and access
the underlying database (or databases) using Hibernate.</p><p>One of the most used class is <code class="literal">org.jpos.ee.DB</code> and its usage is straightforward:</p><pre class="programlisting">    DB db = <span class="hl-keyword">new</span> DB();
    db.open();
    ...
    ...
    db.close();</pre><p>If you want to update the database, your code may look like this:</p><pre class="programlisting">    DB db = <span class="hl-keyword">new</span> DB();
    db.open();
    db.beginTransaction();
    ...
    ...
    db.commit();
    db.close();</pre><p>The DB object implements the <code class="literal">Closeable</code> interface, so you can use the try-with-resources construct like this:</p><pre class="programlisting">    <span class="hl-keyword">try</span> (DB db = <span class="hl-keyword">new</span> DB()) {
        db.open();
        db.beginTransaction();
        ...
        ...
        db.commit();
    }                                <a name="CO5-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO5-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>No need to call <code class="literal">db.close()</code> as <code class="literal">DB implements Closeable</code>.</p></td></tr></table></div><p>Also, the <code class="literal">DB</code> object provides a couple of functional alternatives to the code above:</p><pre class="programlisting">DB.exec ((db) -&gt; {
    <span class="hl-keyword">return</span> db.session().get(YourObject.<span class="hl-keyword">class</span>, yourId);
});</pre><p>or <code class="literal">execWithTransaction</code> that encloses your function within a <code class="literal">beginTransaction/commit</code> block.</p><pre class="programlisting">DB.execWithTransaction((db) -&gt; {
    db.session().save(obj);
    <span class="hl-keyword">return</span> obj;
});</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/admon/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Very often we find ourselves answering the question WHY (on earth) we have this
<code class="literal">DB</code> object instead of just using Hibernate session factory and sessions
directly. The answer comes from the history of jPOS-EE, which initially used an
object-oriented database (ObjectStore). ObjectStore had a <code class="literal">DB</code> object that one
had to instantiate to access the database, and we were used to it. Interesting
enough, ObjectStore helped model JDO, which in turn influenced the JPA we have
today.</p><p>Once we moved away from the object-oriented database to Hibernate, we found it
useful to keep that DB object around used by our code, slightly isolating us
from Hibernate and providing some helper functionality, and that&#8217;s the only
reason there&#8217;s a DB object in jPOS-EE.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_db_support_configuration"></a>6.1&nbsp;DB Support configuration</h2></div></div></div><p>Hibernate applications are usually configured by means of a single <code class="literal">hibernate.cfg.xml</code> file
that looks like this:</p><pre class="programlisting"><strong class="hl-tag" style="color: blue">&lt;!DOCTYPE hibernate-configuration PUBLIC
    "-//Hibernate/Hibernate Configuration DTD 3.0//EN"
        "http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</strong>

<span class="hl-tag">&lt;hibernate-configuration&gt;</span>
    <span class="hl-tag">&lt;session-factory&gt;</span>
        ...
        ...
        <span class="hl-tag">&lt;mapping</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.ee.SysConfig"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;mapping</span> <span class="hl-attribute">resource</span>=<span class="hl-value">"org/jpos/ee/User.hbm.xml"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;mapping</span> <span class="hl-attribute">resource</span>=<span class="hl-value">"org/jpos/ee/Consumer.hbm.xml"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;mapping</span> <span class="hl-attribute">resource</span>=<span class="hl-value">"org/jpos/ee/Revision.hbm.xml"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;mapping</span> <span class="hl-attribute">resource</span>=<span class="hl-value">"org/jpos/ee/Role.hbm.xml"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;mapping</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.your.company.entity.YourEntity"</span><span class="hl-tag"> /&gt;</span>
        ...
        ...
    <span class="hl-tag">&lt;/session-factory&gt;</span>
<span class="hl-tag">&lt;/hibernate-configuration&gt;</span></pre><p>Besides standard configuration (c3p0, jdbc, transaction isolation), the <code class="literal">hibernate.cfg.xml</code> file has
a collection of mappings for your application&#8217;s entities, but jPOS-EE applications are built <span class="emphasis"><em>&agrave; la carte</em></span>
picking modules from the jPOS-EE modules offering, as well as customer specific modules.</p><p>So if an application wants to use jPOS-EE DB support using say Postgresql backend, and wants to use the
<code class="literal">sysconfig</code> module, and <code class="literal">eeuser</code> module, you would add the following dependencies:</p><pre class="programlisting">   compile "org.jpos.ee:jposee-db-postgresql:${jposeeVersion}" <a name="CO6-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>
   compile "org.jpos.ee:jposee-sysconfig:${jposeeVersion}"
   compile "org.jpos.ee:jposee-eeuser:${jposeeVersion}"</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO6-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>the <code class="literal">db-postgresql</code> depends on <code class="literal">dbsupport</code> so no need to include it explicitly</p></td></tr></table></div><p>But upon adding these modules as a dependency, the developer would have to manually add
these mappings to the <code class="literal">hibernate.cfg.xml</code>.</p><p>In addition, as part of the edit work, you need to specify the Hibernate dialect to be used
(i.e. <code class="literal">org.hibernate.dialect.MySQL5InnoDBDialect</code> for MySQL, or <code class="literal">PostgreSQLDialect</code> for Posgresql),
JDBC URL, etc.</p><p>jPOS-EE uses a simple convention to dynamically create the Hibernate configuration file based on the
following rules:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">It uses an initial
<a class="link" href="https://github.com/jpos/jPOS-EE/blob/master/modules/dbsupport/src/main/resources/hibernate.cfg.xml" target="_top">hibernate.cfg.xml</a>
template available in the application&#8217;s CLASSPATH as starting point.</li><li class="listitem">It scans the classpath looking for XML configuration files in each dependency jar inside the
<code class="literal">META-INF/org/jpos/ee/modules</code>, for example, the <code class="literal">eeuser</code> module has the file:</li></ul></div><pre class="programlisting"><span class="hl-tag">&lt;module</span> <span class="hl-attribute">name</span>=<span class="hl-value">"eeuser"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;mappings&gt;</span>
        <span class="hl-tag">&lt;mapping</span> <span class="hl-attribute">resource</span>=<span class="hl-value">"org/jpos/ee/User.hbm.xml"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;mapping</span> <span class="hl-attribute">resource</span>=<span class="hl-value">"org/jpos/ee/Consumer.hbm.xml"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;mapping</span> <span class="hl-attribute">resource</span>=<span class="hl-value">"org/jpos/ee/Revision.hbm.xml"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;mapping</span> <span class="hl-attribute">resource</span>=<span class="hl-value">"org/jpos/ee/Role.hbm.xml"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/mappings&gt;</span>
<span class="hl-tag">&lt;/module&gt;</span></pre><p>So those mappings become part of the main Hibernate configuration.
See <a class="link" href="https://github.com/jpos/jPOS-EE/blob/master/modules/eeuser/src/main/resources/META-INF/org/jpos/ee/modules/eeuser.xml" target="_top">eeuser.xml</a></p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Finally, it searchs for a <code class="literal">cfg/db.properties</code> file in the current working directory for additional configuration and overrides.</li></ul></div><p>Here is a sample <code class="literal">db.properties</code>:</p><pre class="screen">hibernate.connection.username=sa
hibernate.connection.password=password
hibernate.hbm2ddl.auto=validate
hibernate.connection.url=jdbc:postgresql://localhost:5432/jposee
hibernate.connection.driver_class=org.postgresql.Driver
hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/admon/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>In addition to the XML module mapping file available in each module&#8217;s classpath, the <code class="literal">db-*</code> set of modules
(such as <code class="literal">db-mysql</code>, <code class="literal">db-postgresql</code>, etc.) has a sample <code class="literal">db.properties</code> file included in its
<code class="literal">META-INF/q2/installs/cfg</code> directory, so a call to <code class="literal">gradle installResources</code> or the <code class="literal">install</code> CLI command
(that you can invoke by calling <code class="literal">q2 --cli</code>) will export it to the operating system, where you can easily
edit it.</p></td></tr></table></div><p>So to recap, the following diagram shows how a dynamic <code class="literal">hibernate.cfg.xml</code> configuration is created when
we call <code class="literal">DB db = new DB()</code> with no arguments:</p><p><span class="inlinemediaobject"><img src="images/DB_configuration.png" alt="DB Configuration"></span></p><p>remember, the <code class="literal">mapping</code> files are taken from the special <code class="literal">META-INF/org/jpos/ee/modules/*.xml</code>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/admon/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>This configuration is suitable for situations where you have to connect to a single JDBC endpoint
and access and map a unique set of entities. If that&#8217;s not your case, read below for additional
options.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_accessing_a_secondaryslave_database"></a>6.1.1&nbsp;Accessing a secondary/slave database</h3></div></div></div><p>If you want to access an alternate database, you can use a modifier when instantiating your DB object,
for example:</p><pre class="programlisting">   DB db = <span class="hl-keyword">new</span> DB (<span class="hl-string">"slave"</span>);               <a name="CO7-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>
   db.open();
   db.session().setDefaultReadOnly(true);  <a name="CO7-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span>

   ...
   ...</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO7-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>We call this constructor parameter a <span class="emphasis"><em>config modifier</em></span></p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO7-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>If this is a real <code class="literal">slave</code>, you may want to set the underlying Hibernate session to read-only mode.</p></td></tr></table></div><p>In this case, jPOS-EE will operate in a very similar way as the one described in the previous section,
but instead of reading properties from the <code class="literal">cfg/db.properties</code> file, it would read them from
<code class="literal">cfg/slave:db.properties</code>.</p><p>The previous example works for situations where the set of entities mapped to
tables in your secondary database are the same as the primary database. If that&#8217;s not the case,
in addition to read an alternate JDBC configuration from your <code class="literal">slave:db.properties</code> you want to map
a different set of entities.</p><p>If your config modifier has actually two modifiers, separated by a colon (e.g. <code class="literal">slave:legacy</code>),
then we&#8217;d read JDBC and optional properties from the <code class="literal">cfg/slave:db.properties</code>, but when we scan
for mapping files, we use the following pattern <code class="literal">META-INF/org/jpos/ee/modules/legacy:*.xml</code>.</p><p>Finally, if this black magic feels confusing, you can always call</p><pre class="programlisting">   DB db = <span class="hl-keyword">new</span> DB(<span class="hl-string">"path/to/your/hibernate.cfg.xml"</span>);</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/admon/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The <code class="literal">DB</code> class uses an internal cache of sessions factories, so the first time
you call it with no args or a given modifier, it will create a sessionFactory
(an expensive operation that requires access to the database), but after that
slow first time, creating new DB objects is a very cheap operation.</p></td></tr></table></div><p>Database support is enabled by adding a database backend dependency module to
your project.</p><p>For MySQL:</p><pre class="programlisting">    <span class="hl-tag">&lt;dependency&gt;</span>
        <span class="hl-tag">&lt;groupId&gt;</span>org.jpos.ee<span class="hl-tag">&lt;/groupId&gt;</span>
        <span class="hl-tag">&lt;artifactId&gt;</span>jposee-db-mysql<span class="hl-tag">&lt;/artifactId&gt;</span>
        <span class="hl-tag">&lt;version&gt;</span>${jposee.version}<span class="hl-tag">&lt;/version&gt;</span>
    <span class="hl-tag">&lt;/dependency&gt;</span></pre><p>For PostgreSQL:</p><pre class="programlisting">    <span class="hl-tag">&lt;dependency&gt;</span>
        <span class="hl-tag">&lt;groupId&gt;</span>org.jpos.ee<span class="hl-tag">&lt;/groupId&gt;</span>
        <span class="hl-tag">&lt;artifactId&gt;</span>jposee-db-postgresql<span class="hl-tag">&lt;/artifactId&gt;</span>
        <span class="hl-tag">&lt;version&gt;</span>${jposee.version}<span class="hl-tag">&lt;/version&gt;</span>
    <span class="hl-tag">&lt;/dependency&gt;</span></pre><p>For H2 Embedded database:</p><pre class="programlisting">    <span class="hl-tag">&lt;dependency&gt;</span>
        <span class="hl-tag">&lt;groupId&gt;</span>org.jpos.ee<span class="hl-tag">&lt;/groupId&gt;</span>
        <span class="hl-tag">&lt;artifactId&gt;</span>jposee-db-h2<span class="hl-tag">&lt;/artifactId&gt;</span>
        <span class="hl-tag">&lt;version&gt;</span>${jposee.version}<span class="hl-tag">&lt;/version&gt;</span>
    <span class="hl-tag">&lt;/dependency&gt;</span></pre><p>For MS-SQL database:</p><pre class="programlisting">    <span class="hl-tag">&lt;dependency&gt;</span>
        <span class="hl-tag">&lt;groupId&gt;</span>org.jpos.ee<span class="hl-tag">&lt;/groupId&gt;</span>
        <span class="hl-tag">&lt;artifactId&gt;</span>jposee-db-mssql<span class="hl-tag">&lt;/artifactId&gt;</span>
        <span class="hl-tag">&lt;version&gt;</span>${jposee.version}<span class="hl-tag">&lt;/version&gt;</span>
    <span class="hl-tag">&lt;/dependency&gt;</span></pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/icons/admon/warning.png"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top"><p>Only one of these dependencies should be defined in your project.</p></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_mysql_support"></a>6.2&nbsp;MySQL &reg; Support</h2></div></div></div><div class="informaltable"><table style="border: none;"><colgroup><col class="col_1"><col class="col_2"></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>What:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>This module configures Hibernate to use MySQL as its back end.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>When:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Available in all versions of jPOS-EE.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Who:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The jPOS.org team.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>How:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Posted by the jPOS-EE team.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Where:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Directory modules/db-mysql available in the jPOS-EE GitHub repository.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Why:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>An RDBMS back end is required by Hibernate.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Status:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Stable.</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>License:</strong></span></p></td><td style="" align="left" valign="top"><p>The jPOS-EE code related to this module is licensed under the
<a class="link" href="#appendix_license" title="Appendix&nbsp;B.&nbsp;License">GNU Affero General Public License version 3</a>.
Hibernate &reg; itself is released under the GNU LGPL v2.1
license. See <a class="link" href="http://hibernate.org/356.html" target="_top">Hibernate&#8217;s License FAQ</a> for
details and up-to-date information. The MySQL JDBC connector is licensed
under the GNU GPL license. See
<a class="link" href="http://dev.mysql.com/downloads/connector/j/5.1.html" target="_top">Connector/J page</a>.</p></td></tr></tbody></table></div><p>Upon running <span class="emphasis"><em>setup</em></span>, your runtime directory will contain a file: cfg/db.properties.</p><pre class="programlisting"><span class="hl-attribute">hibernate.connection.username</span>=sa                                           <a name="CO8-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>
<span class="hl-attribute">hibernate.connection.password</span>=password                                     <a name="CO8-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span>
<span class="hl-attribute">hibernate.hbm2ddl.auto</span>=update                                              <a name="CO8-3"></a><span><img src="images/icons/callouts/3.png" alt="3" border="0"></span>
#
<span class="hl-attribute">hibernate.connection.url=jdbc:mysql://localhost/jposee?autoReconnect</span>=true  <a name="CO8-4"></a><span><img src="images/icons/callouts/4.png" alt="4" border="0"></span>
<span class="hl-attribute">hibernate.connection.driver_class</span>=com.mysql.jdbc.Driver
<span class="hl-attribute">hibernate.dialect</span>=org.hibernate.dialect.MySQL5InnoDBDialect</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO8-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>Replace value with your database username</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO8-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>Replace value with your database password</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO8-3"><span><img src="images/icons/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>Makes hibernate automatically update the contents of the DB to match
the entities defined. This is good to keep during development, but should
be set to <span class="strong"><strong>NONE</strong></span> in a production environment.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO8-4"><span><img src="images/icons/callouts/4.png" alt="4" border="0"></span></a> </p></td><td valign="top" align="left"><p>Replace the host and database (jposee) to match your database settings.</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/admon/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You want to change those defaults.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_postgresql_support"></a>6.3&nbsp;PostgreSQL &reg; support</h2></div></div></div><div class="informaltable"><table style="border: none;"><colgroup><col class="col_1"><col class="col_2"></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>What:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>This module configures Hibernate to use PostgreSQL as its back end.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>When:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Available starting in jPOS-EE v1r104.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Who:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The jPOS.org team.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>How:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Posted by the jPOS-EE team.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Where:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Directory modules/db-postgresql available in the jPOS-EE GitHib repository.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Why:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>An RDBMS back end is required by Hibernate.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Status:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Stable.</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>License:</strong></span></p></td><td style="" align="left" valign="top"><p>The jPOS-EE code related to this module is licensed under the
<a class="link" href="#appendix_license" title="Appendix&nbsp;B.&nbsp;License">GNU Affero General Public License version 3</a>. As
of jPOS-EE v1r98, Hibernate &reg; itself is released under the GNU LGPL v2.1
license. See <a class="link" href="http://hibernate.org/356.html" target="_top">Hibernate&#8217;s License FAQ</a> for
details and up-to-date information. The PostgreSQL JDBC connector is
licensed under the BSD license. See
<a class="link" href="http://jdbc.postgresql.org/license.html" target="_top">Postgresql.org</a>.</p></td></tr></tbody></table></div><p>Upon running <span class="emphasis"><em>setup</em></span>, your runtime directory will contain a file: cfg/db.properties.</p><pre class="programlisting"><span class="hl-attribute">hibernate.connection.username</span>=sa                                         <a name="CO9-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>
<span class="hl-attribute">hibernate.connection.password</span>=password                                   <a name="CO9-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span>
<span class="hl-attribute">hibernate.hbm2ddl.auto</span>=update                                            <a name="CO9-3"></a><span><img src="images/icons/callouts/3.png" alt="3" border="0"></span>
<span class="hl-attribute">hibernate.connection.url</span>=jdbc:postgresql://localhost:5432/jposee         <a name="CO9-4"></a><span><img src="images/icons/callouts/4.png" alt="4" border="0"></span>
<span class="hl-attribute">hibernate.connection.driver_class</span>=org.postgresql.Driver
<span class="hl-attribute">hibernate.dialect</span>=org.hibernate.dialect.PostgreSQLDialect</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO9-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>Replace value with your database username</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO9-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>Replace value with your database password</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO9-3"><span><img src="images/icons/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>Makes hibernate automatically update the contents of the DB to match
the entities defined. This is good to keep during development, but should
be set to <span class="strong"><strong>NONE</strong></span> in a production environment.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO9-4"><span><img src="images/icons/callouts/4.png" alt="4" border="0"></span></a> </p></td><td valign="top" align="left"><p>Replace the host and database (jposee) to match your database settings.</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/admon/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You want to change those defaults.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_h2_embedded_database_support"></a>6.4&nbsp;H2 Embedded Database support</h2></div></div></div><div class="informaltable"><table style="border: none;"><colgroup><col class="col_1"><col class="col_2"></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>What:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>This module configures Hibernate to use H2 as its back end.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>When:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Available in all versions of jPOS-EE since v2.0.0.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Who:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The jPOS.org team.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>How:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Posted by the jPOS-EE team.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Where:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Directory modules/db-h2 available in the jPOS-EE GitHib repository.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Why:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>An RDBMS back end is required by Hibernate.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Status:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Stable.</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>License:</strong></span></p></td><td style="" align="left" valign="top"><p>The jPOS-EE code related to this module is licensed under the
<a class="link" href="#appendix_license" title="Appendix&nbsp;B.&nbsp;License">GNU Affero General Public License version 3</a>. As
of jPOS-EE v1r98, Hibernate &reg; itself is released under the GNU LGPL v2.1
license. See <a class="link" href="http://hibernate.org/356.html" target="_top">Hibernate&#8217;s License FAQ</a> for
details and up-to-date information. The H2 JDBC connector is
licensed under the EPL license. See
<a class="link" href="http://www.h2database.com/html/license.html" target="_top">h2database.com</a>.</p></td></tr></tbody></table></div><p>Upon running <span class="emphasis"><em>setup</em></span>, your runtime directory will contain a file: cfg/db.properties.</p><pre class="programlisting"><span class="hl-attribute">hibernate.connection.username</span>=sa                                         <a name="CO10-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>
<span class="hl-attribute">hibernate.connection.password</span>=                                           <a name="CO10-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span>
<span class="hl-attribute">hibernate.hbm2ddl.auto</span>=update                                            <a name="CO10-3"></a><span><img src="images/icons/callouts/3.png" alt="3" border="0"></span>
<span class="hl-attribute">hibernate.connection.url=jdbc:h2:./data/jposee;LOCK_TIMEOUT</span>=5000         <a name="CO10-4"></a><span><img src="images/icons/callouts/4.png" alt="4" border="0"></span>
<span class="hl-attribute">hibernate.connection.driver_class</span>=org.h2.Driver
<span class="hl-attribute">hibernate.dialect</span>=org.hibernate.dialect.H2Dialect</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO10-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>Replace value with your database username</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO10-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>Replace value with your database password</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO10-3"><span><img src="images/icons/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>Makes hibernate automatically update the contents of the DB to match
the entities defined. This is good to keep during development, but should
be set to <span class="strong"><strong>NONE</strong></span> in a production environment.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO10-4"><span><img src="images/icons/callouts/4.png" alt="4" border="0"></span></a> </p></td><td valign="top" align="left"><p>Replace the host and database (jposee) to match your database settings.</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/admon/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You want to change those defaults</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_mssql_database_support"></a>6.5&nbsp;MSSQL Database support</h2></div></div></div><div class="informaltable"><table style="border: none;"><colgroup><col class="col_1"><col class="col_2"></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>What:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>This module configures Hibernate to use MS-SQL as its back end.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>When:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Available since v2.2.4</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Who:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The jPOS.org team.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>How:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Posted by the jPOS-EE team.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Where:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Directory modules/db-mssql available in the jPOS-EE GitHib repository.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Why:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>An RDBMS back end is required by Hibernate.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Status:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Stable.</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>License:</strong></span></p></td><td style="" align="left" valign="top"><p>The jPOS-EE code related to this module is licensed under the
<a class="link" href="#appendix_license" title="Appendix&nbsp;B.&nbsp;License">GNU Affero General Public License version 3</a>. As
of jPOS-EE v1r98, Hibernate &reg; itself is released under the GNU LGPL v2.1
license. See <a class="link" href="http://hibernate.org/356.html" target="_top">Hibernate&#8217;s License FAQ</a> for
details and up-to-date information. The H2 JDBC connector is
licensed under the EPL license. See
<a class="link" href="http://www.h2database.com/html/license.html" target="_top">h2database.com</a>.</p></td></tr></tbody></table></div><p>Upon running <span class="emphasis"><em>setup</em></span>, your runtime directory will contain a file: cfg/db.properties.</p><pre class="programlisting"><span class="hl-attribute">hibernate.connection.username</span>=sa                                               <a name="CO11-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>
<span class="hl-attribute">hibernate.connection.password</span>=password                                         <a name="CO11-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span>
<span class="hl-attribute">hibernate.hbm2ddl.auto</span>=update                                                  <a name="CO11-3"></a><span><img src="images/icons/callouts/3.png" alt="3" border="0"></span>
<span class="hl-attribute">hibernate.connection.url=jdbc:sqlserver://localhost:1433;databaseName</span>=jposee   <a name="CO11-4"></a><span><img src="images/icons/callouts/4.png" alt="4" border="0"></span>
<span class="hl-attribute">hibernate.connection.driver_class</span>=com.microsoft.sqlserver.jdbc.SQLServerDriver
<span class="hl-attribute">hibernate.dialect</span>=org.hibernate.dialect.SQLServerDialect                       <a name="CO11-5"></a><span><img src="images/icons/callouts/5.png" alt="5" border="0"></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO11-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>Replace value with your database username</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO11-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>Replace value with your database password</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO11-3"><span><img src="images/icons/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>Makes hibernate automatically update the contents of the DB to match
the entities defined. This is good to keep during development, but should
be set to <span class="strong"><strong>NONE</strong></span> in a production environment.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO11-4"><span><img src="images/icons/callouts/4.png" alt="4" border="0"></span></a> </p></td><td valign="top" align="left"><p>Replace the host and database (jposee) to match your database settings.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO11-5"><span><img src="images/icons/callouts/5.png" alt="5" border="0"></span></a> </p></td><td valign="top" align="left"><p><code class="literal">SQLServer2012Dialect</code> is also available.</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/admon/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You want to change those sample defaults</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_flyway_support"></a>6.6&nbsp;FlyWay Support</h2></div></div></div><p>The <code class="literal">db-flyway</code> module can be used to run FlyWay migrations from the jPOS command line interface.</p><p>It picks the DataSource configuration from the standard DB configuration used by jPOS (that can
be defined in the <code class="literal">db.properties</code> file, or a target <span class="emphasis"><em>Environment</em></span>.</p><p>When running <code class="literal">q2 --cli</code> (or reaching a running Q2 server using SSH), there&#8217;s a
new <code class="literal">flyway</code> subsystem. Inside the <code class="literal">flyway</code> subsystem you can find the following
commands:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">clean</code></li><li class="listitem"><code class="literal">info</code></li><li class="listitem"><code class="literal">baseline</code></li><li class="listitem"><code class="literal">migrate</code></li><li class="listitem"><code class="literal">validate</code></li><li class="listitem"><code class="literal">repair</code></li></ul></div><p>All Flyway commands take into account possible environment variables, defined in <code class="literal">cfg/default.yml</code>, i.e.:</p><pre class="programlisting">flyway:
    table: schema_version <a name="CO12-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO12-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>Sets <code class="literal">flyway.table</code> property, in this example, we override the new default value <code class="literal">flyway_schema_history</code> for
backward compatibility.</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/admon/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>By default, the <code class="literal">clean</code> command is disabled, unless <code class="literal">flyway.cleanDisabled: false</code> is placed in the environment.</p></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/admon/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>The migrate command accepts an optional --out-of-order parameter.</p></td></tr></table></div><p>In addition to CLI support, there&#8217;s also a <code class="literal">FlywayService</code> that can be
configured as a QBean. We recommend to use a low filename (such as
<code class="literal">01_flyway.xml</code>) so that the service starts before other services that may
require the schema to be impacted in the database.</p><p>The QBean descriptor looks like this:</p><pre class="programlisting"><span class="hl-tag">&lt;flyway</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.flyway.FlywayService"</span> <span class="hl-attribute">logger</span>=<span class="hl-value">"Q2"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"out-of-order"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span><span class="hl-tag"> /&gt;</span>                   <a name="CO13-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>
    <span class="hl-tag">&lt;commands&gt;</span>
        info
        migrate
    <span class="hl-tag">&lt;/commands&gt;</span>
<span class="hl-tag">&lt;/flyway&gt;</span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO13-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>Optional property used by Flyway migrate.</p></td></tr></table></div><p>Valid commands are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">info</li><li class="listitem">baseline</li><li class="listitem">repair</li><li class="listitem">migrate</li><li class="listitem">validate</li><li class="listitem">clean</li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/admon/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>For security, the <code class="literal">clean</code> command is disabled by default. The
<code class="literal">flyway.cleanDisabled</code> property can be set to <code class="literal">false</code> in order to enable it.</p></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/admon/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>These Flyway commands use stdout for their output. We recommend to add
&lt;property name="redirect" value="stdout, stderr" /&gt;
to your 00_logger.xml configuration in order to get unified logs.</p></td></tr></table></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="_binary_log"></a>7.&nbsp;Binary Log</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_binlog"></a>7.1&nbsp;BinLog</h2></div></div></div><div class="informaltable"><table style="border: none;"><colgroup><col class="col_1"><col class="col_2"></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>What</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>General purpose binary log</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>When</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Implemented during 2.2.4</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Who</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The jPOS Software team.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Where</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Directory modules/binlog</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Why</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Used by local Q2 nodes as audit trail or to SAF its transactions</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Status</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Experimental</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>License</strong></span></p></td><td style="" align="left" valign="top"><p><a class="link" href="#appendix_license" title="Appendix&nbsp;B.&nbsp;License">GNU Affero General Public License version 3</a></p></td></tr></tbody></table></div><p><b>Maven Coordinates.&nbsp;</b>
</p><pre class="programlisting">        <span class="hl-tag">&lt;dependency&gt;</span>
            <span class="hl-tag">&lt;groupId&gt;</span>org.jpos.ee<span class="hl-tag">&lt;/groupId&gt;</span>
            <span class="hl-tag">&lt;artifactId&gt;</span>jposee-binlog<span class="hl-tag">&lt;/artifactId&gt;</span>
            <span class="hl-tag">&lt;version&gt;</span>${jposee.version}<span class="hl-tag">&lt;/version&gt;</span>
        <span class="hl-tag">&lt;/dependency&gt;</span></pre><p>
</p><p>The jPOS BinLog has the following features:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">multiple readers and writers can be used from the same JVM</li><li class="listitem">multiple readers and writers can be used from different JVMs</li></ul></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/admon/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Make sure you read and understand the implementation notes at the end of this
section before you attempt to use it.</p></td></tr></table></div><p>Here is a sample Writer:</p><pre class="programlisting">    File dir = <span class="hl-keyword">new</span> File(<span class="hl-string">"/tmp/binlog"</span>);
    <span class="hl-keyword">try</span> (BinLogWriter bl = <span class="hl-keyword">new</span> BinLogWriter(dir)) {                                  <a name="CO14-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>
        bl.add( ... ); <span class="hl-comment">// byte array</span>
        bl.add( ... ); <span class="hl-comment">// byte array</span>
        bl.add( ... ); <span class="hl-comment">// byte array</span>
    }</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO14-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>The BinLogWriter implements <code class="literal">AutoCloseable</code> so <code class="literal">try-with-resources</code> can be used</p></td></tr></table></div><p>A reader would look like this:</p><pre class="programlisting">    File dir = <span class="hl-keyword">new</span> File(<span class="hl-string">"/tmp/binlog"</span>);
    <span class="hl-keyword">try</span> (BinLogReader bl = <span class="hl-keyword">new</span> BinLogReader(dir)) {
        <span class="hl-keyword">while</span> (bl.hasNext()) {
            <span class="hl-keyword">byte</span>[] b = bl.next().get();
            <span class="hl-comment">// do something with the byte[]</span>
        }
    }</pre><p>The <code class="literal">BinLogReader</code> implements an <code class="literal">Iterator&lt;BinLog.Entry&gt;</code>. Each <code class="literal">BinLog.Entry</code> has two
main methods:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">BinLog.Rer ref()</code></li><li class="listitem"><code class="literal">byte[] get()</code></li></ul></div><p>While iterating over a BinLog, it might make sense to persistently store its <code class="literal">BinLog.Ref</code>
in order to be able to restart the iterator at a given point if required (this is useful
if using the BinLog to implement a Store and Forward).</p><p>The <code class="literal">BinLogReader</code> has two constructors:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">BinLogReader(File dir)</code></li><li class="listitem"><code class="literal">BinLogReader(File dir, BinLog.Ref ref)</code></li></ul></div><p>the latter can be used to restart the iterator at a given reference point obtained from a previous run.</p><p>In addition to the standard <code class="literal">hasNext()</code> method required by the <code class="literal">Iterator</code> implementation,
<code class="literal">BinLogReader</code> also has a <code class="literal">hasNext(long millis)</code> method that waits a given number of
milliseconds once it reaches the end of the log, attempting to wait for a new entry
to be available.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_implementation_notes"></a>7.1.1&nbsp;Implementation notes</h3></div></div></div><p>The goal behind the BinLog implementation is to have a future proof file format easy to
read from any language, 10 years down the road. We found that the Mastercard simple IPM
file format, that&#8217;s basically a two-byte message length followed by the message itself
was suitable for that. The payload on each record can be ISO-8583 (like Mastercard), JSON,
FSDMsg based, Protocol buffers or whatever format the user choose.</p><p>But that format isn&#8217;t crash proof. If a system crashes while a record is being written to
disk, the file can get easily corrupted. So we picked some ideas from Square&#8217;s <span class="emphasis"><em>tape</em></span>
project that implements a highly crash proof on-disk persistent circular queue using
a very small header. Tape is great and we encourage you to consider it instead of this binlog
for some use cases, but we didn&#8217;t want a circular queue, we wanted a place to securely store
events for audit or store and forward purposes, and we also wanted to be able to access the
same binlog from multiple JVMs with access to the same file-system, so we had to write our own.</p><p>The on-disk file format looks like this:</p><pre class="screen">Format:
  256 bytes Header
  ... Data
  ... Data

Header format (256 bytes):
  4 bytes header length
  2 bytes version
  2 bytes Status (00=open, 01=closed)
  8 bytes Last element position
  4 bytes this log number
  4 bytes next log number
232 bytes reserved

Element:
  4 bytes Data length
  ...     Data</pre><p>Each record has a length prefix (four bytes in network byte order) followed by
its data. The header has a fixed length of 256 bytes but we found useful to
make it look like a regular record too by providing its length at the very
beginning. An implementation in any language reading a jPOS binlog can just
be programmed to skip the first record.</p><p>At any given time (usually at end of day), a process can request a <span class="strong"><strong>cut-over</strong></span>
by calling the <code class="literal">BinLogWriter.cutover()</code> method in that case, all writers and
readers will close the current file and move to the next one (Readers can
choose to not-follow to the next file, for example while producing daily
extracts).</p><p>In order to achieve file crash resilience, each write does the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Lock the file</li><li class="listitem">Write the record&#8217;s length and data</li><li class="listitem">Sync to disc</li><li class="listitem">Write the last element position to the header</li><li class="listitem">Sync to disc</li><li class="listitem">Unlock the file</li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/admon/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>In an MBP with SDRAM we&#8217;ve managed to achieve approximately 6000 writes per
second. On an iMac with regular disk the numbers go down to approximately 1500
writes per second for regular ISO-8583 message lengths (500..1000 bytes per
record).</p></td></tr></table></div><p>Due to the fact that the header is small enough to fit in an operating
system block, the second write where we place the last element position happens
to be atomic. While this works OK for readers and writers reading the file from
different JVMs, that&#8217;s not the case for readers and writers running on the same
JVM, even if they use a different file descriptor to open the file, the operating
system stack has early access to the header that under high concurrency can lead
to garbage values, that&#8217;s the reason the code synchronizes on a <code class="literal">mutex</code> object
at specific places.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_supporting_cli_commands"></a>7.1.2&nbsp;Supporting CLI commands</h3></div></div></div><p>The <code class="literal">binlog</code> CLI command is a subsystem that currently has three commands:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">monitor (to visually monitor a binlog)</li><li class="listitem">cutover (to force a cutover)</li><li class="listitem">exit (builtin command)</li></ul></div><p><code class="literal">binlog</code> accepts a parameter with the binlog&#8217;s path, i.e: <code class="literal">binlog /tmp/binlog</code></p><p>So a cutover can be triggered from cron using the following command:</p><pre class="screen">q2 --command="binlog /tmp/binlog; cutover; exit; shutdown --force"</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_binlog_quartz_support"></a>7.1.3&nbsp;BinLog Quartz Support</h3></div></div></div><p>The <code class="literal">binlog-quartz</code> provides support for automatic cutover, for example:</p><pre class="programlisting"><span class="hl-tag">&lt;cron</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.q2.QuartzAdaptor"</span> <span class="hl-attribute">logger</span>=<span class="hl-value">"Q2"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;job</span> <span class="hl-attribute">id</span>=<span class="hl-value">"1"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.binlog.cron.CutoverJob"</span> <span class="hl-attribute">when</span>=<span class="hl-value">"59 59 23 * * ?"</span>
       <span class="hl-attribute">logger</span>=<span class="hl-value">"Q2"</span> <span class="hl-attribute">realm</span>=<span class="hl-value">"binlog-cutover"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"binlog"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/tmp/binlog"</span><span class="hl-tag"> /&gt;</span>
  <span class="hl-tag">&lt;/job&gt;</span>
<span class="hl-tag">&lt;/cron&gt;</span></pre></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="_rest_support"></a>8.&nbsp;Rest Support</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_qrest"></a>8.1&nbsp;QRest</h2></div></div></div><div class="informaltable"><table style="border: none;"><colgroup><col class="col_1"><col class="col_2"></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>What</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Lightweight REST server</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>When</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Implemented during 2.2.5</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Who</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The jPOS Software team.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Where</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Directory modules/qrest</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Why</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Useful in situations where a full blown Jetty/Jersey is overkill</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Status</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Used in production</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>License</strong></span></p></td><td style="" align="left" valign="top"><p><a class="link" href="#appendix_license" title="Appendix&nbsp;B.&nbsp;License">GNU Affero General Public License version 3</a></p></td></tr></tbody></table></div><p><b>Maven Coordinates.&nbsp;</b>
</p><pre class="programlisting">        <span class="hl-tag">&lt;dependency&gt;</span>
            <span class="hl-tag">&lt;groupId&gt;</span>org.jpos.ee<span class="hl-tag">&lt;/groupId&gt;</span>
            <span class="hl-tag">&lt;artifactId&gt;</span>jposee-qrest<span class="hl-tag">&lt;/artifactId&gt;</span>
            <span class="hl-tag">&lt;version&gt;</span>${jposee.version}<span class="hl-tag">&lt;/version&gt;</span>
        <span class="hl-tag">&lt;/dependency&gt;</span></pre><p>
</p><p>Traditionally, jPOS based REST applications use the Jetty module, Jersey, etc. as described
in the <a class="link" href="http://jpos.org/tutorials" target="_top">jPOS Tutorials</a>. But we have situations where we just
need to provide a little <code class="literal">ok</code> response to say a <code class="literal">/health</code> endpoint on each Q2 running
(for monitoring purposes).</p><p>Configuring Jetty/Jersey and deploying a <code class="literal">war</code> seems like overkill for these use cases so
we&#8217;ve created a little <span class="strong"><strong>QRest</strong></span> module that can be configured like this:</p><pre class="programlisting"><span class="hl-tag">&lt;qrest</span> <span class="hl-attribute">class</span>=<span class="hl-value">'org.jpos.qrest.RestServer'</span> <span class="hl-attribute">logger</span>=<span class="hl-value">'Q2'</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">'port'</span> <span class="hl-attribute">value</span>=<span class="hl-value">'8081'</span><span class="hl-tag"> /&gt;</span>                                            <a name="CO15-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>
  <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">'queue'</span> <span class="hl-attribute">value</span>=<span class="hl-value">'TXNMGR'</span><span class="hl-tag"> /&gt;</span>                                         <a name="CO15-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span>
  <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"TLS"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span><span class="hl-tag"> /&gt;</span>                                             <a name="CO15-3"></a><span><img src="images/icons/callouts/3.png" alt="3" border="0"></span>
  <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"server-auth"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"false"</span><span class="hl-tag"> /&gt;</span>                                    <a name="CO15-4"></a><span><img src="images/icons/callouts/4.png" alt="4" border="0"></span>
  <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"client-auth"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"false"</span><span class="hl-tag"> /&gt;</span>                                    <a name="CO15-5"></a><span><img src="images/icons/callouts/5.png" alt="5" border="0"></span>
  <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"keystore"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"cfg/keystore.jks"</span><span class="hl-tag"> /&gt;</span>                            <a name="CO15-6"></a><span><img src="images/icons/callouts/6.png" alt="6" border="0"></span>
  <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"storepassword"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"jposjposjposjpos"</span><span class="hl-tag"> /&gt;</span>                       <a name="CO15-7"></a><span><img src="images/icons/callouts/7.png" alt="7" border="0"></span>
  <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"keypassword"</span>   <span class="hl-attribute">value</span>=<span class="hl-value">"jposjposjposjpos"</span><span class="hl-tag"> /&gt;</span>                       <a name="CO15-8"></a><span><img src="images/icons/callouts/8.png" alt="8" border="0"></span>
  <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"enabled-cipher"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA"</span><span class="hl-tag"> /&gt;</span>  <a name="CO15-9"></a><span><img src="images/icons/callouts/9.png" alt="9" border="0"></span>
  <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"enabled-cipher"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256"</span><span class="hl-tag"> /&gt;</span>
  <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"enabled-cipher"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384"</span><span class="hl-tag"> /&gt;</span>
  ...
  ...
<span class="hl-tag">&lt;/qrest&gt;</span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO15-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>Listening port</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO15-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>Transaction manager queue name (if no specific routes are present)</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO15-3"><span><img src="images/icons/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p><code class="literal">true</code> to enable TLS</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO15-4"><span><img src="images/icons/callouts/4.png" alt="4" border="0"></span></a> </p></td><td valign="top" align="left"><p>Set to <code class="literal">false</code> in order to allow self-signed certificates</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO15-5"><span><img src="images/icons/callouts/5.png" alt="5" border="0"></span></a> </p></td><td valign="top" align="left"><p><code class="literal">true</code> requires client-side certificates</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO15-6"><span><img src="images/icons/callouts/6.png" alt="6" border="0"></span></a> </p></td><td valign="top" align="left"><p>Keystore location</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO15-7"><span><img src="images/icons/callouts/7.png" alt="7" border="0"></span></a> </p></td><td valign="top" align="left"><p>Store password</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO15-8"><span><img src="images/icons/callouts/8.png" alt="8" border="0"></span></a> </p></td><td valign="top" align="left"><p>Key password</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO15-9"><span><img src="images/icons/callouts/9.png" alt="9" border="0"></span></a> </p></td><td valign="top" align="left"><p>Enabled ciphers (optional, defaults to <span class="emphasis"><em>all</em></span> if not present)</p></td></tr></table></div><p>Once the server receives an HTTP request, it creates a <code class="literal">org.jpos.transaction.Context</code>, places a reference to the http request
(under the Constant name <code class="literal">REQUEST</code> defined in the <code class="literal">org.jpos.qrest.Constants</code> enum), and to the session in the <code class="literal">SESSION</code>
constant (so that a <code class="literal">SendResponse</code> participant can reply) and send it off to the TransactionManager for processing.</p><p>If no specific <code class="literal">&lt;route&gt;</code> entries are present in the QRest configuration, incoming messages are sent to the <code class="literal">queue</code>
specified in the <code class="literal">queue</code> property, but you can override those with a route like this:</p><pre class="programlisting"><span class="hl-tag">&lt;qrest</span> <span class="hl-attribute">class</span>=<span class="hl-value">'org.jpos.qrest.RestServer'</span> <span class="hl-attribute">logger</span>=<span class="hl-value">'Q2'</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">'port'</span> <span class="hl-attribute">value</span>=<span class="hl-value">'8081'</span><span class="hl-tag"> /&gt;</span>
  <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">'queue'</span> <span class="hl-attribute">value</span>=<span class="hl-value">'TXNMGR'</span><span class="hl-tag"> /&gt;</span>
  ...
  ...
  <span class="hl-tag">&lt;route</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/v2/**"</span> <span class="hl-attribute">method</span>=<span class="hl-value">"GET"</span> <span class="hl-attribute">queue</span>=<span class="hl-value">"TXNMGR.2"</span><span class="hl-tag">/&gt;</span>                             <a name="CO16-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>
  <span class="hl-tag">&lt;route</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/v2/**"</span> <span class="hl-attribute">method</span>=<span class="hl-value">"POST"</span> <span class="hl-attribute">queue</span>=<span class="hl-value">"TXNMGR.2"</span><span class="hl-tag">/&gt;</span>                            <a name="CO16-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span>
<span class="hl-tag">&lt;/qrest&gt;</span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO16-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>All <code class="literal">GET</code> methods starting with <code class="literal">/v2</code> will get queued to <code class="literal">TXNMGR.2</code> instead of the
standard <code class="literal">TXNMGR</code> queue.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO16-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>Likewise, <code class="literal">POST</code> starting with <code class="literal">/v2</code> will get queued to the <code class="literal">TXNMGR.2</code> too.</p></td></tr></table></div><p>The TransactionManager is configured like this:</p><pre class="programlisting"><span class="hl-tag">&lt;txnmgr</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.transaction.TransactionManager"</span> <span class="hl-attribute">logger</span>=<span class="hl-value">"Q2"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"queue"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"TXNMGR"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"sessions"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"2"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"max-sessions"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"128"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"debug"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span>

  <span class="hl-tag">&lt;participant</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.qrest.participant.Router"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;route</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/jpos/myroute/{mypathparam}**"</span> <span class="hl-attribute">method</span>=<span class="hl-value">"GET"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mygroup1"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;route</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/jpos/myroute/{mypathparam}**"</span> <span class="hl-attribute">method</span>=<span class="hl-value">"POST"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mygroup2"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;route</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/jpos/fixedroute"</span> <span class="hl-attribute">method</span>=<span class="hl-value">"POST"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"..."</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;route</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/q2**"</span> <span class="hl-attribute">method</span>=<span class="hl-value">"GET"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"q2"</span><span class="hl-tag">/&gt;</span>                                 <a name="CO17-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>
  <span class="hl-tag">&lt;/participant&gt;</span>

  <span class="hl-tag">&lt;group</span> <span class="hl-attribute">name</span>=<span class="hl-value">"q2"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;participant</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.qrest.participant.Q2Info"</span><span class="hl-tag"> /&gt;</span>
  <span class="hl-tag">&lt;/group&gt;</span>
  ..
  ..
  <span class="hl-tag">&lt;group</span> <span class="hl-attribute">name</span>=<span class="hl-value">"group1"</span><span class="hl-tag">&gt;</span>
    ..
    ..
  <span class="hl-tag">&lt;/group&gt;</span>
  <span class="hl-tag">&lt;group</span> <span class="hl-attribute">name</span>=<span class="hl-value">"group2"</span><span class="hl-tag">&gt;</span>
    ..
    ..
  <span class="hl-tag">&lt;/group&gt;</span>
  <span class="hl-tag">&lt;participant</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.qrest.SendResponse"</span> <span class="hl-attribute">logger</span>=<span class="hl-value">"Q2"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/txnmgr&gt;</span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO17-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>This route is special, see below, route processing gets delegated to the Q2Info class</p></td></tr></table></div><p>In situations where multiple routes are defined at the QRest server configuration,
classes like <code class="literal">Q2Info</code> that internally process routes may need to know about the
prefix in use. This can be configured using the <code class="literal">prefix</code> property, i.e.:</p><pre class="programlisting">  <span class="hl-tag">&lt;group</span> <span class="hl-attribute">name</span>=<span class="hl-value">"q2"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;participant</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.qrest.participant.Q2Info"</span><span class="hl-tag">&gt;</span>
       <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"prefix"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/v2"</span><span class="hl-tag"> /&gt;</span>                                    <a name="CO18-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>
    <span class="hl-tag">&lt;/participant&gt;</span>
  <span class="hl-tag">&lt;/group&gt;</span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO18-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p><code class="literal">prefix</code> property should match the route&#8217;s prefix</p></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/admon/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>This old <a class="link" href="http://jpos.org/blog/2013/10/eating-our-own-dogfood/" target="_top">Blog Post</a> explained how
the TransactionManager could be used to implement REST based APIs. The QRest service can
be used to simplify a lot of Jetty/Server/Jersey boilerplate.</p></td></tr></table></div><p>The <code class="literal">Router</code> participant is actually a <code class="literal">GroupSelector</code> (from the TransactionManager&#8217;s standpoint)
and takes care of parsing and placing in the Context both <span class="emphasis"><em>Path Parameters</em></span> as well as
<span class="emphasis"><em>Query Parameters</em></span> (under the <code class="literal">PATHPARAMS</code> and <code class="literal">QUERYPARAMS</code> constants).</p><p>So if we define a route like this:</p><pre class="programlisting">  <span class="hl-tag">&lt;route</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/jpos/muxes/{muxname}"</span> <span class="hl-attribute">method</span>=<span class="hl-value">"GET"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"muxes"</span><span class="hl-tag">/&gt;</span></pre><p>and we fire <code class="literal">curl localhost:8081/jpos/muxes/ABC</code>, we&#8217;ll see that the Context will have a:</p><pre class="programlisting"> o.j.r.Constants.PATHPARAMS: {muxname=ABC}</pre><p>If we add query parameters to the call, i.e.: <code class="literal">curl "localhost:8081/jpos/muxes/XYZ?a=1&amp;b=2&amp;c=3"</code></p><p>the query parameters will be available under the <code class="literal">QUERYPARAMS</code> constant.</p><pre class="programlisting">      o.j.r.Constants.QUERYPARAMS: {a=[1], b=[2], c=[3]}
      o.j.r.Constants.PATHPARAMS: {muxname=XYZ}</pre><p>In addition to having the Router participant parse the route, one can define wildcard
handlers for some routes. This is the case of the <code class="literal">Q2Info</code> participant that&#8201;&#8212;&#8201;although work in progress&#8201;&#8212;&#8201;intends to provide useful information about a running Q2 system.</p><p>So anything that starts with <code class="literal">/q2</code> (or whatever one choose to set in the XML configuration) will be handled
by Q2Info.</p><p>Q2Info itself has its own routes, but those are hardcoded. So if we call <code class="literal">/q2/version</code>, we get output like this:</p><pre class="programlisting">{
  "version" : "jPOS 2.1.2-SNAPSHOT master/0a14e5c (2018-04-30 22:34:16 UTC)"
}</pre><p><code class="literal">/q2/uptime</code> would give us:</p><pre class="programlisting">{
  "uptime" : 601483
}</pre><p><code class="literal">/q2/diskspace</code>:</p><pre class="programlisting">{
  "diskspace" : {
    "free" : 616271151104,
    "usable" : 616009007104
  }
}</pre><p>Q2Info also provides now information about the MUXES, and we plan to expand it to provide
information about other components (servers, transaction manager, space).</p><p>i.e.: <code class="literal">curl localhost:8081/q2/muxes</code></p><pre class="programlisting">  "muxes" : [ {
    "name" : "clientsimulator-mux",
    "type" : "QMUX",
    "connected" : true,
    "rx" : 21,
    "tx" : 21,
    "txExpired" : 0,
    "txPending" : 0,
    "rxExpired" : 0,
    "rxPending" : 0,
    "rxUnhandled" : 0,
    "rxForwarded" : 0,
    "metrics" : {
      "all" : {
        "autoResize" : false,
        "highestTrackableValue" : 60000,
        "lowestDiscernibleValue" : 1,
        "numberOfSignificantValueDigits" : 2,
        "tag" : null,
        "maxValue" : 18,
        "minNonZeroValue" : 3,
        "totalCount" : 21,
        "estimatedFootprintInBytes" : 10752,
        "startTimeStamp" : 9223372036854775807,
        "endTimeStamp" : 0,
        "maxValueAsDouble" : 18.0,
        "mean" : 6.190476190476191,
        "stdDeviation" : 3.141413809994408,
        "neededByteBufferCapacity" : 11560,
        "minValue" : 3
      },
      "ok" : {
        "autoResize" : false,
        "highestTrackableValue" : 60000,
        "lowestDiscernibleValue" : 1,
        "numberOfSignificantValueDigits" : 2,
        "tag" : null,
        "maxValue" : 18,
        "minNonZeroValue" : 3,
        "totalCount" : 21,
        "estimatedFootprintInBytes" : 10752,
        "startTimeStamp" : 9223372036854775807,
        "endTimeStamp" : 0,
        "maxValueAsDouble" : 18.0,
        "mean" : 6.190476190476191,
        "stdDeviation" : 3.141413809994408,
        "neededByteBufferCapacity" : 11560,
        "minValue" : 3
      }
    },
    "last" : "2018-05-02 17:56:48",
    "idle" : 1306237
  } ]
}</pre><p>If we use the mux name as part of the URI, we get information for a particular MUX, i.e.:
<code class="literal">curl localhost:8081/q2/muxes/clientsimulator-mux</code></p><p>Here is a copy of the internal Q2Info route configuration:</p><pre class="programlisting">    <span class="hl-keyword">private</span> <span class="hl-keyword">void</span> initInternalRoutes() {
        routes.add(<span class="hl-keyword">new</span> Route&lt;&gt;(<span class="hl-string">"/q2/version**"</span>, <span class="hl-string">"GET"</span>,
            (t,s) -&gt; mapOf (<span class="hl-string">"version"</span>, q2Version())));
        routes.add(<span class="hl-keyword">new</span> Route&lt;&gt;(<span class="hl-string">"/q2/applicationVersion**"</span>, <span class="hl-string">"GET"</span>,
            (t,s) -&gt; mapOf(<span class="hl-string">"applicationVersion"</span>, Q2.getAppVersionString())));
        routes.add(<span class="hl-keyword">new</span> Route&lt;&gt;(<span class="hl-string">"/q2/instanceId**"</span>, <span class="hl-string">"GET"</span>,
            (t,s) -&gt; mapOf(<span class="hl-string">"instanceId"</span>, q2.getInstanceId())));
        routes.add(<span class="hl-keyword">new</span> Route&lt;&gt;(<span class="hl-string">"/q2/uptime**"</span>, <span class="hl-string">"GET"</span>,
            (t,s) -&gt; mapOf(<span class="hl-string">"uptime"</span>, q2.getUptime())));
        routes.add(<span class="hl-keyword">new</span> Route&lt;&gt;(<span class="hl-string">"/q2/started**"</span>, <span class="hl-string">"GET"</span>,
            (t,s) -&gt; mapOf(<span class="hl-string">"started"</span>, <span class="hl-keyword">new</span> Date(System.currentTimeMillis() -
            q2.getUptime()))));
        routes.add(<span class="hl-keyword">new</span> Route&lt;&gt;(<span class="hl-string">"/q2/diskspace**"</span>, <span class="hl-string">"GET"</span>,
            (t,s) -&gt; diskspace()));
        routes.add(<span class="hl-keyword">new</span> Route&lt;&gt;(<span class="hl-string">"/q2/muxes/{muxname}**"</span>, <span class="hl-string">"GET"</span>,
            (t,s) -&gt; muxInfo(t,s)));
        routes.add(<span class="hl-keyword">new</span> Route&lt;&gt;(<span class="hl-string">"/q2/muxes**"</span>, <span class="hl-string">"GET"</span>,
            (t,s) -&gt; muxes()));
    }</pre><p>If we just call <code class="literal">/q2</code>, it will output them all.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_static_and_dynamic_html_content"></a>8.1.1&nbsp;Static and Dynamic HTML content</h3></div></div></div><p>QRest is by no means a full fledged web server, but it can still serve static and
dynamic HTML pages using the <code class="literal">StaticContent</code> and <code class="literal">DynamicContent</code> participants.</p><p>Our qrest TXNMGR configuration can include static content like this:</p><pre class="programlisting"> <span class="hl-tag">&lt;participant</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.qrest.participant.Router"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;route</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/welcome.html"</span> <span class="hl-attribute">method</span>=<span class="hl-value">"GET"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"welcome"</span><span class="hl-tag"> /&gt;</span>
 <span class="hl-tag">&lt;/participant&gt;</span>

 <span class="hl-tag">&lt;group</span> <span class="hl-attribute">name</span>=<span class="hl-value">"welcome"</span><span class="hl-tag">&gt;</span>
   <span class="hl-tag">&lt;participant</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.qrest.participant.StaticContent"</span><span class="hl-tag">&gt;</span>
       <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"documentRoot"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"html"</span><span class="hl-tag"> /&gt;</span>
       <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"content"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"welcome.html"</span><span class="hl-tag"> /&gt;</span>
   <span class="hl-tag">&lt;/participant&gt;</span>
 <span class="hl-tag">&lt;/group&gt;</span></pre><p>So a call to <code class="literal">http://localhost:8080/welcome.html</code> will land in group named <code class="literal">welcome</code> that
will serve the file <code class="literal">html/welcome.html</code>. If instead of hitting <code class="literal">welcome.html</code> the user
tries anything else, it will fail with a 404 error.</p><p>In order to serve <span class="emphasis"><em>any</em></span> file inside the <code class="literal">documentRoot</code>, one can omit the property
<code class="literal">content</code>, i.e.:</p><pre class="programlisting"> <span class="hl-tag">&lt;participant</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.qrest.participant.Router"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;route</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/static/**"</span> <span class="hl-attribute">method</span>=<span class="hl-value">"GET"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"static"</span><span class="hl-tag"> /&gt;</span>
 <span class="hl-tag">&lt;/participant&gt;</span>

 <span class="hl-tag">&lt;group</span> <span class="hl-attribute">name</span>=<span class="hl-value">"static"</span><span class="hl-tag">&gt;</span>
   <span class="hl-tag">&lt;participant</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.qrest.participant.StaticContent"</span><span class="hl-tag">&gt;</span>
     <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"documentRoot"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"static"</span><span class="hl-tag"> /&gt;</span>
   <span class="hl-tag">&lt;/participant&gt;</span>
 <span class="hl-tag">&lt;/group&gt;</span></pre><p>In this case, any file in the <code class="literal">static</code> directory will be served, if present.</p><p>In addition to static files, QRest can render dynamic content using Freemarker.</p><p>The configuration looks like this:</p><pre class="programlisting"> <span class="hl-tag">&lt;participant</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.qrest.participant.Router"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;route</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/dynamic"</span> <span class="hl-attribute">method</span>=<span class="hl-value">"GET"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dynamic"</span><span class="hl-tag"> /&gt;</span>
 <span class="hl-tag">&lt;/participant&gt;</span>

 <span class="hl-tag">&lt;group</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dynamic"</span><span class="hl-tag">&gt;</span>
   <span class="hl-tag">&lt;participant</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.qrest.participant.DynamicContent"</span><span class="hl-tag">&gt;</span>
     <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"documentRoot"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"templates"</span><span class="hl-tag"> /&gt;</span>
     <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"content"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"dynamic.html"</span><span class="hl-tag"> /&gt;</span>                 <a name="CO19-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>
     <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"page.ctx.include"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"_include.html"</span><span class="hl-tag"> /&gt;</span>
     <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"page.ctx.myprop"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"myvalue"</span><span class="hl-tag"> /&gt;</span>
   <span class="hl-tag">&lt;/participant&gt;</span>
 <span class="hl-tag">&lt;/group&gt;</span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO19-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>For security, the template file has to be specified.</p></td></tr></table></div><p>The <code class="literal">DynamicContent</code> class uses a special qrest Constant <code class="literal">RENDER_CONTEXT</code> with a
map to be passed to the Freemarker template engine. Properties starting with the
prefix <code class="literal">page.ctx.</code> will be processed at participant initialization time and
handed to the template engine at process time. In this example, a property called
<code class="literal">include</code> and <code class="literal">myprop</code> will be available to the template engine, and can be used to write
a template like this:</p><pre class="programlisting">&lt;h1&gt; Dynamic Content &lt;/h1&gt;

Processing transaction ${id}           <a name="CO20-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>

&lt;#include include&gt;</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO20-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>The <span class="emphasis"><em>id</em></span> property is also provided by the <code class="literal">DynamicContent</code> participant using the
transaction id.</p></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_httpclient"></a>8.2&nbsp;HttpClient</h2></div></div></div><div class="informaltable"><table style="border: none;"><colgroup><col class="col_1"><col class="col_2"></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>What</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>HttpQuery participant</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>When</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Implemented during 2.2.6</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Who</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The jPOS Software team.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Where</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Directory modules/http-client</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Why</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Lightweight asynchronous Http Participant</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Status</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Experimental</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>License</strong></span></p></td><td style="" align="left" valign="top"><p><a class="link" href="#appendix_license" title="Appendix&nbsp;B.&nbsp;License">GNU Affero General Public License version 3</a></p></td></tr></tbody></table></div><p><b>Maven Coordinates.&nbsp;</b>
</p><pre class="programlisting">        <span class="hl-tag">&lt;dependency&gt;</span>
            <span class="hl-tag">&lt;groupId&gt;</span>org.jpos.ee<span class="hl-tag">&lt;/groupId&gt;</span>
            <span class="hl-tag">&lt;artifactId&gt;</span>jposee-http-client<span class="hl-tag">&lt;/artifactId&gt;</span>
            <span class="hl-tag">&lt;version&gt;</span>${jposee.version}<span class="hl-tag">&lt;/version&gt;</span>
        <span class="hl-tag">&lt;/dependency&gt;</span></pre><p>
</p><p>The <code class="literal">HttpQuery</code> participant has the following configuration properties:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">url</code>: a <span class="emphasis"><em>hardcoded</em></span> url for the request (it will be used as is, so it must be valid as per <code class="literal">java.net.URI</code>).
Can be overriden in the transaction context by the value of the <code class="literal">HTTP_URL</code> entry (or whatever the entry key has been changed to by the <code class="literal">urlName</code> configuration property).</li><li class="listitem"><code class="literal">connect-timeout</code>: milliseconds to wait for connection (default 10000)</li><li class="listitem"><code class="literal">timeout</code>: milliseconds to wait for an HTTP response (based on socket activity; default 15000)</li><li class="listitem"><code class="literal">contentType</code>: defaults to <code class="literal">"application/json"</code></li><li class="listitem"><code class="literal">httpHeader</code>: a <span class="emphasis"><em>repeatable</em></span> configuration property representing an HTTP request header, where the value is
of the form <code class="literal">header_name:header_value</code></li><li class="listitem"><code class="literal">redirect-strategy</code>: Sets the strategy to use when the remote HTTP server returns a redirect.
If the property is undefined, or has the "default" value, it will use Apache&#8217;s <code class="literal">DefaultRedirectStrategy</code>.
If the value is <code class="literal">lax</code> it will use <code class="literal">LaxRedirectStrategy</code> (see: <a class="link" href="https://hc.apache.org/httpcomponents-client-ga/tutorial/html/fundamentals.html" target="_top">https://hc.apache.org/httpcomponents-client-ga/tutorial/html/fundamentals.html</a>)</li><li class="listitem"><code class="literal">preemptiveAuth</code>: if doing Basic Authentication (by presence of context value), do it on the first request (default <code class="literal">false</code>)</li><li class="listitem"><code class="literal">responseBodyOnError</code>: should an HTTP response body be included for responses with error
status code? (<code class="literal">boolean</code>, default <code class="literal">false</code>);</li><li class="listitem"><code class="literal">maxConnections</code>: set the maximum number of concurrent client connections; if unset it will default to <span class="strong"><strong>25</strong></span> concurrent connetions.+
<span class="strong"><strong>NOTE:</strong></span> This value is overridable by the <code class="literal">http.maxConnections</code> Java system property, and it applies globally to the whole process.</li></ul></div><p>In addition, <code class="literal">HttpQuery</code> picks a few <span class="emphasis"><em>configurable</em></span> entries from the <code class="literal">Context</code>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">HTTP_URL</code>: with the remote host&#8217;s URL</li><li class="listitem"><code class="literal">HTTP_METHOD</code>: currently one of <code class="literal">GET</code>, <code class="literal">POST</code>, <code class="literal">PUT</code></li><li class="listitem"><code class="literal">HTTP_VERSION</code>: allows forcing an older version. Defaults to JVM default.</li><li class="listitem"><code class="literal">HTTP_PARAMS</code>: the <span class="emphasis"><em>query string</em></span> (must be correctly encoded), and it&#8217;s appended to the previously
computed URL, with a <code class="literal">?</code> separating both parts</li><li class="listitem"><code class="literal">HTTP_REQUEST</code>: a request payload (i.e., JSON String)</li><li class="listitem"><code class="literal">HTTP_CONTENT_TYPE</code>: overrides the one given with the <code class="literal">contentType</code> configuration property</li><li class="listitem"><p class="simpara"><code class="literal">HTTP_HEADERS</code>: HTTP request headers that will be dynamically added to whatever was configured by the
set of <code class="literal">httpHeader</code> properties.  The value of the <code class="literal">HTTP_HEADERS</code> entry in the <code class="literal">Context</code> can be of three different
types:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">a <code class="literal">String[]</code> where each item follows the <code class="literal">header_name:header_value</code> syntax</li><li class="listitem">a <code class="literal">List&lt;String&gt;</code> where each item follows the <code class="literal">header_name:header_value</code> syntax</li><li class="listitem">a <code class="literal">Map&lt;String,String&gt;</code> where the keys represent <span class="emphasis"><em>header names</em></span>, and the values the corresponding <span class="emphasis"><em>header values</em></span></li></ul></div></li><li class="listitem"><code class="literal">.HTTP_BASIC_AUTHENTICATION</code>: A String of the form <code class="literal">&lt;username&gt;:&lt;password&gt;</code> used for HTTP Basic Authentication.
<span class="strong"><strong>NOTE:</strong></span> The default <code class="literal">Context</code> name starts with a period (<code class="literal">.</code>), meaning it will be hidden in the logs during a context dump.</li></ul></div><p>After successful completion (which may include normal HTTP errors such as <code class="literal">404</code> or <code class="literal">500</code>), <code class="literal">HttpQuery</code> stores the result
back into the <code class="literal">Context</code>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">HTTP_STATUS</code>: integer with the HTTP status code.</li><li class="listitem"><code class="literal">HTTP_RESPONSE</code>: a <code class="literal">String</code> with the response body, if any.</li></ul></div><p>Here is a sample configuration taking all the defauts:</p><pre class="programlisting">  <span class="hl-tag">&lt;participant</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.http.client.HttpQuery"</span><span class="hl-tag"> /&gt;</span></pre><p>The default names used above can be overridden, e.g.:</p><pre class="programlisting"><span class="hl-tag">&lt;participant</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.http.client.HttpQuery"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"urlName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"MY_HTTP_URL"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"methodName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"MY_HTTP_METHOD"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"versionName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"MY_HTTP_VERSION"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"paramsName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"MY_HTTP_PARAMS"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"headersName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"MY_HTTP_HEADERS"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"requestName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"MY_HTTP_REQUEST"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"responseName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"MY_HTTP_RESPONSE"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"responseStatusName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"MY_HTTP_STATUS"</span><span class="hl-tag"> /&gt;</span>

    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"contentType"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"application/json"</span><span class="hl-tag"> /&gt;</span>                  <a name="CO21-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"contentTypeName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"MY_HTTP_CONTENT_TYPE"</span><span class="hl-tag"> /&gt;</span>          <a name="CO21-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span>

    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"basicAuthenticationName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">".MY_BASIC_CREDENTIALS"</span><span class="hl-tag"> /&gt;</span> <a name="CO21-3"></a><span><img src="images/icons/callouts/3.png" alt="3" border="0"></span>
  <span class="hl-tag">&lt;/participant&gt;</span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO21-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>Content-Type defaults to <code class="literal">application/json</code></p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO21-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>Name of the Context variable where user can <span class="strong"><strong>override</strong></span> the default content type.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO21-3"><span><img src="images/icons/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>We recommend that the context key starts with a period, so it will be a hidden entry during a context dump in the logs.</p></td></tr></table></div><p>Here is a sample use:</p><pre class="programlisting">    TransactionManager mgr = ... <span class="hl-comment">// somehow get a reference to a TransactionManager</span>
    Context ctx = <span class="hl-keyword">new</span> Context();
    ctx.put(<span class="hl-string">"HTTP_URL"</span>, <span class="hl-string">"http://localhost/q2/version"</span>);
    ctx.put(<span class="hl-string">"HTTP_METHOD"</span>, <span class="hl-string">"GET"</span>);
    mgr.queue(ctx); <a name="CO22-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>
    Integer sc = ctx.get (<span class="hl-string">"HTTP_STATUS"</span>, <span class="hl-number">10000L</span>); <a name="CO22-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span>
    String response = ctx.get (<span class="hl-string">"HTTP_RESPONSE"</span>);</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO22-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>Enqueue <code class="literal">ctx</code> to be processed by <code class="literal">mgr</code> that has an <code class="literal">HttpQuery</code> in its list of participants.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO22-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>Wait up to 10 seconds for a response</p></td></tr></table></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="_tools"></a>9.&nbsp;Tools</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_freemarker_decorator"></a>9.1&nbsp;Freemarker Decorator</h2></div></div></div><div class="informaltable"><table style="border: none;"><colgroup><col class="col_1"><col class="col_2"></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>What</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>This module contains a text processor which decorates deployable descriptors for Q2.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>When</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Available in all versions of jPOS-EE since v2.0.0.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Who</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The jPOS.org team.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Where</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Directory modules/freemarker-decorator available in git repository at github.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Why</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Install this module to better parameterize your applications.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Status</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Stable.</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>License</strong></span></p></td><td style="" align="left" valign="top"><p>The jPOS-EE code related to this module is licensed under the
                   <a class="link" href="#appendix_license" title="Appendix&nbsp;B.&nbsp;License">GNU Affero General Public License version 3</a>.
                   FreeMarker &reg; itself is released under the BSD
                   license. See <a class="link" href="http://freemarker.sourceforge.net/docs/app_license.html" target="_top">http://freemarker.sourceforge.net/docs/app_license.html</a> for
                   details and up-to-date information.</p></td></tr></tbody></table></div><p><b>Maven Coordinates.&nbsp;</b>
</p><pre class="programlisting">        <span class="hl-tag">&lt;dependency&gt;</span>
            <span class="hl-tag">&lt;groupId&gt;</span>org.jpos.ee<span class="hl-tag">&lt;/groupId&gt;</span>
            <span class="hl-tag">&lt;artifactId&gt;</span>jposee-freemarker-decorator<span class="hl-tag">&lt;/artifactId&gt;</span>
            <span class="hl-tag">&lt;version&gt;</span>${jposee.version}<span class="hl-tag">&lt;/version&gt;</span>
        <span class="hl-tag">&lt;/dependency&gt;</span></pre><p>
</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_activation_steps"></a>9.1.1&nbsp;Activation steps</h3></div></div></div><p>This module remains dormant unless it finds its configuration resource.</p><p>In order to activate this module, you need to create a resource in your project residing at
<span class="emphasis"><em>META-INF/org/jpos/config/Q2-decorator.properties</em></span> of your classpath (not the filesystem!).</p><p>This file should contain two properties:</p><pre class="programlisting"><span class="hl-attribute">config-decorator-class</span>=org.jpos.q2.freemarker.FreemarkerDecorationProvider    <a name="CO23-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>
<span class="hl-attribute">config-files</span>=cfg/config.properties                                            <a name="CO23-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO23-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>This property tells Q2 to use the FreemarkerDecoratorProvider as its decorator.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO23-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>This property defines a comma separated list of files which will be used as
configuration files.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_introduction_2"></a>9.1.2&nbsp;Introduction</h3></div></div></div><p>A typical jPOS-EE application has this standard directory structure:</p><pre class="literallayout">.
|-- cfg
|   |-- README.txt
|   `-- db.properties
|-- deploy
|   |-- 00_logger.xml
|   `-- 99_sysmon.xml
|-- lib
|-- log
|   `-- q2.log
`-- q2.jar</pre><p>Whatever descriptor you install inside the <span class="emphasis"><em>deploy</em></span> directory gets immediately deployed.
Once this descriptor is removed, it gets undeployed.</p><p>Many of these descriptors require information specific to the target environment, such as
hostnames, ports, ports to listen to, etc. Wouldn&#8217;t it be great if you could define all of
these in a single location?</p><p>The FrameMarker decorator processes <span class="strong"><strong>ANY</strong></span> descriptor in memory giving Q2 the resulting text after processing.
This opens a myriad of opportunities, such as declaring macros, and executing them :)</p><p>Let&#8217;s see an example! Let&#8217;s assume you have a file <span class="emphasis"><em>cfg/config.properties</em></span> in your runtime directory that looks like this:</p><pre class="programlisting">###### GENERAL INFO
<span class="hl-attribute">NODE </span>= NODE001
######  Environment
<span class="hl-attribute">env</span>=DEV
######  Ports we listens to
<span class="hl-attribute">server_listen_port </span>= 9999
######  Target host information
<span class="hl-attribute">myBankHostPrimary</span>=app.yourbank.com
<span class="hl-attribute">myBankPortPrimary</span>=2000
###### DEBUG STUFF
<span class="hl-attribute">debugParticipant</span>=true</pre><p>and we had a deployable file: <span class="emphasis"><em>deploy/10_mybank_channel.xml</em></span></p><pre class="programlisting"><span class="hl-tag">&lt;channel-adaptor</span>
      <span class="hl-attribute">name</span>=<span class="hl-value">"mybank-channel-adaptor-pri"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.q2.iso.ChannelAdaptor"</span> <span class="hl-attribute">logger</span>=<span class="hl-value">"Q2"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;channel</span>
          <span class="hl-attribute">name</span>=<span class="hl-value">"mybank-channel-pri"</span>
          <span class="hl-attribute">packager</span>=<span class="hl-value">"org.jpos.iso.packager.GenericPackager"</span>
          <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.iso.channel.CSChannel"</span> <span class="hl-attribute">logger</span>=<span class="hl-value">"Q2"</span>
          <span class="hl-attribute">realm</span>=<span class="hl-value">"channel.mybank"</span><span class="hl-tag">&gt;</span>

        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"timeout"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"3600000"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"host"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${mybankHostPrimary}"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"port"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${mybankPortPrimary}"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"packager-config"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"cfg/packager/mybank.xml"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"keep-alive"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/channel&gt;</span>

    <span class="hl-tag">&lt;in&gt;</span>from-mybank-pri<span class="hl-tag">&lt;/in&gt;</span>
    <span class="hl-tag">&lt;out&gt;</span>to-mybank-pri<span class="hl-tag">&lt;/out&gt;</span>
    <span class="hl-tag">&lt;reconnect-delay&gt;</span>5000<span class="hl-tag">&lt;/reconnect-delay&gt;</span>
<span class="hl-tag">&lt;/channel-adaptor&gt;</span></pre><p>As you can see, we externalized the deployable&#8217;s configurable over to a central location.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/admon/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>If you change the settings in the configuration file, you still need to redeploy the deployable (touch it).</p></td></tr></table></div><p>But wait, there&#8217;s more! FreeMarker being a macro processor, brings a lot of nice things for things like TransactionManager descriptors:</p><p>For example, ever wanted to have conditional participants?</p><pre class="programlisting">    [#if debugParticipant == 'true']
    <span class="hl-tag">&lt;participant</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.transaction.Debug"</span> <span class="hl-attribute">logger</span>=<span class="hl-value">"Q2"</span> <span class="hl-attribute">realm</span>=<span class="hl-value">"debug"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"checkpoint"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"debug"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/participant&gt;</span>
    [/#if]</pre><p>Or maybe define a macro for things you&#8217;ll use over and over?</p><pre class="programlisting">    [#macro OutputToSyslog msg]
    <span class="hl-tag">&lt;participant</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycorp.txn.OutputToSyslog"</span>
        <span class="hl-attribute">logger</span>=<span class="hl-value">"Q2"</span> <span class="hl-attribute">realm</span>=<span class="hl-value">"output-to-syslog"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"node"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${NODE}"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"message"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${msg}"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/participant&gt;</span>
    [/#macro]

    <span class="hl-comment">&lt;!-- And then invoke it --&gt;</span>
    <span class="hl-tag">&lt;group</span> <span class="hl-attribute">name</span>=<span class="hl-value">"myGroup"</span><span class="hl-tag">&gt;</span>
        [@OutputToSyslog msg="This is a test"/]
        .... Do some other stuff
    <span class="hl-tag">&lt;/group&gt;</span></pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_groovy_support"></a>9.2&nbsp;Groovy Support</h2></div></div></div><div class="informaltable"><table style="border: none;"><colgroup><col class="col_1"><col class="col_2"></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>What</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Add Groovy support.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>When</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Since 2.2.1.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Who</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The jPOS.org team.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Where</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Directory modules/groovy.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Why</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Allows seamless integration with Groovy from Q2 applications.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Status</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Experimental.</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>License</strong></span></p></td><td style="" align="left" valign="top"><p><a class="link" href="#appendix_license" title="Appendix&nbsp;B.&nbsp;License">GNU Affero General Public License version 3</a></p></td></tr></tbody></table></div><p><b>Maven Coordinates.&nbsp;</b>
</p><pre class="programlisting">        <span class="hl-tag">&lt;dependency&gt;</span>
            <span class="hl-tag">&lt;groupId&gt;</span>org.jpos.ee<span class="hl-tag">&lt;/groupId&gt;</span>
            <span class="hl-tag">&lt;artifactId&gt;</span>jposee-groovy<span class="hl-tag">&lt;/artifactId&gt;</span>
            <span class="hl-tag">&lt;version&gt;</span>${jposee.version}<span class="hl-tag">&lt;/version&gt;</span>
        <span class="hl-tag">&lt;/dependency&gt;</span></pre><p>
</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/admon/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Although not strictly required by this particular QBean Groovy adaptor, the <code class="literal">jposee-groovy</code>
module also includes the handy <code class="literal">groovy-sql</code> dependency.</p></td></tr></table></div><p>In all the modules described below, the <code class="literal">src</code> attribute honors the <code class="literal">${...}</code> syntax.
So, you could have, for example, <code class="literal">src="${groovy.scriptdir}/MyGroovyScript.groovy</code>.</p><p>You can explicitly resolve the value from a system property using <code class="literal">$sys{...}</code>, or from
the environment using <code class="literal">$env{...}</code>.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_groovy_qbean"></a>9.2.1&nbsp;Groovy QBean</h3></div></div></div><p>In jPOS 2.0.7 (and later), <code class="literal">QFactory.properties</code> maps the <code class="literal">groovy</code> keyword to
<code class="literal">org.jpos.q2.qbean.Groovy</code> so one can use a simple configuration like this:</p><pre class="programlisting"><span class="hl-tag">&lt;groovy</span> <span class="hl-attribute">logger</span>=<span class="hl-value">'Q2'</span> <span class="hl-attribute">src</span>=<span class="hl-value">'deploy/test.groovy'</span><span class="hl-tag"> /&gt;</span></pre><p>or</p><pre class="programlisting"><span class="hl-tag">&lt;groovy</span> <span class="hl-attribute">logger</span>=<span class="hl-value">'Q2'</span><span class="hl-tag">&gt;</span><span class="hl-tag">&lt;![CDATA[</span>
  // ... your groovy code here
<span class="hl-tag">]]&gt;</span><span class="hl-tag">&lt;/groovy&gt;</span></pre><p>The following variables are automatically exposed:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">log</code> has a refererence to the QBean&#8217;s <code class="literal">Log</code> object</li><li class="listitem"><code class="literal">qbean</code> has a reference to the running QBean</li><li class="listitem"><code class="literal">cfg</code> has a reference to the QBean&#8217;s configuration</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_groovyparticipant"></a>9.2.2&nbsp;GroovyParticipant</h3></div></div></div><p>The module provides a <code class="literal">org.jpos.transaction.participant.GroovyParticipant</code> class, which allows
the writing TransactionManager <code class="literal">TransactionParticipant</code>'s in Groovy.</p><p>Separate scripts can be specified for the <code class="literal">prepare</code>, <code class="literal">prepare-for-abort</code>, <code class="literal">commit</code>, and <code class="literal">abort</code> phases
of the participant.</p><p>The <code class="literal">prepare</code> and <code class="literal">prepare-for-abort</code> methods are expected to return an <code class="literal">Integer</code> object
with the TransactionManager standard result values (<code class="literal">PREPARED</code>, <code class="literal">ABORTED</code>, etc.).</p><p>The Groovy script code can be placed as part of the element&#8217;s content (a CDATA section
is recommended), or in an external file pointed to by the <code class="literal">src</code> attribute. We also
recommend adding a <code class="literal">realm</code> attribute to identify errors in the logs, especially if you
have several instances of <code class="literal">GroovyParticipant</code> in your transaction manager.</p><p>The following variables will be bound to each Groovy script&#8217;s <code class="literal">Binding</code>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><span class="strong"><strong>id</strong></span> - the transaction <code class="literal">int id</code> passed to the participant&#8217;s method</li><li class="listitem"><span class="strong"><strong>ctx</strong></span> - the transaction <code class="literal">Serializable ctx</code> passed to the participant&#8217;s method</li><li class="listitem"><span class="strong"><strong>log</strong></span> - a reference to <code class="literal">this</code> instance (since this class extends <code class="literal">org.jpos.util.Log</code>)</li><li class="listitem"><span class="strong"><strong>cfg</strong></span> - this <code class="literal">TransactionParticipant</code>'s <code class="literal">Configuration</code> properties</li><li class="listitem"><span class="strong"><strong>tm</strong></span> - a reference to the <code class="literal">TransactionManager</code>'s executing this transaction</li></ul></div><p>By default, scripts are pre-compiled by a <code class="literal">GroovyClassLoader</code>. If you want the script
to be evaluated on each run, then set the <code class="literal">compiled</code> property to <code class="literal">false</code>.</p><p>If your script depends on other scripts, you can add one or more <code class="literal">classpath</code> properties.</p><p>Add a transaction participant like this:</p><pre class="programlisting"><span class="hl-tag">&lt;participant</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.transaction.participant.GroovyParticipant"</span>
             <span class="hl-attribute">logger</span>=<span class="hl-value">"Q2"</span> <span class="hl-attribute">realm</span>=<span class="hl-value">"groovy-test"</span><span class="hl-tag">&gt;</span>

  <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"classpath"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"cfg/scripts"</span><span class="hl-tag"> /&gt;</span>

  <span class="hl-tag">&lt;prepare</span> <span class="hl-attribute">src</span>=<span class="hl-value">"deploy/prepare.groovy"</span><span class="hl-tag"> /&gt;</span>
  <span class="hl-tag">&lt;commit</span> <span class="hl-attribute">src</span>=<span class="hl-value">"deploy/commit.groovy"</span><span class="hl-tag"> /&gt;</span>
  <span class="hl-tag">&lt;abort&gt;</span>
    <span class="hl-tag">&lt;![CDATA[</span>
        import static org.jpos.transaction.TransactionConstants.*
        // ... embedded script
        return PREPARED
    <span class="hl-tag">]]&gt;</span>
  <span class="hl-tag">&lt;/abort&gt;</span>
<span class="hl-tag">&lt;/participant&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_groovyrequestlistener"></a>9.2.3&nbsp;GroovyRequestListener</h3></div></div></div><p>The module provides a <code class="literal">org.jpos.groovy.GroovyRequestListener</code> class, which allows the writing of
<code class="literal">org.jpos.iso.ISORequestListener</code>'s in Groovy.</p><p>The script&#8217;s return value will be used as the return value from the <code class="literal">process</code> method.
A non-null return value is interpreted to be <span class="emphasis"><em>true-ish</em></span>. An explicit <code class="literal">null</code> return is interpreted to be <code class="literal">false</code>.
A <code class="literal">boolean/Boolean</code> value will be returned as such.</p><p>The Groovy script code can be given as text within the <code class="literal">&lt;script&gt;</code> element (a <code class="literal">CDATA</code> section
is recommended), or in an external file pointed to by the <code class="literal">src</code> attribute. The <code class="literal">src</code> path attribute will
override the text /<code class="literal">CDATA</code> script (to avoid confusion, only one of the options should be used).</p><p>By default, scripts are pre-compiled by a <code class="literal">GroovyClassLoader</code>. If you want the script
to be evaluated each time, then set the <code class="literal">compiled</code> property to <code class="literal">false</code>.</p><p>As a convenience, a comma-separated list of <span class="emphasis"><em>ISO-8583</em></span> MTI&#8217;s can be given in the <code class="literal">whitelist</code> property.
If given, the script will be called <span class="emphasis"><em>only</em></span> for requests having those MTI&#8217;s. For requests not in the
whitelist, the <code class="literal">ISORequestListener#process(ISOSource, ISOMsg)</code> method will return <code class="literal">false</code>, so the
request can be handled by another <code class="literal">ISORequestListener</code> down the line.</p><p>The following variables will be bound to the Groovy script&#8217;s <code class="literal">Binding</code>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><span class="strong"><strong>message</strong></span> - the <code class="literal">ISOMsg</code> for this request</li><li class="listitem"><span class="strong"><strong>source</strong></span> - the <code class="literal">ISOSource</code> for message</li><li class="listitem"><span class="strong"><strong>log</strong></span> - a reference to <code class="literal">this</code> instance (since this class extends <code class="literal">org.jpos.util.Log</code>)</li><li class="listitem"><span class="strong"><strong>cfg</strong></span> - this <code class="literal">ISORequestListener's</code> <code class="literal">Configuration</code> properties</li><li class="listitem"><span class="strong"><strong>xmlCfg</strong></span> - this <code class="literal">ISORequestListener's</code> configuration <code class="literal">Element</code></li></ul></div><p>We also recommend adding a <code class="literal">realm</code> attribute to the <code class="literal">&lt;request-listener&gt;</code> element, to identify errors in the logs.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_examples"></a>Examples:</h4></div></div></div><p>A Groovy script given as embedded text in a <code class="literal">CDATA</code> section. The script will be pre-compiled, and called
only for requests of the MTI&#8217;s given in the <code class="literal">whitelist</code> property.</p><pre class="programlisting"><span class="hl-tag">&lt;request-listener</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.groovy.GroovyRequestListener"</span>
                  <span class="hl-attribute">logger</span>=<span class="hl-value">"Q2"</span> <span class="hl-attribute">realm</span>=<span class="hl-value">"groovy-test-one"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"whitelist"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"0100, 0420"</span><span class="hl-tag"> /&gt;</span>
  <span class="hl-tag">&lt;script&gt;</span>
    <span class="hl-tag">&lt;![CDATA[</span>
        // ... embedded script
    <span class="hl-tag">]]&gt;</span>
  <span class="hl-tag">&lt;/script&gt;</span>
<span class="hl-tag">&lt;/request-listener&gt;</span></pre><p>A Groovy script given in an external file. The <code class="literal">compiled</code> property is set to <code class="literal">false</code>, so the script
will be interpreted and evaluated for each request. The script will be called for <span class="emphasis"><em>all</em></span> MTI&#8217;s.</p><pre class="programlisting"><span class="hl-tag">&lt;request-listener</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.groovy.GroovyRequestListener"</span>
                  <span class="hl-attribute">logger</span>=<span class="hl-value">"Q2"</span> <span class="hl-attribute">realm</span>=<span class="hl-value">"groovy-test-two"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"compiled"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"false"</span><span class="hl-tag"> /&gt;</span>
  <span class="hl-tag">&lt;script</span> <span class="hl-attribute">src</span>=<span class="hl-value">"../cfg/reqlistener2.groovy"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/request-listener&gt;</span></pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_groovygroupselector"></a>9.2.4&nbsp;GroovyGroupSelector</h3></div></div></div><p>The module also provides a <code class="literal">org.jpos.transaction.participant.GroovyGroupSelector</code> class, which allows the writing of
<code class="literal">GroupSelector</code>'s in Groovy.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_examples_2"></a>Examples:</h4></div></div></div><pre class="programlisting"><span class="hl-tag">&lt;participant</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.transaction.participant.GroovyGroupSelector"</span> <span class="hl-attribute">logger</span>=<span class="hl-value">"Q2"</span>
    <span class="hl-attribute">realm</span>=<span class="hl-value">"groovy-select"</span><span class="hl-tag">&gt;</span>

        <span class="hl-tag">&lt;select</span> <span class="hl-attribute">src</span>=<span class="hl-value">"deploy/select.groovy"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"0800"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"network"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"0200"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"supported"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/participant&gt;</span></pre><p>A Groovy script given in an external file.</p><pre class="programlisting">import org.jpos.iso.ISOMsg;
import org.jpos.transaction.Context;
import org.jpos.transaction.ContextConstants;

ISOMsg m = (ISOMsg) ((Context)ctx).get (ContextConstants.REQUEST.toString());
String groups = cfg.get (m.getMTI(), null);
return groups;</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cryptoservice"></a>9.3&nbsp;Crypto Service</h2></div></div></div><p>The <code class="literal">cryptoservice</code> module uses AES-256 to encrypt sensitive data, such as
primary account numbers and protects the encryption key using PGP.</p><p>At start-up time, and at regular intervals, the crypto service generates a
new AES-256 key, encrypts it using PGP using one or more recipient ids (custodians),
and stores the resulting encrypted message in the sysconfig table, using the
"key." prefix, and a unique key UUID, i.e.:</p><pre class="screen">id: key.f55fe6ec-ed9e-47a1-a0fe-c63dcbf128cb
value:
-----BEGIN PGP MESSAGE-----
Version: BCPG v1.56

hQEMA6Nw6GrTY6BpAQgAs1pUIK3n2FkMyNmfxSZgpPMNFKz39TcfExiwDRtuw+Zg
wRgFw86SJiL1BB+IE+mPAeCz4hrUkzliiu/760NiXHQysIasWEvUZZqFRA+ecNrk
zARgB8vgGTNgxPHoYPafVD5TrxY9LdRpJcO//Wm2fEVw0xc4Q7vxbH7e9gDQfiuA
gcNYk96rVCdbZFKxyMC8fpM9ng6M4V9lxp5TXihzJQEKHWavctIrU2rBolE1WCY2
Oobs1hELW4rfMpVwfGQDtxcFSNDYkd9IO/WnFTtTAxGHs0u1/miRVxNHadLINdke
wXx6au9vq12tqlYaJY+BAEtJaAInwwT5/irHj5dlwtJ0AW2wO3Mwh+A+pGJvSd2T
xyep1pNtm7tMbisZyms0TiGz+6BX6F5ZKCG5UuvsIvTHd/VLp2uajE5NVPe92Y1F
lLbbMyUfxzBwNhwhdfOEWwRAmrt7AbMyAQHUCZAXgwXn7SXsdh8TTzLMsssViD9+
h7lfP9w=
=YyZk
-----END PGP MESSAGE-----</pre><p>The key is used to encrypt subsequent data for a given period of time
(defaults to one day) until a new key is automatically generated.</p><p>Here is a sample usage:</p><pre class="programlisting">   <span class="hl-keyword">private</span> <span class="hl-keyword">void</span> encryptCardData (TLCapture tl, Card card)      <a name="CO24-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>
      <span class="hl-keyword">throws</span> Exception {
        Map&lt;String,String&gt; m = <span class="hl-keyword">new</span> HashMap&lt;&gt;();
        m.put (<span class="hl-string">"P"</span>, card.getPan());
        m.put (<span class="hl-string">"E"</span>, card.getExp());
        SecureData sd = getCryptoService().aesEncrypt(         <a name="CO24-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span>
           Serializer.serializeStringMap(m)
        );
        tl.setKid(sd.getId());                                 <a name="CO24-3"></a><span><img src="images/icons/callouts/3.png" alt="3" border="0"></span>
        tl.setSecureData(sd.getEncoded());                     <a name="CO24-4"></a><span><img src="images/icons/callouts/4.png" alt="4" border="0"></span>
    }</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO24-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>TLCapture in this example is a general purpose capture table.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO24-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p><code class="literal">getCryptoService()</code> just locates the <code class="literal">CryptoService</code> using the <code class="literal">NameRegistrar</code></p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO24-3"><span><img src="images/icons/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p><code class="literal">kid</code> stands for Key ID, we store the key UUID here</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO24-4"><span><img src="images/icons/callouts/4.png" alt="4" border="0"></span></a> </p></td><td valign="top" align="left"><p><code class="literal">secureData</code> is a general purpose blob</p></td></tr></table></div><p>The crypto service can be configured using a QBean descriptor like this:</p><pre class="programlisting"><span class="hl-tag">&lt;crypto-service</span> <span class="hl-attribute">class</span>=<span class="hl-value">'org.jpos.crypto.CryptoService'</span> <span class="hl-attribute">logger</span>=<span class="hl-value">'Q2'</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"custodian"</span> <span class="hl-attribute">value</span>=<span class="hl-value">'demo@jpos.org'</span><span class="hl-tag"> /&gt;</span>               <a name="CO25-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"pubkeyring"</span> <span class="hl-attribute">value</span>=<span class="hl-value">'cfg/keyring.pub'</span><span class="hl-tag"> /&gt;</span>            <a name="CO25-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"privkeyring"</span> <span class="hl-attribute">value</span>=<span class="hl-value">'cfg/keyring.priv'</span><span class="hl-tag"> /&gt;</span>          <a name="CO25-3"></a><span><img src="images/icons/callouts/3.png" alt="3" border="0"></span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"lazy"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"false"</span><span class="hl-tag"> /&gt;</span>                            <a name="CO25-4"></a><span><img src="images/icons/callouts/4.png" alt="4" border="0"></span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"keylength"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"256"</span><span class="hl-tag"> /&gt;</span>                         <a name="CO25-5"></a><span><img src="images/icons/callouts/5.png" alt="5" border="0"></span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"duration"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"86400000"</span><span class="hl-tag"> /&gt;</span>                     <a name="CO25-6"></a><span><img src="images/icons/callouts/6.png" alt="6" border="0"></span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"ttl"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"3600000"</span><span class="hl-tag"> /&gt;</span>                           <a name="CO25-7"></a><span><img src="images/icons/callouts/7.png" alt="7" border="0"></span>
    <span class="hl-tag">&lt;ks-provider</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.crypto.SysConfigCryptoServiceKeyStoreProvider"</span><span class="hl-tag"> /&gt;</span> <a name="CO25-8"></a><span><img src="images/icons/callouts/8.png" alt="8" border="0"></span>
<span class="hl-tag">&lt;/crypto-service&gt;</span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO25-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>custodian PGP id, there can be many <code class="literal">custodian</code> entries.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO25-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>path to the public keyring.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO25-3"><span><img src="images/icons/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>path to the password-protected private keyring.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO25-4"><span><img src="images/icons/callouts/4.png" alt="4" border="0"></span></a> </p></td><td valign="top" align="left"><p>if lazy=true, a key is generated the first time we call <code class="literal">aesEncrypt</code>, otherwise, a new one is created at service start.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO25-5"><span><img src="images/icons/callouts/5.png" alt="5" border="0"></span></a> </p></td><td valign="top" align="left"><p>key length defaults to 256. Can be reduced if AES-256 is not supported by the JVM due to export restrictions.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO25-6"><span><img src="images/icons/callouts/6.png" alt="6" border="0"></span></a> </p></td><td valign="top" align="left"><p>key duration</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO25-7"><span><img src="images/icons/callouts/7.png" alt="7" border="0"></span></a> </p></td><td valign="top" align="left"><p>internal key cache time-to-live (in millis).</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO25-8"><span><img src="images/icons/callouts/8.png" alt="8" border="0"></span></a> </p></td><td valign="top" align="left"><p>CryptoServiceKeyStoreProvider class configuration.</p></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/admon/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>We currently support two CryptoServiceKeyStoreProvider classes:
<code class="literal">SysConfigCryptoServiceKeyStoreProvider</code> and <code class="literal">JESpaceCryptoServiceKeyStoreProvider</code></p></td></tr></table></div><p>This allows jPOS nodes to encrypt data securely without storing the encryption key to disk.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/admon/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The transient encryption key is still in memory, so core dumps and swap should be
disabled at the operating system level. This approach is still more secure
than obfuscating encryption keys.</p></td></tr></table></div><p>Decryption&#8201;&#8212;&#8201;that can of course run in a different node, at a different time&#8201;&#8212;&#8201;requires
access to the private keyring, with its optional password. Said password can be entered
manually, obtained from a remote service or HSM, etc. and it&#8217;s a two step process.</p><p>First the key has to be <span class="emphasis"><em>loaded</em></span> into memory, using the <code class="literal">loadKey</code> method. Once the key
is loaded, the <code class="literal">aesDecrypt</code> can be called.</p><p>These are the method&#8217;s signatures:</p><pre class="programlisting"> <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> loadKey (String jobId, String keyId, <span class="hl-keyword">char</span>[] password) <span class="hl-keyword">throws</span> Exception;
 <span class="hl-keyword">public</span> <span class="hl-keyword">byte</span>[] aesDecrypt (String jobId, String keyId, <span class="hl-keyword">byte</span>[] encoded) <span class="hl-keyword">throws</span> Exception;</pre><p>Here <code class="literal">keyId</code>, <code class="literal">password</code>, and <code class="literal">encoded</code> cryptogram don&#8217;t require too much explanation, but <code class="literal">jobId</code> does
and here is the rationale. We could have a one-shot <code class="literal">aesDecrypt</code> method accepting the private key password,
but decrypting the AES-256 key using PGP is an expensive operation. In situations
where you have to extract a daily file, probably encrypted by just a handful keys, you don&#8217;t want to decrypt
the key on every <code class="literal">aesDecrypt</code> call. We don&#8217;t want to expose the key to the caller either, so the CryptoService
keeps it in a private field. In order to do that, <code class="literal">loadKey</code> caches the key (until it&#8217;s unloaded), so it&#8217;s
cheap to call <code class="literal">loadKey</code> followed by <code class="literal">aesDecrypt</code>, after the first call where the key is actually decrypted,
subsequent calls will be pretty fast.</p><p>In order to protect different clients from accessing keys loaded by other ones, we use a <code class="literal">jobId</code> that can be something as
simple as a <code class="literal">UUID</code> or any nonce, only known to the caller. That <code class="literal">jobId</code> can then be used to <code class="literal">unload</code> those keys, using the
<code class="literal">unloadKey</code> and <code class="literal">unloadAll</code> methods:</p><pre class="programlisting">    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> unloadKey (String jobId, String keyId);
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> unloadAll(String jobId);</pre><p>There&#8217;s also a no-args <code class="literal">unloadAll()</code> that unloads all keys, and should be used with care.</p><p>For some use cases (i.e. long running crypto-service based micro-service), it is possible to "UNLOCK" the system by calling</p><pre class="programlisting">    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> unlock (<span class="hl-keyword">char</span>[] password);</pre><p>For completeness, there&#8217;s also a <code class="literal">lock()</code> method.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/admon/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>In order to simplify development and testing, and eventually to troubleshoot problems, we&#8217;ve
also created a couple of CLI commands: <code class="literal">encrypt</code>, <code class="literal">decrypt</code>, <code class="literal">lock</code> and <code class="literal">unlock</code> in the <code class="literal">crypto</code> CLI subsystem.</p></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/admon/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>If you&#8217;re accessing the CLI using the command line <code class="literal">q2 --cli</code>, remember that the default <code class="literal">deployDir</code> is
<code class="literal">deploy-cli</code> instead of <code class="literal">deploy</code>. You need a copy (or symlink) of <code class="literal">25_cryptoservice.xml</code> in that
directory.</p><p>If you <code class="literal">ssh</code> to a running Q2 to reach the CLI, then you can ignore this tip.</p></td></tr></table></div><p>For testing purposes, it is possible to set the <code class="literal">unlock-password</code> property in the
crypto service configuration QBean, i.e.:</p><pre class="programlisting"><span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"unlock-password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"demo"</span><span class="hl-tag"> /&gt;</span></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/admon/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>This is of course highly insecure, the whole PGP based crypto service scheme makes
no sense at all when unlocking the private key in such a way.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_using_gnupg_to_generate_keys"></a>9.3.1&nbsp;Using GnuPG to generate keys</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Generate key</li></ul></div><pre class="screen">gpg --full-generate-key</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Export custodian public keys into keyring.pub</li></ul></div><pre class="screen">gpg --armor --export xxx@domain.com yyy@domain.com &gt; cfg/keyring.pub</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Export custodian private keys into keyring.priv</li></ul></div><pre class="screen">gpg --armor --export-secret-keys xxx@domain.com yyy@domain.com &gt; cfg/keyring.priv</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_crypto_server"></a>9.4&nbsp;Crypto Server</h2></div></div></div><p>The <code class="literal">cryptoserver</code> module offers a REST (qrest based) API to encrypt and decrypt using the <code class="literal">cryptoservice</code>.</p><p>It supports the following operations</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_encrypt"></a>9.4.1&nbsp;encrypt</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Path: <code class="literal">/encrypt</code></li><li class="listitem">Body:</li></ul></div><pre class="programlisting">{
  "text" : "The quick brown fox jumps over the lazy dog 0123456789"
}</pre><p>Sample response:</p><pre class="programlisting">{
    "kid": "d7e82270-7041-4434-8cf9-c4d0f26f620d",
    "cryptogram": "rp5uz7QMjRaEqPIbXzOZNI6bLuWYcdP0sH3I0FSKpRk...."
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_decrypt"></a>9.4.2&nbsp;decrypt</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Path: <code class="literal">/decrypt</code></li><li class="listitem">Body:</li></ul></div><pre class="programlisting">{
    "kid": "d7e82270-7041-4434-8cf9-c4d0f26f620d",
    "cryptogram": "rp5uz7QMjRaEqPIbXzOZNI6bLuWYcdP0sH3I0FSKpRk...."
}</pre><pre class="programlisting">{
  "text" : "The quick brown fox jumps over the lazy dog 0123456789"
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/admon/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The node running <code class="literal">cryptoserver</code> has to be <code class="literal">unlocked</code> (see <a class="xref" href="#cryptoservice" title="9.3&nbsp;Crypto Service">Section&nbsp;9.3, &#8220;Crypto Service&#8221;</a> module).</p></td></tr></table></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="_simulators"></a>10.&nbsp;Simulators</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_server_simulator"></a>10.1&nbsp;Server Simulator</h2></div></div></div><div class="informaltable"><a name="server-simulator"></a><table style="border: none;"><colgroup><col class="col_1"><col class="col_2"></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>What:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The Server Simulator is an extremely simple, BSH-based simulator
                    that can be used to test ISO-8583 based client software. It listens to
                    port (default 10000), and forwards all incoming requests to a BeanShell
                    based script that can be customized to meet your needs.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>When:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Available in all versions of jPOS-EE.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Who:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The jPOS.org team.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>How:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Posted by the jPOS-EE team.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Where:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Directory modules/server-simulator available in the
                    repository at GitHub.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Why:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>When writing ISO-8583 based client applications
                    the ability to easily simulate a server is usually very useful.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Status:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Stable.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Dependencies:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>module jpos</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>License:</strong></span></p></td><td style="" align="left" valign="top"><p><a class="link" href="#appendix_license" title="Appendix&nbsp;B.&nbsp;License">GNU Affero General Public License version 3</a></p></td></tr></tbody></table></div><p>The server simulator is a simple QServer with a BSHRequestListener that
handle incoming messages and provide suitable responses.</p><p>The default configuration uses an XMLChannel along with an XMLPackager,
but you are free to use any channel/packager combination.</p><p>The BSHRequestListener (documented in jPOS programmer&#8217;s guide) exposes
two objects: message (the incoming ISOMsg) and source (the ISOSource).</p><p>Here is the default configuration (05_serversimulator.xml):</p><pre class="programlisting">  <span class="hl-tag">&lt;server</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.q2.iso.QServer"</span> <span class="hl-attribute">logger</span>=<span class="hl-value">"Q2"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"simulator_10000"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;attr</span> <span class="hl-attribute">name</span>=<span class="hl-value">"port"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"java.lang.Integer"</span><span class="hl-tag">&gt;</span>10000<span class="hl-tag">&lt;/attr&gt;</span>
  <span class="hl-tag">&lt;channel</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.iso.channel.XMLChannel"</span>
         <span class="hl-attribute">logger</span>=<span class="hl-value">"Q2"</span> <span class="hl-attribute">packager</span>=<span class="hl-value">"org.jpos.iso.packager.XMLPackager"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;/channel&gt;</span>
  <span class="hl-tag">&lt;request-listener</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.bsh.BSHRequestListener"</span> <span class="hl-attribute">logger</span>=<span class="hl-value">"Q2"</span><span class="hl-tag">&gt;</span>
   <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"source"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"cfg/serversimulator.bsh"</span><span class="hl-tag"> /&gt;</span>
  <span class="hl-tag">&lt;/request-listener&gt;</span>
 <span class="hl-tag">&lt;/server&gt;</span></pre><p>And the BSH script looks like this:</p><pre class="programlisting">   message.setResponseMTI ();                                            <a name="CO26-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>

   Random random = <span class="hl-keyword">new</span> Random (System.currentTimeMillis());
   message.set (<span class="hl-number">37</span>, Integer.toString(Math.abs(random.nextInt()) % <span class="hl-number">1000000</span>));
   message.set (<span class="hl-number">38</span>, Integer.toString(Math.abs(random.nextInt()) % <span class="hl-number">1000000</span>));

   <span class="hl-keyword">if</span> (<span class="hl-string">"000000009999"</span>.equals (message.getString (<span class="hl-number">4</span>)))                    <a name="CO26-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span>
       message.set (<span class="hl-number">39</span>, <span class="hl-string">"01"</span>);
   <span class="hl-keyword">else</span>
       message.set (<span class="hl-number">39</span>, <span class="hl-string">"00"</span>);

   source.send (message);</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO26-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>Sets the response MTI (i.e: 0800/0810, 1201/1220&#8230;&#8203;)</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO26-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>We use the special amount value $99.99 to decline the transaction</p></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/admon/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>Never ever</strong></span> use this simulator even close to a production environment,
or you may end up blindly authorizing transactions.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_client_simulator"></a>10.2&nbsp;Client Simulator</h2></div></div></div><div class="informaltable"><table style="border: none;"><colgroup><col class="col_1"><col class="col_2"></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>What:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The Client Simulator can be used to fire a suite of unit tests
against an ISO-8583 server. The suite is defined by a set of XML files
representing messages to be sent and their expected responses.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>When:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Available in all versions of jPOS-EE.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Who:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The jPOS.org team.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>How:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Posted by the jPOS-EE team.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Where:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Directory <code class="literal">modules/client-simulator</code> available in the repository at GitHub.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Why:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>When writing ISO-8583 based server applications the ability to
easily simulate a client is usually very useful. We at jPOS.org use it
as a high level self test for our applications.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Status:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Stable.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Dependencies:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>module jpos</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>License:</strong></span></p></td><td style="" align="left" valign="top"><p><a class="link" href="#appendix_license" title="Appendix&nbsp;B.&nbsp;License">GNU Affero General Public License version 3</a></p></td></tr></tbody></table></div><p>In order to simulate complex ISO-8583 interchanges, the client simulator
uses BSH scripting support to customize the content of ISO-8583 fields
at runtime. This can be used to specify constant values, such as
terminal IDs, merchant IDs, card numbers, as well as dynamic values such
as trace numbers, retrieval reference numbers, pinblocks, key exchange
related stuff, etc.</p><p>Let&#8217;s have a look at the simulator&#8217;s QBean configuration:</p><pre class="programlisting">    <span class="hl-tag">&lt;qbean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"clientSimulator"</span> <span class="hl-attribute">logger</span>=<span class="hl-value">"Q2"</span> <span class="hl-attribute">realm</span>=<span class="hl-value">"client-simulator"</span>
          <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.simulator.TestRunner"</span><span class="hl-tag">&gt;</span>

     <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mux"</span>     <span class="hl-attribute">value</span>=<span class="hl-value">"clientsimulator-mux"</span><span class="hl-tag"> /&gt;</span>
     <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"timeout"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"30000"</span><span class="hl-tag"> /&gt;</span>
     <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"sessions"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"1"</span><span class="hl-tag"> /&gt;</span></pre><p>We specify a mux (that&#8217;s the name of a QMUX running on the same JVM) and
a timeout to wait for a given response. Then we define an initialization
block, i.e:</p><pre class="programlisting">     <span class="hl-tag">&lt;init&gt;</span>
        import org.jpos.space.*;
        int cnt = 1;
        String terminal = "29110001";
        String merchant = "000000001001";
        String pinblk   = "0123456789ABCDEF";
        Space sp = SpaceFactory.getSpace();
     <span class="hl-tag">&lt;/init&gt;</span></pre><p>The initialization block is basically a BSH script. You can do whatever
you want there, such as defining constants for later use, references to
jPOS objects (such as Space instances, Security module, etc.).</p><p>And then the test suite:</p><pre class="programlisting">     <span class="hl-tag">&lt;test-suite&gt;</span>
      <span class="hl-tag">&lt;path&gt;</span>cfg/<span class="hl-tag">&lt;/path&gt;</span>
      <span class="hl-tag">&lt;test</span> <span class="hl-attribute">file</span>=<span class="hl-value">"echo"</span> <span class="hl-attribute">count</span>=<span class="hl-value">"10"</span> <span class="hl-attribute">continue</span>=<span class="hl-value">"yes"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"Simple Echo Test"</span><span class="hl-tag"> /&gt;</span>
      <span class="hl-tag">&lt;test</span> <span class="hl-attribute">file</span>=<span class="hl-value">"echo"</span> <span class="hl-attribute">count</span>=<span class="hl-value">"20"</span> <span class="hl-attribute">continue</span>=<span class="hl-value">"yes"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"Simple Echo Test 2"</span><span class="hl-tag">&gt;</span>
       <span class="hl-tag">&lt;init&gt;</span>
        // optional init script
        // the variable 'testcase'references  _this_ testcase instance
        // the variable 'request' references the ISOMsg that is to be sent
       <span class="hl-tag">&lt;/init&gt;</span>
       <span class="hl-tag">&lt;post&gt;</span>
        // optional post script
        // the variable 'testcase' references  _this_ testcase instance
        // the variable 'response' references the received message
       <span class="hl-tag">&lt;/post&gt;</span>
      <span class="hl-tag">&lt;/test&gt;</span>

      <span class="hl-tag">&lt;path&gt;</span>cfg/anotherpath<span class="hl-tag">&lt;/path&gt;</span>
      <span class="hl-tag">&lt;test</span> <span class="hl-attribute">file</span>=<span class="hl-value">"mytest"</span><span class="hl-tag">&gt;</span>MyTest<span class="hl-tag">&lt;/test&gt;</span>
      ...
      ...
     <span class="hl-tag">&lt;/test-suite&gt;</span>
   <span class="hl-tag">&lt;/qbean&gt;</span></pre><p>The suite can be separated in different paths, in the previous example,
we assume that there exist two template files named: <code class="literal">cfg/echo_s</code> and <code class="literal">cfg/echo_r</code>.</p><p>The letter <span class="strong"><strong>s</strong></span> in <code class="literal">cfg/echo_s</code> stands for <span class="strong"><strong>send</strong></span> and the <span class="strong"><strong>r</strong></span> in <code class="literal">cfg/echo_r</code>
stands for <span class="strong"><strong>receive</strong></span>.</p><p><code class="literal">cfg/echo_s</code>:</p><pre class="programlisting">   <span class="hl-tag">&lt;isomsg&gt;</span>
    <span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"0"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"1800"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"7"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"1025080500"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"11"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"000001"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"41"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"29110001"</span><span class="hl-tag"> /&gt;</span>
   <span class="hl-tag">&lt;/isomsg&gt;</span></pre><p><code class="literal">cfg/echo_r</code>:</p><pre class="programlisting">   <span class="hl-tag">&lt;isomsg&gt;</span>
    <span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"0"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"1810"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"39"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"00"</span><span class="hl-tag"> /&gt;</span>
   <span class="hl-tag">&lt;/isomsg&gt;</span></pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/admon/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>If the response template file (i.e. <code class="literal">echo_r</code> in the previous example) is
not present, client simulator blindly sends the message to the server,
ignoring the response. A <span class="emphasis"><em>response ignored</em></span> note is added to the test log.</p></td></tr></table></div><p>In the previous example, we send a 1800 message with some fixed data,
and we expect to receive a 1810 message, with a 00 content in field 39.</p><p>While using fixed content may be okay for most fields and test cases,
there are situations where you want to use dynamic content.</p><p>Our simulator supports BSH scripts at the field level. Everything that
starts with a bang character (<span class="strong"><strong>!</strong></span>) is considered a script and evaluated as
such, so you can write:</p><pre class="programlisting">   <span class="hl-tag">&lt;isomsg&gt;</span>
    <span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"0"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"1800"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"7"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"ISODate.getANSIDate (new Date())"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"11"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"! System.currentTimeMillis() % 1000000"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"41"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"! terminal"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"52"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"# pinblk"</span><span class="hl-tag"> /&gt;</span>
   <span class="hl-tag">&lt;/isomsg&gt;</span></pre><p>Please note that in our example terminal is a runtime script variable
that we&#8217;ve defined in our block. The <span class="emphasis"><em><span class="strong"><strong>#</strong></span></em></span> characters operates in a
similar way as the <span class="emphasis"><em><span class="strong"><strong>!</strong></span></em></span> character, but the resulting value, which is
supposed to be an hexadecimal string, is converted to <code class="literal">byte[]</code> using
<code class="literal">ISOUtil.hex2byte(String)</code> in order to produce an <code class="literal">ISOBinaryField</code>.</p><p>The same thing happens at receive time, when we are trying to simulate
voids, reversals, we usually need information received in previous
transactions, such as retrieval reference numbers, audit numbers, etc.
so we can save that information for later use using a receive-time
script:</p><pre class="programlisting">   <span class="hl-tag">&lt;isomsg&gt;</span>
    <span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"0"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"1810"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"11"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"! previousTrace=value"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"37"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"! rrn=value"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"39"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"00"</span><span class="hl-tag"> /&gt;</span>
   <span class="hl-tag">&lt;/isomsg&gt;</span></pre><p>There&#8217;s a special variable name called <code class="literal">value</code> where we put the received
content, so in the previous example, the received retrieval reference
number (field 37), is stored in the variable named <code class="literal">rrn</code> for later use.</p><p>The receive script may optionally return true or false, so we can write
code like this:</p><pre class="programlisting">   <span class="hl-tag">&lt;isomsg&gt;</span>
    <span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">'39'</span> <span class="hl-attribute">value</span>=<span class="hl-value">'! return value.equals(EXPECTED_RETVALUE)'</span><span class="hl-tag"> /&gt;</span>
   <span class="hl-tag">&lt;/isomsg&gt;</span></pre><p>where <code class="literal">EXPECTED_RETVALUE</code> is initialized in a previous init block.</p><p>In fact, the previous example is equivalent to the following:</p><pre class="programlisting">   <span class="hl-tag">&lt;isomsg&gt;</span>
    <span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">'39'</span> <span class="hl-attribute">value</span>=<span class="hl-value">'! EXPECTED_RETVALUE'</span><span class="hl-tag"> /&gt;</span>
   <span class="hl-tag">&lt;/isomsg&gt;</span></pre><p>where the string value of EXPECTED_RETVALUE is used (unless it is a
boolean).</p><p>There is a special string <span class="strong"><strong>*E</strong></span> to test for echo. To ensure that the
received content of a field is the same as the content we sent, we can
write code like this:</p><pre class="programlisting">   <span class="hl-tag">&lt;isomsg&gt;</span>
    <span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">'4'</span> <span class="hl-attribute">value</span>=<span class="hl-value">'*E'</span><span class="hl-tag"> /&gt;</span>
   <span class="hl-tag">&lt;/isomsg&gt;</span></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/admon/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The special string <span class="strong"><strong>*M</strong></span> can be used to check for mandatory field
presence, regardless its content. Likewise, <span class="strong"><strong>*E</strong></span> can be used to check
for mandatory echo, and <span class="strong"><strong>*O</strong></span> can be used to check for optional echo. You
can also use <span class="strong"><strong>*A</strong></span> to check for mandatory <span class="emphasis"><em>absence</em></span> of a field.</p></td></tr></table></div><p>Test cases supports a count attribute that can be used to fire the same
test n times.</p><p>It also supports a continue attribute. If continue="yes" then the test
runner would just log an exception if something goes wrong, and it would
continue with the next test.</p><p>The default timeout is 60 seconds, but one can specify a different
timeout using the timeout attribute of the testcase element.</p><p>At the end, you get a ticket with the test results.</p><pre class="programlisting"><span class="hl-tag">&lt;log</span> <span class="hl-attribute">realm</span>=<span class="hl-value">"org.jpos.simulator.TestRunner"</span> <span class="hl-attribute">at</span>=<span class="hl-value">"......"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;results&gt;</span>
    Simple Echo Test        [OK] 58ms.
    Simple Echo Test        [OK] 38ms.
    Simple Echo Test        [OK] 70ms.
    Simple Echo Test        [OK] 23ms.
    Simple Echo Test        [OK] 56ms.
    Simple Echo Test        [OK] 24ms.
    Simple Echo Test        [OK] 73ms.
    Simple Echo Test        [OK] 107ms.
    Simple Echo Test        [OK] 20ms.
    Simple Echo Test        [OK] 50ms.
    Simple Echo Test        [OK] 23ms.
    Simple Echo Test        [OK] 24ms.
    Simple Echo Test        [OK] 86ms.
    Simple Echo Test        [OK] 24ms.
    Simple Echo Test        [OK] 24ms.
    Simple Echo Test        [OK] 23ms.
    Simple Echo Test        [OK] 26ms.
    Simple Echo Test        [OK] 21ms.
    Simple Echo Test        [OK] 22ms.
    Simple Echo Test        [OK] 79ms.
    Simple Echo Test 2      [OK] 22ms.
    elapsed server=893ms(62%),
    simulator=526ms(37%), total=1419ms
  <span class="hl-tag">&lt;/results&gt;</span>
<span class="hl-tag">&lt;/log&gt;</span></pre></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="_operation_services"></a>11.&nbsp;Operation services</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_sshd"></a>11.1&nbsp;SSHD</h2></div></div></div><div class="informaltable"><table style="border: none;"><colgroup><col class="col_1"><col class="col_2"></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>What</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The SSHD let&#8217;s you establish an ssh connection to a running Q2 instance.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>When</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Available in all versions of jPOS-EE since v2.0.0.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Who</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The jPOS.org team.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Where</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Directory modules/sshd available in git repository at github.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Why</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Remote secure login is an often desired featured in production systems.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Status</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Stable.</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>License</strong></span></p></td><td style="" align="left" valign="top"><p><a class="link" href="#appendix_license" title="Appendix&nbsp;B.&nbsp;License">GNU Affero General Public License version 3</a></p></td></tr></tbody></table></div><p><b>Maven Coordinates.&nbsp;</b>
</p><pre class="programlisting">        <span class="hl-tag">&lt;dependency&gt;</span>
            <span class="hl-tag">&lt;groupId&gt;</span>org.jpos.ee<span class="hl-tag">&lt;/groupId&gt;</span>
            <span class="hl-tag">&lt;artifactId&gt;</span>jposee-sshd<span class="hl-tag">&lt;/artifactId&gt;</span>
            <span class="hl-tag">&lt;version&gt;</span>${jposee.version}<span class="hl-tag">&lt;/version&gt;</span>
        <span class="hl-tag">&lt;/dependency&gt;</span></pre><p>
</p><p>The SSHD module provides remote secure logic to a running Q2 instance. It features:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Simple configuration</li><li class="listitem">Authentication by username/public key.</li><li class="listitem">Allows for CLI customization through alternate command stores.</li></ul></div><p>The <code class="literal">setup</code> process will create a default deployment descriptor in <span class="emphasis"><em>deploy/05_sshd.xml</em></span>:</p><pre class="programlisting"><span class="hl-tag">&lt;sshd</span> <span class="hl-attribute">name</span>=<span class="hl-value">"sshd"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.ee.cli.SshCLI"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;port&gt;</span>2222<span class="hl-tag">&lt;/port&gt;</span>                                                    <a name="CO27-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>
    <span class="hl-tag">&lt;auth-username&gt;</span>admin<span class="hl-tag">&lt;/auth-username&gt;</span>                                 <a name="CO27-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span>
    <span class="hl-tag">&lt;authorized-keys-file&gt;</span>cfg/authorized_keys<span class="hl-tag">&lt;/authorized-keys-file&gt;</span>     <a name="CO27-3"></a><span><img src="images/icons/callouts/3.png" alt="3" border="0"></span>
<span class="hl-tag">&lt;/sshd&gt;</span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO27-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>The SSHD server will listen on this port.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO27-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>The username the ssh client will use to connect to the SSHD server.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO27-3"><span><img src="images/icons/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>Points to a file containing public keys for every user who will be able to login</p></td></tr></table></div><p>If you have not setup a personal public/private key pair, now it&#8217;s the time to
do this. The instructions we will provide here are for OpenSSH on a Unix system,
but we&#8217;ll provide some links for Windows systems as well.</p><p>To generate your key pair:</p><pre class="screen">$ ssh-keygen -t rsa                                              <a name="CO28-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>
Generating public/private rsa key pair.
Enter file in which to save the key (/home/myuser/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):                      <a name="CO28-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span>
Enter same passphrase again:
Your identification has been saved in /home/myuser/.ssh/id_rsa.  <a name="CO28-3"></a><span><img src="images/icons/callouts/3.png" alt="3" border="0"></span>
Your public key has been saved in /home/myuser/.ssh/id_rsa.pub.  <a name="CO28-4"></a><span><img src="images/icons/callouts/4.png" alt="4" border="0"></span>
The key fingerprint is:
f6:61:a8:27:35:cf:4c:6d:13:22:70:cf:4c:c8:a0:23 myuser@nexus</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO28-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>The command <code class="literal">ssh-keygen -t rsa</code> initiated the creation of the key pair.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO28-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>No passphrase was entered (Enter key was pressed instead).</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO28-3"><span><img src="images/icons/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>The private key was saved in .ssh/id_rsa.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO28-4"><span><img src="images/icons/callouts/4.png" alt="4" border="0"></span></a> </p></td><td valign="top" align="left"><p>The public key is saved in .ssh/id_rsa.pub.</p></td></tr></table></div><p>In this case, the content of file id_rsa.pub is:</p><pre class="screen">ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAIEArkwv9X8eTVK4F7pMlSt45pWoiakFkZMw
G9BjydOJPGH0RFNAy1QqIWBGWv7vS5K2tr+EEO+F8WL2Y/jK4ZkUoQgoi+n7DWQVOHsR
ijcS3LvtO+50Np4yjXYWJKh29JL6GHcp8o7+YKEyVUMB2CSDOP99eF9g5Q0d+1U2WVdB
WQM= myuser@nexus</pre><p>It is one line in length.</p><p>Its content is then copied to cfg/authorized_keys of your Q2 instance.</p><p>If all is well, you should be able to run your Q2 instance and type:</p><pre class="screen">ssh -p 2222 admin@localhost</pre><p>And you should be given access to Q2 Remote CLI.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/admon/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Windows Users can use Putty and use this <a class="link" href="http://www.ualberta.ca/CNS/RESEARCH/LinuxClusters/pka-putty.html" target="_top">link</a>
as a guide to get the contents for the <span class="emphasis"><em>authorized_keys</em></span> file.</p></td></tr></table></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="_contributed_modules"></a>12.&nbsp;Contributed modules</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_fsdmsgx"></a>12.1&nbsp;FSDMsgX</h2></div></div></div><div class="informaltable"><table style="border: none;"><colgroup><col class="col_1"><col class="col_2"></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>What:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>This field/message packager can be used to wire a message parser with java code. Its a utility library that enables you to parse grammar, usually used by text (can be binary as well) messages
that are field separator delimited, fixed length, branching based on data
parsed, looking ahead in the stream for a specific byte and base future
parsing decisions. Provides out of the box PCI compliance and ability to add java objects to meet you compliance needs.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>When:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Available in all versions of jPOS-EE.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Who:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The jPOS.org team.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>How:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Posted by the jPOS-EE team.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Where:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Directory modules/fsdmsgX available in the jPOS-EE main
subversion repository at google code.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Why:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>When schema based FSD does not meet your parsing needs to write more complex parsing rules.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Status:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Production grade</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>Dependencies:</strong></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>module jpos</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>License:</strong></span></p></td><td style="" align="left" valign="top"><p><a class="link" href="#appendix_license" title="Appendix&nbsp;B.&nbsp;License">GNU Affero General Public License version 3</a></p></td></tr></tbody></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_introduction_to_using_the_packagers"></a>12.1.1&nbsp;Introduction to using the packagers</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_fixedfieldpackager"></a>FixedFieldPackager</h4></div></div></div><p>Consider a specification that states field 1 is a fixed field of 6 and field 2 is a fixed stream of 2 bytes.
Stream of bytes=123456AB
If the specification is followed:
Field1 = 123456
Field2 = AB</p><div class="example"><a name="d0e5069"></a><p class="title"><b>Example&nbsp;12.1.&nbsp;FixedFieldPackager Usage [unpacking raw bytes]</b></p><div class="example-contents"><pre class="literallayout">FSDMsgX msg = new FSDMsgX("Example1");
FixedFieldPackager field1 = new FixedFieldPackager("Field1", 6, AsciiInterpreter.INSTANCE);
FixedFieldPackager field2 = new FixedFieldPackager("Field2", 2, AsciiInterpreter.INSTANCE);</pre><pre class="literallayout">msg.add(field1);
msg.add(field2);</pre><pre class="literallayout">String s = "123456ABEXTRA";// there are EXTRA bytes in the stream</pre><pre class="literallayout">int offset = msg.unpack(s.getBytes());
System.out.println("Offset="+offset);
System.out.println("Field1="+msg.get("Field1"));
System.out.println("Field2="+msg.get("Field2"));
System.out.println(msg.dump("dump"));
System.out.println(msg.getParserTree("tree&gt;"));
System.out.println(msg.hexDump(""));</pre></div></div><br class="example-break"><p><span class="strong"><strong>Output</strong></span></p><pre class="programlisting">Offset=8
Field1=123456
Field2=AB
dump<span class="hl-tag">&lt;fsdmsgX</span> <span class="hl-attribute">name</span>=<span class="hl-value">"Example1"</span><span class="hl-tag">&gt;</span>
dump	<span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"Field1"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"123456"</span><span class="hl-tag">/&gt;</span>
dump	<span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"Field2"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"AB"</span><span class="hl-tag">/&gt;</span>
dump<span class="hl-tag">&lt;/fsdmsgX&gt;</span>
tree&gt;[Example1]
tree&gt;Field [Field1] : Fixed [6] : 123456
tree&gt;Field [Field2] : Fixed [2] : AB
0000  31 32 33 34 35 36 41 42                           123456AB</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Create the main container object FSDMsgX.</li><li class="listitem">Create the individual field packagers for field1 and field2.</li><li class="listitem">Add the individual field packagers to the container.</li><li class="listitem">Call the unpack method on the input bytes to parse the stream.</li><li class="listitem">The unpack method returns the offset in the stream where the parser has reached, we parsed a total of 8 bytes, the offset is 8 (its 0 based so its at the 9<sup>th</sup> position.</li><li class="listitem">Notice the fields are accessible via the containers get method.</li><li class="listitem">The containers dump method, provides a pretty xml ( the prefix of "dump" to identify it in the output.</li><li class="listitem">The container has a getParseTree method that display your composite packager. This will help once you get into complex composite packager. The use of of the prefix "tree" is used to identify its output.</li><li class="listitem">The container has a hexdump method that dumps the hex equivalent of the unpacked stream. Notice EXTRA is not there as there was no rule to unpack it.</li><li class="listitem">If the input string was s = "123456" then an ISOException would be thrown telling you precisely what was wrong.
org.jpos.iso.ISOException: Field [Field2] at offset [6]:Expecting 2 bytes found 0</li></ul></div><div class="example"><a name="d0e5119"></a><p class="title"><b>Example&nbsp;12.2.&nbsp;FixedFieldPackager Usage [packing object into bytes]</b></p><div class="example-contents"><pre class="literallayout">FSDMsgX msg = new FSDMsgX("Example1");
FixedFieldPackager field1 = new FixedFieldPackager("Field1", 6, AsciiInterpreter.INSTANCE);
FixedFieldPackager field2 = new FixedFieldPackager("Field2", 2, AsciiInterpreter.INSTANCE);</pre><pre class="literallayout">msg.add(field1);
msg.add(field2);</pre><pre class="literallayout">msg.set("Field1", "ABCDEF");
msg.set("Field2", "12");</pre><pre class="literallayout">byte[] outStream = msg.pack();</pre><pre class="literallayout">System.out.println(msg.dump("dump"));
System.out.println(msg.getParserTree("tree&gt;"));
System.out.println(msg.hexDump(""));
System.out.println(ISOUtil.hexdump(outStream));</pre></div></div><br class="example-break"><p><span class="strong"><strong>Output</strong></span></p><pre class="programlisting">dump<span class="hl-tag">&lt;fsdmsgX</span> <span class="hl-attribute">name</span>=<span class="hl-value">"Example1"</span><span class="hl-tag">&gt;</span>
dump	<span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"Field1"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"ABCDEF"</span><span class="hl-tag">/&gt;</span>
dump	<span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"Field2"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"12"</span><span class="hl-tag">/&gt;</span>
dump<span class="hl-tag">&lt;/fsdmsgX&gt;</span>
tree&gt;[Example1]
tree&gt;Field [Field1] : Fixed [6] : ABCDEF
tree&gt;Field [Field2] : Fixed [2] : 12
0000  41 42 43 44 45 46 31 32                           ABCDEF12
0000  41 42 43 44 45 46 31 32                           ABCDEF12</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Set the fields in the container.</li><li class="listitem">Call the unpack method on the container to serialize the object into a byte array.</li><li class="listitem">You can verify that data looks accurate in dump method.</li><li class="listitem">You can verify that the parser parsed it correctly.</li><li class="listitem">You can verify the hexdump of the actual packed vyte array outstream is the same as the hexdump of the container.</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_variablefieldpackager"></a>VariableFieldPackager</h4></div></div></div><p>Used when the size of the field is variable and needs a delimiter to indicate the end of the field.</p><p>Consider a specification that indicates a field FirstName can have a maximum of 20 characters and will be terminate/delimited by a semi colon followed by a Lastname with a maximum of 10 characters terminated by a period.
The delimiter is important because one could have a name Tom, Tommy, Thomas to indicate the end of a name a delimiter is needed. If I did bot have a FirstName, a semi colon would be needed to indicate there is no first name.</p><div class="example"><a name="d0e5160"></a><p class="title"><b>Example&nbsp;12.3.&nbsp;VariableFieldPackager Usage</b></p><div class="example-contents"><pre class="literallayout">@Test
public void unpackTest02() throws ISOException {</pre><pre class="literallayout">VariableFieldPackager f1 = new VariableFieldPackager("F1", 20, new Byte((byte) 0x1c),
		AsciiInterpreter.INSTANCE);
VariableFieldPackager f2 = new VariableFieldPackager("F2", 5, new Byte((byte) 0x1d), AsciiInterpreter.INSTANCE);</pre><pre class="literallayout">FSDMsgX msg = new FSDMsgX("Test1");
msg.add("F1", f1);
msg.add("F2", f2);</pre><pre class="literallayout">String inStream = "123456" + (char) 0x1c + "ABC" + (char) 0x1d;
msg.unpack(inStream.getBytes());</pre><pre class="literallayout">assertEquals("123456", msg.get("F1"));
assertEquals("ABC", msg.get("F2"));</pre><pre class="literallayout">FSDMsgX msg2 = new FSDMsgX("Test2");
msg2.add("F1", f1);
msg2.add("F2", f2);
byte[] outStream = msg2.pack();</pre><pre class="literallayout">	System.out.println(msg2.getParserTree("Msg2"));
	assertArrayEquals(inStream.getBytes(), outStream);
	System.out.println(msg2.hexDump(""));
	System.out.println(msg.hexDump(""));
}</pre></div></div><br class="example-break"><p><span class="strong"><strong>Output</strong></span></p><pre class="programlisting">Msg2[TestPack]
Msg2Field [F1] : VAR[0..20] delimiter[0x1C] or EOM  : 123456
Msg2Field [F2] : VAR[0..5] delimiter[0x1D] or EOM  : ABC
0000  31 32 33 34 35 36 1C 41  42 43 1D                 123456.ABC.
0000  31 32 33 34 35 36 1C 41  42 43 1D                 123456.ABC.</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Create a variable length field F1 that can be a max of 20 wide terminated by a 0x1C.</li><li class="listitem">Create a variable length field F2 that can be a max of 5 wide terminated by a 0x1D.</li><li class="listitem">Add them to the Test1 container.</li><li class="listitem">Use raw input to test unpacking.</li><li class="listitem">Expect F1 to be 123456 and F2 to be ABC.</li><li class="listitem">Create a new container Test2 to test packing of the same fields to get byte array. The packing process will add the delimiter, you dont set it.</li><li class="listitem">Expect the packed array to be identical to the raw input used for unpacking.</li><li class="listitem">See the hexdumps are identical for both the containers,operations show equivalence.</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_branchfieldpackager"></a>BranchFieldPackager</h4></div></div></div><p>Consider a specification where you need to parse fields differently based on a particular field. Typically you will see a pattern where, if the value of the field is X the fields following it are Y1,Y2..Yn.</p><p>As an example:
There is a field F1 which is fixed.
There is a fixed field F2 that can have values 01 or 02.
If the value is 01, 2 fields following it are Fixed 3 and Fixed 3.
If the value is 02, 2 fields following it are Fixed 4 and Fixed 4.
.BranchFieldPackager Usage</p><div class="informalexample"><pre class="literallayout">@Test
public void unpackTest06() throws ISOException{</pre><pre class="literallayout">AFSDFieldPackager f1 = new FixedFieldPackager("F1", 5, AsciiInterpreter.INSTANCE);
AFSDFieldPackager f2 = new FixedFieldPackager("F2", 2, AsciiInterpreter.INSTANCE);</pre><pre class="literallayout">FSDMsgX innerFSDCase01 = new FSDMsgX("inner-1");
AFSDFieldPackager f7 = new FixedFieldPackager("F7", 3, AsciiInterpreter.INSTANCE);
AFSDFieldPackager f6 = new FixedFieldPackager("F6", 3, AsciiInterpreter.INSTANCE);
innerFSDCase01.add("F7",f7);
innerFSDCase01.add("F6",f6);</pre><pre class="literallayout">FSDMsgX innerFSDCase02 = new FSDMsgX("inner-2");
AFSDFieldPackager f8 = new FixedFieldPackager("F8", 4, AsciiInterpreter.INSTANCE);
AFSDFieldPackager f9 = new FixedFieldPackager("F9", 4, AsciiInterpreter.INSTANCE);
innerFSDCase02.add("F8",f8);
innerFSDCase02.add("F9",f9);</pre><pre class="literallayout">Map&lt;String, AFSDFieldPackager&gt; caseMap = new HashMap&lt;String, AFSDFieldPackager&gt;();
caseMap.put("01", innerFSDCase01);
caseMap.put("02", innerFSDCase02);
AFSDFieldPackager f3 = new BranchFieldPackager("F3", "F2", caseMap, null);</pre><pre class="literallayout">FSDMsgX msg = new FSDMsgX("Test");
msg.add("F1", f1);
msg.add("F2", f2);
msg.add("F3", f3);</pre><pre class="literallayout">System.out.println(msg.getParserTree(""));</pre><pre class="literallayout">msg.unpack("ABCDE0244445555".getBytes());
System.out.println(msg.dump(""));
assertEquals("ABCDE", msg.get("F1"));
assertEquals("02", msg.get("F2"));</pre><pre class="literallayout">assertEquals("4444", msg.get("F8"));
assertEquals("5555", msg.get("F9"));</pre><pre class="literallayout">}</pre></div><p><span class="strong"><strong>Output</strong></span></p><pre class="programlisting"> [Test]
Field [F1] : Fixed [5]
Field [F2] : Fixed [2]
Field [F3] : [Branch]
	switch (F2)
		01:
			[inner-1]
			Field [F7] : Fixed [3]
			Field [F6] : Fixed [3]
		02:
			[inner-1]
			Field [F8] : Fixed [4]
			Field [F9] : Fixed [4]
		default:
			[Not Set]
<span class="hl-tag">&lt;fsdmsgX</span> <span class="hl-attribute">name</span>=<span class="hl-value">"Test"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"F1"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"ABCDE"</span><span class="hl-tag">/&gt;</span>
	<span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"F2"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"02"</span><span class="hl-tag">/&gt;</span>
	<span class="hl-tag">&lt;fsdmsgX</span> <span class="hl-attribute">name</span>=<span class="hl-value">"inner-1"</span><span class="hl-tag">&gt;</span>
		<span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"F8"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"4444"</span><span class="hl-tag">/&gt;</span>
		<span class="hl-tag">&lt;field</span> <span class="hl-attribute">id</span>=<span class="hl-value">"F9"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"5555"</span><span class="hl-tag">/&gt;</span>
	<span class="hl-tag">&lt;/fsdmsgX&gt;</span>
<span class="hl-tag">&lt;/fsdmsgX&gt;</span></pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Define Fixed F1.</li><li class="listitem">Define Fixed F2.</li><li class="listitem">Set up the individual case formatters for cases 01 and 02 based on value in F2 (inner-1 and inner-2)</li><li class="listitem">Add the cases to a map where the key is the values F2 can hold and the maps value is the packager it should follow.</li><li class="listitem">Set up the branchfield packager field F3. the constructor takes the existing fields name, the name of the field whose value we  will make the branching decision off [F2], the map that has the value to  packager map, the last one is the default packager to use if the value of F2 is not in the map, here we have chosen null as we dont want a default path.</li><li class="listitem">Add the F1,F2 and F3 to the container. You dont add the other packagers as the those are basically used indirectly by F3. So once the container unpacks F1, then F2 and then when it unpacks F3, it will follow the packagers in container F3.</li><li class="listitem">The output shows you the parsetree based on how you have setup your parser, you can see f1,F2 as fixed and the branch showing you the switch on F2 and the cases wit their packagers.</li><li class="listitem">You can try tpo change the input stream and use ABCDE01222333 to see case 01 gets used.</li><li class="listitem">When you do a pack, it will check to see what value is set in F2 and pick the packagers to follow accordingly.</li></ul></div></div></div></div></div></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a name="_jpos_ee_entities"></a>Part&nbsp;III.&nbsp;jPOS-EE Entities</h1></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="sysconfig"></a>13.&nbsp;SysConfig</h2></div></div></div><div class="informalfigure"><div class="mediaobject"><img src="sysconfig.svg" alt="sysconfig"></div></div><p>The <code class="literal">SysConfig</code> entity <a href="#ftn.d0e5286" class="footnote" name="d0e5286"><sup class="footnote">[5]</sup></a> is a general purpose entity
used by jPOS-EE to store configuration parameters.</p><p>It contains the following properties:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">id</code></li><li class="listitem"><code class="literal">value</code></li><li class="listitem"><code class="literal">readPerm</code></li><li class="listitem"><code class="literal">writePerm</code></li></ul></div><p><code class="literal">readPerm</code> and <code class="literal">writePerm</code> properties can be optionally used by
the user interface in order to limit access to specific entries.</p><p>Most jPOS applications typically use a prefix, for example:</p><pre class="screen">              id       |               value
-----------------------+------------------------------------
 perm.sysadmin         | System Administrator
 perm.login            | Login
 perm.sysconfig.read   | View System Configuration
 perm.sysconfig.write  | Edit System Configuration
 perm.users.write      | Write permission on Users
 perm.users.read       | Read permission on Users
 perm.accounting       | Full access to accounting records</pre><p>When shown in the user interface, that <code class="literal">perm.</code> prefix is discarded, e.g.:</p><p><span class="inlinemediaobject"><img src="images/permissions.png" alt="Permissions"></span></p><p>This prefix is configured in <code class="literal">00_qi.xml</code> like this:</p><pre class="programlisting">  <span class="hl-tag">&lt;view</span> <span class="hl-attribute">route</span>=<span class="hl-value">"permissions"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.qi.sysconfig.SysConfigView"</span>
    <span class="hl-attribute">perm</span>=<span class="hl-value">"sysadmin"</span> <span class="hl-attribute">sidebar</span>=<span class="hl-value">"system"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"permissions"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"entityName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"permission"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"prefix"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"perm."</span><span class="hl-tag"> /&gt;</span>                                       <a name="CO29-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"title"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Permissions"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"id"</span> <span class="hl-attribute">read-only</span>=<span class="hl-value">"true"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"value"</span> <span class="hl-attribute">regex</span>=<span class="hl-value">"&amp;TEXT_PATTERN;"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/view&gt;</span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO29-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>There goes the <code class="literal">perm.</code> prefix.</p></td></tr></table></div><p>Using this technique, it&#8217;s easy to create CRUD operations for different kind of
configuration groups (roles, permissions, hosts, cryptograms, etc.) just by copying
that little XML element snippet inside the application&#8217;s <code class="literal">00_qi.xml</code>.</p><div class="footnotes"><br><hr style="width:100; text-align:left;margin-left: 0"><div id="ftn.d0e5286" class="footnote"><p><a href="#d0e5286" class="simpara"><sup class="simpara">[5] </sup></a><span class="emphasis"><em>sysconfig</em></span> table</p></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="_syslog"></a>14.&nbsp;SysLog</h2></div></div></div><div class="informalfigure"><div class="mediaobject"><img src="syslog.svg" alt="syslog"></div></div><p>The <code class="literal">SysLog</code> entity is a general purpose entity used by jPOS-EE to record
an audit trail of relevant events.</p><p>The table has the following columns:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">id</code> : auto-generated ID</li><li class="listitem"><code class="literal">date</code>: timestamp</li><li class="listitem"><code class="literal">deleted</code>: logical delete indicator</li><li class="listitem"><code class="literal">source</code>: application specific source (i.e. node name)</li><li class="listitem"><code class="literal">severity</code>: we use DEBUG = 0, TRACE = 1, INFO  = 2, WARN  = 3, ERROR = 4, CRITICAL=5</li><li class="listitem"><code class="literal">summary</code>: a brief description of the event, suitable to be printed by the UI in a column</li><li class="listitem"><code class="literal">detail</code>: specific info about the event</li><li class="listitem"><code class="literal">trace</code>: additional information (i.e. dumps)</li><li class="listitem"><code class="literal">deleted</code>: logical delete</li></ul></div><p>Here is a sample use:</p><pre class="screen">  id  |          date           |  source   |  type  | severity |         summary
------+-------------------------+-----------+--------+----------+-------------------------
 1102 | 2018-10-15 21:02:31.544 | N01       | SYSTEM |        2 | Start
 1607 | 2018-10-15 21:02:43.028 | N01       | SYSTEM |        2 | Stop (uptime 11s)
 1608 | 2018-10-16 16:43:10.318 | N01       | SYSTEM |        2 | Start
 1609 | 2018-10-16 17:00:20.428 | N01       | SYSTEM |        2 | Stop (uptime 17m10s)
 1610 | 2018-10-16 17:00:31.798 | RESTAPI01 | SYSTEM |        2 | Start
 1613 | 2018-10-16 17:14:43.698 | RESTAPI01 | SYSTEM |        2 | Stop (uptime 14m13s)
 1614 | 2018-10-16 17:14:50.987 | N01       | SYSTEM |        2 | Start
 1618 | 2018-10-16 19:46:20.14  | N01       | SYSTEM |        2 | Stop (uptime 2h31m29s)</pre></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="_eeuser_module"></a>15.&nbsp;EEUser module</h2></div></div></div><p>The <code class="literal">eeuser</code> module can be used to represent visitors and users of the system with their
respective roles and permissions. Roles can be system-wide, or per-Resource (tenant).</p><div class="informalfigure"><div class="mediaobject"><img src="eeuser-module.svg" alt="eeuser module"></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_visitor"></a>15.1&nbsp;Visitor</h2></div></div></div><p>For web-based applications, a <span class="emphasis"><em>visitor</em></span> represents a remote user, either
anonymous or logged into the system. The <span class="emphasis"><em>Visitor</em></span> entity allows implementing the optional
<span class="emphasis"><em>remember me</em></span> feature. When its <span class="emphasis"><em>User</em></span> is not null, that means the user
is already logged in. A Cookie is used to locate a given visitor.</p><div class="informalfigure"><div class="mediaobject"><img src="visitor.svg" alt="visitor"></div></div><div class="informaltable"><table style="border: none;"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Property</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Description</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>id</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Application specific, QI uses a UUID string</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>user</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>If the user is already logged into the system, points to a valid User (in <code class="literal">eeuser</code> table)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>lastUpdate</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>timestamp with last session initiation</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>props</p></td><td style="" align="left" valign="top"><p>application specific properties  (i.e. host/ip address)</p></td></tr></tbody></table></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">The visitor id format is application specific, QI uses a UUID string</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_user"></a>15.2&nbsp;User</h2></div></div></div><p><span class="emphasis"><em>Users</em></span>, in turn have <span class="emphasis"><em>roles</em></span> containing <span class="emphasis"><em>permissions</em></span>.</p><p>Roles can be limited to certain realms. Roles can have a parent, in which case, it inherits its permissions.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/admon/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Because <code class="literal">user</code> is usually a reserved word in SQL, we use the name <code class="literal">eeuser</code>
for the users table.</p></td></tr></table></div><div class="informalfigure"><div class="mediaobject"><img src="user-entity.svg" alt="user entity"></div></div><div class="informaltable"><table style="border: none;"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Property</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Description</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>id</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>internal id</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>nick</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>unique system-wide nick name</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>passwordHash</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>current strategy (<code class="literal">HashVersion.ONE</code>) uses <code class="literal">PBKDF2WithHmacSHA256</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>name</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>the user name</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>email</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>primary e-mail address - additional email addresses can be stored in the <code class="literal">User.props</code> map</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>roles</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>user roles (which in turn have a permissions set)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>props</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>a general purpose map used to store application-specific data associated with the user</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>deleted</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>logical delete</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>active</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>true if the user is active</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>verified</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>true if user has been verified. The verification process is application specific</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>startDate</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>if not null, user is not valid before this date</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>endDate</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>if not null, user is not valid after this date</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>passwordHistory</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>stores previous password hashes in order to implement password reuse feature</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>forcePasswordChange</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>if true, QI forces the user to change his/her password</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>lastLogin</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>QI updates this entry on every login</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>passwordChanged</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>last password change, use to force users to change password after X time</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>loginAttempts</p></td><td style="" align="left" valign="top"><p>invalid login counter, can be used to lock users (by setting <code class="literal">active=false</code>)</p></td></tr></tbody></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/admon/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>jPOS-EE support multiple password hash strategies.
The current one (<code class="literal">VERSION.ONE</code>) uses <code class="literal">PBKDF2WithHmacSHA256</code>.
Entries with an older version (ZERO) get automatically upgraded to version
ONE on the next login.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_roles_and_permissions"></a>15.3&nbsp;Roles and Permissions</h2></div></div></div><p>Users have roles, which in turn have permissions.</p><p>Here is a sample <code class="literal">role</code> entry:</p><pre class="screen"># select * from role where name='admin';

 id | name
----+-------
 64 | admin

# select * from role_perms where role=64;

 role |      name
------+-----------------
   64 | sysadmin
   64 | login
   64 | sysconfig.read
   64 | sysconfig.write
   64 | users.read
   64 | users.write
   64 | accounting</pre><p>The permission and role names are application specific. QI (the jPOS UI) uses
the <code class="literal">sysconfig</code> (see <a class="link" href="#sysconfig" title="13.&nbsp;SysConfig">SysConfig schema</a>) table in order to assist
the UI with permission options, e.g.</p><pre class="screen"># select * from sysconfig where id like 'perm%';
          id          |    readperm    |               value               | writeperm
----------------------+----------------+-----------------------------------+-----------
 perm.accounting      | sysconfig.read | Full access to accounting records | sysadmin
 perm.login           | sysconfig.read | Login                             | sysadmin
 perm.sysadmin        | sysadmin       | System Administrator              | sysadmin
 perm.sysconfig.read  | sysconfig.read | View System Configuration         | sysadmin
 perm.sysconfig.write | sysconfig.read | Edit System Configuration         | sysadmin
 perm.users.read      | sysconfig.read | Read permission on Users          | admin
 perm.users.write     | sysconfig.read | Write permission on Users         | admin</pre><p>As mentioned, the permission names are totally application specific. QI checks that a given user
has a role that in turn has the <code class="literal">perm.login</code> in order to allow access to the system. These permissions
can be configured in the <code class="literal">00_qi.xml</code> (see <a class="link" href="#QI" title="5.4&nbsp;QI Basics">QI module</a>)  file to allow access to different parts
of the system, e.g.:</p><pre class="programlisting">  <span class="hl-tag">&lt;view</span> <span class="hl-attribute">route</span>=<span class="hl-value">"profile"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.qi.eeuser.ProfilesView"</span>
    <span class="hl-attribute">perm</span>=<span class="hl-value">"login"</span> <span class="hl-attribute">sidebar</span>=<span class="hl-value">"system"</span><span class="hl-tag">&gt;</span>                                    <a name="CO30-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"entityName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"user"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"id"</span> <span class="hl-attribute">field</span>=<span class="hl-value">"false"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"nick"</span> <span class="hl-attribute">length</span>=<span class="hl-value">"64"</span> <span class="hl-attribute">regex</span>=<span class="hl-value">"&amp;WORD_PATTERN;"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">length</span>=<span class="hl-value">"128"</span> <span class="hl-attribute">regex</span>=<span class="hl-value">"&amp;TEXT_PATTERN;"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"email"</span> <span class="hl-attribute">length</span>=<span class="hl-value">"128"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"active"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"roles"</span> <span class="hl-attribute">column</span>=<span class="hl-value">"false"</span> <span class="hl-attribute">perm</span>=<span class="hl-value">"sysadmin"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/view&gt;</span>
  <span class="hl-tag">&lt;view</span> <span class="hl-attribute">route</span>=<span class="hl-value">"roles"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jpos.qi.eeuser.RolesView"</span>
         <span class="hl-attribute">perm</span>=<span class="hl-value">"sysadmin"</span> <span class="hl-attribute">sidebar</span>=<span class="hl-value">"system"</span><span class="hl-tag">&gt;</span>                            <a name="CO30-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"entityName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"role"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"id"</span> <span class="hl-attribute">field</span>=<span class="hl-value">"false"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">regex</span>=<span class="hl-value">"&amp;WORD_PATTERN;"</span> <span class="hl-attribute">length</span>=<span class="hl-value">"64"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"permissions"</span> <span class="hl-attribute">column</span>=<span class="hl-value">"false"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/view&gt;</span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO30-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>user can access its own profile</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO30-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>but needs <code class="literal">sysadmin</code> permission in order to administer roles</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_roles_realm"></a>15.4&nbsp;Role&#8217;s realm</h2></div></div></div><p>In multi-tenant systems, a user may have a role <code class="literal">admin</code> within a given realm
(e.g., a given <code class="literal">Issuer</code>) but not on others. A <code class="literal">role</code> can have an optional <code class="literal">realm</code>
to limit its scope.</p><p>The permissions granted to a role restricted to a given realm are automatically
prefixed with the realm&#8217;s name, for example, if a given role <code class="literal">realm=accounting,
role=admin</code> has the permissions <code class="literal">read</code> and <code class="literal">post</code>, the permissions granted to
the user are <code class="literal">accounting:read</code> and <code class="literal">accounting:post</code> instead of just <code class="literal">read</code> and
<code class="literal">post</code>.</p><p>As shown in the previous diagram, a Role has permissions, but it also has a
parent (that points to another Role).</p><p>If we have a generic <code class="literal">accounting-admin</code> role with permissions <span class="emphasis"><em>read</em></span> and <span class="emphasis"><em>post</em></span>,
we can have a realm-scoped <code class="literal">accounting-admin</code> role that don&#8217;t need to be
configured with said permissions.</p><div class="informaltable"><table style="border: none;"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"><col class="col_4"><col class="col_5"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Id</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Realm</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Role</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Permissions</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Parent</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>1</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>accounting-admin</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>read, post</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>(no parent)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>2</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>company_1</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>accounting-admin</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">&nbsp;</td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>1</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>3</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>company_2</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>accounting-admin</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">&nbsp;</td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>1</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>4</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>company_3</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>accounting-admin</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">&nbsp;</td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>1</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>5</p></td><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>company_4</p></td><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>accounting-admin</p></td><td style="border-right: 0.5pt solid ; " align="left" valign="top">&nbsp;</td><td style="" align="left" valign="top"><p>1</p></td></tr></tbody></table></div><p>A user that has Role 1 (<code class="literal">accounting-admin</code> with no realm restriction) will have
the generic permissions:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">read</code> and</li><li class="listitem"><code class="literal">post</code></li></ul></div><p>A user that has Role 2 (<code class="literal">company_1</code>) and 4 (<code class="literal">company_3</code>) will have the permissions:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">company_1:read</code></li><li class="listitem"><code class="literal">company_1:post</code></li><li class="listitem"><code class="literal">company_3:read</code></li><li class="listitem"><code class="literal">company_3:post</code></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/admon/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The permission is formed out of the realm name, plus a colon and the real permission name.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_consumer"></a>15.5&nbsp;Consumer</h2></div></div></div><p>A <span class="emphasis"><em>Consumer</em></span> is used to represent an API client (i.e. a mobile device). If the
API is being hit by a mobile application, the Consumer would represent an instance of
that application.</p><p>A Consumer belongs to a user, but it has its own set of roles and permissions.</p><div class="informaltable"><table style="border: none;"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Property</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Description</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>id</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>application-specific ID (i.e. UUID)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>hash</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>current strategy (<code class="literal">HashVersion.ONE</code>) uses <code class="literal">PBKDF2WithHmacSHA256</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>active</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>true if the user is active</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>deleted</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>logical delete</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>startDate</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>if not null, user is not valid before this date</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>endDate</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>if not null, user is not valid after this date</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>user</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Consumers belong to a given user</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>roles</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>set of roles (which in turn has permissions)</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>props</p></td><td style="" align="left" valign="top"><p>application-specific properties</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_password_history"></a>15.6&nbsp;Password History</h2></div></div></div><p>In order to support the optional <span class="emphasis"><em>do not repeat passwords</em></span> feature, we have a
companion password history entity where the UI keeps track of the password
hashes of the last N passwords used.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_userconsumer_properties"></a>15.7&nbsp;User/Consumer properties</h2></div></div></div><p>Application-specific data associated with the user can be stored in this
general purpose key/value map. Typical information stored there are
alternate email addresses, UI preferences, etc.</p></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="seqno"></a>16.&nbsp;SeqNo</h2></div></div></div><div class="informalfigure"><div class="mediaobject"><img src="seqno.svg" alt="seqno"></div></div><p>The <code class="literal">SeqNo</code> entity <a href="#ftn.d0e6043" class="footnote" name="d0e6043"><sup class="footnote">[6]</sup></a> is a general purpose entity
used by jPOS-EE to store application specific sequencers.</p><p>Typical use case would be terminal-level STANS, Voucher IDs and the like.</p><p>The <code class="literal">SeqNoManager</code> supports two operating modes:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Synchronous</li><li class="listitem">Asynchronous</li></ul></div><p>In Synchronous mode, the transaction life-cycle is handled by the caller, e.g.:</p><pre class="programlisting">    <span class="hl-keyword">private</span> <span class="hl-keyword">long</span> next(String id) {
        <span class="hl-keyword">try</span> (DB db = <span class="hl-keyword">new</span> DB()) {
            SeqNoManager mgr = <span class="hl-keyword">new</span> SeqNoManager(db);
            db.open();
            db.beginTransaction();
            <span class="hl-keyword">long</span> l = mgr.next(id, <span class="hl-number">999999L</span>);
            db.commit();
            <span class="hl-keyword">return</span> l;
        }
    }</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/admon/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>In <span class="emphasis"><em>sync</em></span> mode, a second thread trying to obtain a sequence number will block until the
former is committed.</p></td></tr></table></div><p>In Asynchronous mode, the JDBC connection is released and an explicit call to <code class="literal">SeqNoManager.release</code>
has to be issued, e.g.:</p><pre class="programlisting">   SeqNoManager mgr = <span class="hl-keyword">new</span> SeqNoManager(<span class="hl-keyword">new</span> DB());
   <span class="hl-keyword">long</span> l = mgr.next(<span class="hl-string">"sync"</span>, id, <span class="hl-number">60000L</span>, <span class="hl-number">60000L</span>, <span class="hl-number">999999L</span>);
   <span class="hl-comment">// ... do something, e.g.: query remote host</span>
   mgr.release(<span class="hl-string">"sync"</span>, id);
   <span class="hl-keyword">return</span> l;</pre><p>Interesting thing about async mode, is that while one calls a remote host (i.e. using <code class="literal">QueryHost</code>),
the JDBC connection gets released back to its pool.</p><div class="footnotes"><br><hr style="width:100; text-align:left;margin-left: 0"><div id="ftn.d0e6043" class="footnote"><p><a href="#d0e6043" class="simpara"><sup class="simpara">[6] </sup></a><span class="emphasis"><em>seqno</em></span> table</p></div></div></div></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a name="_appendices"></a>Part&nbsp;IV.&nbsp;Appendices</h1></div></div></div><div class="appendix"><div class="titlepage"><div><div><h2 class="title"><a name="appendix_copyright"></a>Appendix&nbsp;A.&nbsp;Copyright</h2></div></div></div><p>Copyright &copy; 2000-2015 Alejandro P. Revilla</p><p>This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.</p><p>This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.</p><p>You should have received a copy of the GNU Affero General Public
License along with this program.  If not, see <a class="link" href="http://www.gnu.org/licenses/" target="_top">http://www.gnu.org/licenses/</a>.</p></div><div class="appendix"><div class="titlepage"><div><div><h2 class="title"><a name="appendix_license"></a>Appendix&nbsp;B.&nbsp;License</h2></div></div></div><div class="informalexample"><p><span class="strong"><strong>GNU AFFERO GENERAL PUBLIC LICENSE</strong></span></p><p>Version 3, 19 November 2007</p><p>Copyright &copy; 2007 Free Software Foundation, Inc.
&lt;<a class="link" href="http://fsf.org/" target="_top">http://fsf.org/</a>&gt; 
 Everyone is permitted to copy and distribute verbatim copies of this
license document, but changing it is not allowed.</p><p><span class="strong"><strong>Preamble</strong></span></p><p>The GNU Affero General Public License is a free, copyleft license for
software and other kinds of works, specifically designed to ensure
cooperation with the community in the case of network server software.</p><p>The licenses for most software and other practical works are designed to
take away your freedom to share and change the works. By contrast, our
General Public Licenses are intended to guarantee your freedom to share
and change all versions of a program&#8212;&#8203;to make sure it remains free
software for all its users.</p><p>When we speak of free software, we are referring to freedom, not price.
Our General Public Licenses are designed to make sure that you have the
freedom to distribute copies of free software (and charge for them if
you wish), that you receive source code or can get it if you want it,
that you can change the software or use pieces of it in new free
programs, and that you know you can do these things.</p><p>Developers that use our General Public Licenses protect your rights with
two steps: (1) assert copyright on the software, and (2) offer you this
License which gives you legal permission to copy, distribute and/or
modify the software.</p><p>A secondary benefit of defending all users' freedom is that improvements
made in alternate versions of the program, if they receive widespread
use, become available for other developers to incorporate. Many
developers of free software are heartened and encouraged by the
resulting cooperation. However, in the case of software used on network
servers, this result may fail to come about. The GNU General Public
License permits making a modified version and letting the public access
it on a server without ever releasing its source code to the public.</p><p>The GNU Affero General Public License is designed specifically to ensure
that, in such cases, the modified source code becomes available to the
community. It requires the operator of a network server to provide the
source code of the modified version running there to the users of that
server. Therefore, public use of a modified version, on a publicly
accessible server, gives the public access to the source code of the
modified version.</p><p>An older license, called the Affero General Public License and published
by Affero, was designed to accomplish similar goals. This is a different
license, not a version of the Affero GPL, but Affero has released a new
version of the Affero GPL which permits relicensing under this license.</p><p>The precise terms and conditions for copying, distribution and
modification follow.</p><p><span class="strong"><strong>TERMS AND CONDITIONS</strong></span></p><p><span class="strong"><strong>0. Definitions.</strong></span></p><p>"This License" refers to version 3 of the GNU Affero General Public
License.</p><p>"Copyright" also means copyright-like laws that apply to other kinds of
works, such as semiconductor masks.</p><p>"The Program" refers to any copyrightable work licensed under this
License. Each licensee is addressed as "you". "Licensees" and
"recipients" may be individuals or organizations.</p><p>To "modify" a work means to copy from or adapt all or part of the work
in a fashion requiring copyright permission, other than the making of an
exact copy. The resulting work is called a "modified version" of the
earlier work or a work "based on" the earlier work.</p><p>A "covered work" means either the unmodified Program or a work based on
the Program.</p><p>To "propagate" a work means to do anything with it that, without
permission, would make you directly or secondarily liable for
infringement under applicable copyright law, except executing it on a
computer or modifying a private copy. Propagation includes copying,
distribution (with or without modification), making available to the
public, and in some countries other activities as well.</p><p>To "convey" a work means any kind of propagation that enables other
parties to make or receive copies. Mere interaction with a user through
a computer network, with no transfer of a copy, is not conveying.</p><p>An interactive user interface displays "Appropriate Legal Notices" to
the extent that it includes a convenient and prominently visible feature
that (1) displays an appropriate copyright notice, and (2) tells the
user that there is no warranty for the work (except to the extent that
warranties are provided), that licensees may convey the work under this
License, and how to view a copy of this License. If the interface
presents a list of user commands or options, such as a menu, a prominent
item in the list meets this criterion.</p><p><span class="strong"><strong>1. Source Code.</strong></span></p><p>The "source code" for a work means the preferred form of the work for
making modifications to it. "Object code" means any non-source form of a
work.</p><p>A "Standard Interface" means an interface that either is an official
standard defined by a recognized standards body, or, in the case of
interfaces specified for a particular programming language, one that is
widely used among developers working in that language.</p><p>The "System Libraries" of an executable work include anything, other
than the work as a whole, that (a) is included in the normal form of
packaging a Major Component, but which is not part of that Major
Component, and (b) serves only to enable use of the work with that Major
Component, or to implement a Standard Interface for which an
implementation is available to the public in source code form. A "Major
Component", in this context, means a major essential component (kernel,
window system, and so on) of the specific operating system (if any) on
which the executable work runs, or a compiler used to produce the work,
or an object code interpreter used to run it.</p><p>The "Corresponding Source" for a work in object code form means all the
source code needed to generate, install, and (for an executable work)
run the object code and to modify the work, including scripts to control
those activities. However, it does not include the work&#8217;s System
Libraries, or general-purpose tools or generally available free programs
which are used unmodified in performing those activities but which are
not part of the work. For example, Corresponding Source includes
interface definition files associated with source files for the work,
and the source code for shared libraries and dynamically linked
subprograms that the work is specifically designed to require, such as
by intimate data communication or control flow between those subprograms
and other parts of the work.</p><p>The Corresponding Source need not include anything that users can
regenerate automatically from other parts of the Corresponding Source.</p><p>The Corresponding Source for a work in source code form is that same
work.</p><p><span class="strong"><strong>2. Basic Permissions.</strong></span></p><p>All rights granted under this License are granted for the term of
copyright on the Program, and are irrevocable provided the stated
conditions are met. This License explicitly affirms your unlimited
permission to run the unmodified Program. The output from running a
covered work is covered by this License only if the output, given its
content, constitutes a covered work. This License acknowledges your
rights of fair use or other equivalent, as provided by copyright law.</p><p>You may make, run and propagate covered works that you do not convey,
without conditions so long as your license otherwise remains in force.
You may convey covered works to others for the sole purpose of having
them make modifications exclusively for you, or provide you with
facilities for running those works, provided that you comply with the
terms of this License in conveying all material for which you do not
control copyright. Those thus making or running the covered works for
you must do so exclusively on your behalf, under your direction and
control, on terms that prohibit them from making any copies of your
copyrighted material outside their relationship with you.</p><p>Conveying under any other circumstances is permitted solely under the
conditions stated below. Sublicensing is not allowed; section 10 makes
it unnecessary.</p><p><span class="strong"><strong>3. Protecting Users' Legal Rights From Anti-Circumvention Law.</strong></span></p><p>No covered work shall be deemed part of an effective technological
measure under any applicable law fulfilling obligations under article 11
of the WIPO copyright treaty adopted on 20 December 1996, or similar
laws prohibiting or restricting circumvention of such measures.</p><p>When you convey a covered work, you waive any legal power to forbid
circumvention of technological measures to the extent such circumvention
is effected by exercising rights under this License with respect to the
covered work, and you disclaim any intention to limit operation or
modification of the work as a means of enforcing, against the work&#8217;s
users, your or third parties' legal rights to forbid circumvention of
technological measures.</p><p><span class="strong"><strong>4. Conveying Verbatim Copies.</strong></span></p><p>You may convey verbatim copies of the Program&#8217;s source code as you
receive it, in any medium, provided that you conspicuously and
appropriately publish on each copy an appropriate copyright notice; keep
intact all notices stating that this License and any non-permissive
terms added in accord with section 7 apply to the code; keep intact all
notices of the absence of any warranty; and give all recipients a copy
of this License along with the Program.</p><p>You may charge any price or no price for each copy that you convey, and
you may offer support or warranty protection for a fee.</p><p><span class="strong"><strong>5. Conveying Modified Source Versions.</strong></span></p><p>You may convey a work based on the Program, or the modifications to
produce it from the Program, in the form of source code under the terms
of section 4, provided that you also meet all of these conditions:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">The work must carry prominent notices stating that you modified it,
and giving a relevant date.</li><li class="listitem">The work must carry prominent notices stating that it is released
under this License and any conditions added under section 7. This
requirement modifies the requirement in section 4 to "keep intact all
notices".</li><li class="listitem">You must license the entire work, as a whole, under this License to
anyone who comes into possession of a copy. This License will therefore
apply, along with any applicable section 7 additional terms, to the
whole of the work, and all its parts, regardless of how they are
packaged. This License gives no permission to license the work in any
other way, but it does not invalidate such permission if you have
separately received it.</li><li class="listitem">If the work has interactive user interfaces, each must display
Appropriate Legal Notices; however, if the Program has interactive
interfaces that do not display Appropriate Legal Notices, your work need
not make them do so.</li></ol></div><p>A compilation of a covered work with other separate and independent
works, which are not by their nature extensions of the covered work, and
which are not combined with it such as to form a larger program, in or
on a volume of a storage or distribution medium, is called an
"aggregate" if the compilation and its resulting copyright are not used
to limit the access or legal rights of the compilation&#8217;s users beyond
what the individual works permit. Inclusion of a covered work in an
aggregate does not cause this License to apply to the other parts of the
aggregate.</p><p><span class="strong"><strong>6. Conveying Non-Source Forms.</strong></span></p><p>You may convey a covered work in object code form under the terms of
sections 4 and 5, provided that you also convey the machine-readable
Corresponding Source under the terms of this License, in one of these
ways:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">Convey the object code in, or embodied in, a physical product
(including a physical distribution medium), accompanied by the
Corresponding Source fixed on a durable physical medium customarily used
for software interchange.</li><li class="listitem">Convey the object code in, or embodied in, a physical product
(including a physical distribution medium), accompanied by a written
offer, valid for at least three years and valid for as long as you offer
spare parts or customer support for that product model, to give anyone
who possesses the object code either (1) a copy of the Corresponding
Source for all the software in the product that is covered by this
License, on a durable physical medium customarily used for software
interchange, for a price no more than your reasonable cost of physically
performing this conveying of source, or (2) access to copy the
Corresponding Source from a network server at no charge.</li><li class="listitem">Convey individual copies of the object code with a copy of the
written offer to provide the Corresponding Source. This alternative is
allowed only occasionally and noncommercially, and only if you received
the object code with such an offer, in accord with subsection 6b.</li><li class="listitem">Convey the object code by offering access from a designated place
(gratis or for a charge), and offer equivalent access to the
Corresponding Source in the same way through the same place at no
further charge. You need not require recipients to copy the
Corresponding Source along with the object code. If the place to copy
the object code is a network server, the Corresponding Source may be on
a different server (operated by you or a third party) that supports
equivalent copying facilities, provided you maintain clear directions
next to the object code saying where to find the Corresponding Source.
Regardless of what server hosts the Corresponding Source, you remain
obligated to ensure that it is available for as long as needed to
satisfy these requirements.</li><li class="listitem">Convey the object code using peer-to-peer transmission, provided
you inform other peers where the object code and Corresponding Source of
the work are being offered to the general public at no charge under
subsection 6d.</li></ol></div><p>A separable portion of the object code, whose source code is excluded
from the Corresponding Source as a System Library, need not be included
in conveying the object code work.</p><p>A "User Product" is either (1) a "consumer product", which means any
tangible personal property which is normally used for personal, family,
or household purposes, or (2) anything designed or sold for
incorporation into a dwelling. In determining whether a product is a
consumer product, doubtful cases shall be resolved in favor of coverage.
For a particular product received by a particular user, "normally used"
refers to a typical or common use of that class of product, regardless
of the status of the particular user or of the way in which the
particular user actually uses, or expects or is expected to use, the
product. A product is a consumer product regardless of whether the
product has substantial commercial, industrial or non-consumer uses,
unless such uses represent the only significant mode of use of the
product.</p><p>"Installation Information" for a User Product means any methods,
procedures, authorization keys, or other information required to install
and execute modified versions of a covered work in that User Product
from a modified version of its Corresponding Source. The information
must suffice to ensure that the continued functioning of the modified
object code is in no case prevented or interfered with solely because
modification has been made.</p><p>If you convey an object code work under this section in, or with, or
specifically for use in, a User Product, and the conveying occurs as
part of a transaction in which the right of possession and use of the
User Product is transferred to the recipient in perpetuity or for a
fixed term (regardless of how the transaction is characterized), the
Corresponding Source conveyed under this section must be accompanied by
the Installation Information. But this requirement does not apply if
neither you nor any third party retains the ability to install modified
object code on the User Product (for example, the work has been
installed in ROM).</p><p>The requirement to provide Installation Information does not include a
requirement to continue to provide support service, warranty, or updates
for a work that has been modified or installed by the recipient, or for
the User Product in which it has been modified or installed. Access to a
network may be denied when the modification itself materially and
adversely affects the operation of the network or violates the rules and
protocols for communication across the network.</p><p>Corresponding Source conveyed, and Installation Information provided, in
accord with this section must be in a format that is publicly documented
(and with an implementation available to the public in source code
form), and must require no special password or key for unpacking,
reading or copying.</p><p><span class="strong"><strong>7. Additional Terms.</strong></span></p><p>"Additional permissions" are terms that supplement the terms of this
License by making exceptions from one or more of its conditions.
Additional permissions that are applicable to the entire Program shall
be treated as though they were included in this License, to the extent
that they are valid under applicable law. If additional permissions
apply only to part of the Program, that part may be used separately
under those permissions, but the entire Program remains governed by this
License without regard to the additional permissions.</p><p>When you convey a copy of a covered work, you may at your option remove
any additional permissions from that copy, or from any part of it.
(Additional permissions may be written to require their own removal in
certain cases when you modify the work.) You may place additional
permissions on material, added by you to a covered work, for which you
have or can give appropriate copyright permission.</p><p>Notwithstanding any other provision of this License, for material you
add to a covered work, you may (if authorized by the copyright holders
of that material) supplement the terms of this License with terms:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">Disclaiming warranty or limiting liability differently from the
terms of sections 15 and 16 of this License; or</li><li class="listitem">Requiring preservation of specified reasonable legal notices or
author attributions in that material or in the Appropriate Legal Notices
displayed by works containing it; or</li><li class="listitem">Prohibiting misrepresentation of the origin of that material, or
requiring that modified versions of such material be marked in
reasonable ways as different from the original version; or</li><li class="listitem">Limiting the use for publicity purposes of names of licensors or
authors of the material; or</li><li class="listitem">Declining to grant rights under trademark law for use of some trade
names, trademarks, or service marks; or</li><li class="listitem">Requiring indemnification of licensors and authors of that material
by anyone who conveys the material (or modified versions of it) with
contractual assumptions of liability to the recipient, for any liability
that these contractual assumptions directly impose on those licensors
and authors.</li></ol></div><p>All other non-permissive additional terms are considered "further
restrictions" within the meaning of section 10. If the Program as you
received it, or any part of it, contains a notice stating that it is
governed by this License along with a term that is a further
restriction, you may remove that term. If a license document contains a
further restriction but permits relicensing or conveying under this
License, you may add to a covered work material governed by the terms of
that license document, provided that the further restriction does not
survive such relicensing or conveying.</p><p>If you add terms to a covered work in accord with this section, you must
place, in the relevant source files, a statement of the additional terms
that apply to those files, or a notice indicating where to find the
applicable terms.</p><p>Additional terms, permissive or non-permissive, may be stated in the
form of a separately written license, or stated as exceptions; the above
requirements apply either way.</p><p><span class="strong"><strong>8. Termination.</strong></span></p><p>You may not propagate or modify a covered work except as expressly
provided under this License. Any attempt otherwise to propagate or
modify it is void, and will automatically terminate your rights under
this License (including any patent licenses granted under the third
paragraph of section 11).</p><p>However, if you cease all violation of this License, then your license
from a particular copyright holder is reinstated (a) provisionally,
unless and until the copyright holder explicitly and finally terminates
your license, and (b) permanently, if the copyright holder fails to
notify you of the violation by some reasonable means prior to 60 days
after the cessation.</p><p>Moreover, your license from a particular copyright holder is reinstated
permanently if the copyright holder notifies you of the violation by
some reasonable means, this is the first time you have received notice
of violation of this License (for any work) from that copyright holder,
and you cure the violation prior to 30 days after your receipt of the
notice.</p><p>Termination of your rights under this section does not terminate the
licenses of parties who have received copies or rights from you under
this License. If your rights have been terminated and not permanently
reinstated, you do not qualify to receive new licenses for the same
material under section 10.</p><p><span class="strong"><strong>9. Acceptance Not Required for Having Copies.</strong></span></p><p>You are not required to accept this License in order to receive or run a
copy of the Program. Ancillary propagation of a covered work occurring
solely as a consequence of using peer-to-peer transmission to receive a
copy likewise does not require acceptance. However, nothing other than
this License grants you permission to propagate or modify any covered
work. These actions infringe copyright if you do not accept this
License. Therefore, by modifying or propagating a covered work, you
indicate your acceptance of this License to do so.</p><p><span class="strong"><strong>10. Automatic Licensing of Downstream Recipients.</strong></span></p><p>Each time you convey a covered work, the recipient automatically
receives a license from the original licensors, to run, modify and
propagate that work, subject to this License. You are not responsible
for enforcing compliance by third parties with this License.</p><p>An "entity transaction" is a transaction transferring control of an
organization, or substantially all assets of one, or subdividing an
organization, or merging organizations. If propagation of a covered work
results from an entity transaction, each party to that transaction who
receives a copy of the work also receives whatever licenses to the work
the party&#8217;s predecessor in interest had or could give under the previous
paragraph, plus a right to possession of the Corresponding Source of the
work from the predecessor in interest, if the predecessor has it or can
get it with reasonable efforts.</p><p>You may not impose any further restrictions on the exercise of the
rights granted or affirmed under this License. For example, you may not
impose a license fee, royalty, or other charge for exercise of rights
granted under this License, and you may not initiate litigation
(including a cross-claim or counterclaim in a lawsuit) alleging that any
patent claim is infringed by making, using, selling, offering for sale,
or importing the Program or any portion of it.</p><p><span class="strong"><strong>11. Patents.</strong></span></p><p>A "contributor" is a copyright holder who authorizes use under this
License of the Program or a work on which the Program is based. The work
thus licensed is called the contributor&#8217;s "contributor version".</p><p>A contributor&#8217;s "essential patent claims" are all patent claims owned or
controlled by the contributor, whether already acquired or hereafter
acquired, that would be infringed by some manner, permitted by this
License, of making, using, or selling its contributor version, but do
not include claims that would be infringed only as a consequence of
further modification of the contributor version. For purposes of this
definition, "control" includes the right to grant patent sublicenses in
a manner consistent with the requirements of this License.</p><p>Each contributor grants you a non-exclusive, worldwide, royalty-free
patent license under the contributor&#8217;s essential patent claims, to make,
use, sell, offer for sale, import and otherwise run, modify and
propagate the contents of its contributor version.</p><p>In the following three paragraphs, a "patent license" is any express
agreement or commitment, however denominated, not to enforce a patent
(such as an express permission to practice a patent or covenant not to
sue for patent infringement). To "grant" such a patent license to a
party means to make such an agreement or commitment not to enforce a
patent against the party.</p><p>If you convey a covered work, knowingly relying on a patent license, and
the Corresponding Source of the work is not available for anyone to
copy, free of charge and under the terms of this License, through a
publicly available network server or other readily accessible means,
then you must either (1) cause the Corresponding Source to be so
available, or (2) arrange to deprive yourself of the benefit of the
patent license for this particular work, or (3) arrange, in a manner
consistent with the requirements of this License, to extend the patent
license to downstream recipients. "Knowingly relying" means you have
actual knowledge that, but for the patent license, your conveying the
covered work in a country, or your recipient&#8217;s use of the covered work
in a country, would infringe one or more identifiable patents in that
country that you have reason to believe are valid.</p><p>If, pursuant to or in connection with a single transaction or
arrangement, you convey, or propagate by procuring conveyance of, a
covered work, and grant a patent license to some of the parties
receiving the covered work authorizing them to use, propagate, modify or
convey a specific copy of the covered work, then the patent license you
grant is automatically extended to all recipients of the covered work
and works based on it.</p><p>A patent license is "discriminatory" if it does not include within the
scope of its coverage, prohibits the exercise of, or is conditioned on
the non-exercise of one or more of the rights that are specifically
granted under this License. You may not convey a covered work if you are
a party to an arrangement with a third party that is in the business of
distributing software, under which you make payment to the third party
based on the extent of your activity of conveying the work, and under
which the third party grants, to any of the parties who would receive
the covered work from you, a discriminatory patent license (a) in
connection with copies of the covered work conveyed by you (or copies
made from those copies), or (b) primarily for and in connection with
specific products or compilations that contain the covered work, unless
you entered into that arrangement, or that patent license was granted,
prior to 28 March 2007.</p><p>Nothing in this License shall be construed as excluding or limiting any
implied license or other defenses to infringement that may otherwise be
available to you under applicable patent law.</p><p><span class="strong"><strong>12. No Surrender of Others' Freedom.</strong></span></p><p>If conditions are imposed on you (whether by court order, agreement or
otherwise) that contradict the conditions of this License, they do not
excuse you from the conditions of this License. If you cannot convey a
covered work so as to satisfy simultaneously your obligations under this
License and any other pertinent obligations, then as a consequence you
may not convey it at all. For example, if you agree to terms that
obligate you to collect a royalty for further conveying from those to
whom you convey the Program, the only way you could satisfy both those
terms and this License would be to refrain entirely from conveying the
Program.</p><p><span class="strong"><strong>13. Remote Network Interaction; Use with the GNU General Public License.</strong></span></p><p>Notwithstanding any other provision of this License, if you modify the
Program, your modified version must prominently offer all users
interacting with it remotely through a computer network (if your version
supports such interaction) an opportunity to receive the Corresponding
Source of your version by providing access to the Corresponding Source
from a network server at no charge, through some standard or customary
means of facilitating copying of software. This Corresponding Source
shall include the Corresponding Source for any work covered by version 3
of the GNU General Public License that is incorporated pursuant to the
following paragraph.</p><p>Notwithstanding any other provision of this License, you have permission
to link or combine any covered work with a work licensed under version 3
of the GNU General Public License into a single combined work, and to
convey the resulting work. The terms of this License will continue to
apply to the part which is the covered work, but the work with which it
is combined will remain governed by version 3 of the GNU General Public
License.</p><p><span class="strong"><strong>14. Revised Versions of this License.</strong></span></p><p>The Free Software Foundation may publish revised and/or new versions of
the GNU Affero General Public License from time to time. Such new
versions will be similar in spirit to the present version, but may
differ in detail to address new problems or concerns.</p><p>Each version is given a distinguishing version number. If the Program
specifies that a certain numbered version of the GNU Affero General
Public License "or any later version" applies to it, you have the option
of following the terms and conditions either of that numbered version or
of any later version published by the Free Software Foundation. If the
Program does not specify a version number of the GNU Affero General
Public License, you may choose any version ever published by the Free
Software Foundation.</p><p>If the Program specifies that a proxy can decide which future versions
of the GNU Affero General Public License can be used, that proxy&#8217;s
public statement of acceptance of a version permanently authorizes you
to choose that version for the Program.</p><p>Later license versions may give you additional or different permissions.
However, no additional obligations are imposed on any author or
copyright holder as a result of your choosing to follow a later version.</p><p><span class="strong"><strong>15. Disclaimer of Warranty.</strong></span></p><p>THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT PERMITTED BY
APPLICABLE LAW. EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT
HOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM "AS IS" WITHOUT
WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
PARTICULAR PURPOSE. THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF
THE PROGRAM IS WITH YOU. SHOULD THE PROGRAM PROVE DEFECTIVE, YOU ASSUME
THE COST OF ALL NECESSARY SERVICING, REPAIR OR CORRECTION.</p><p><span class="strong"><strong>16. Limitation of Liability.</strong></span></p><p>IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MODIFIES AND/OR
CONVEYS THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,
INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES
ARISING OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT
NOT LIMITED TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES
SUSTAINED BY YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE
WITH ANY OTHER PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN
ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.</p><p><span class="strong"><strong>17. Interpretation of Sections 15 and 16.</strong></span></p><p>If the disclaimer of warranty and limitation of liability provided above
cannot be given local legal effect according to their terms, reviewing
courts shall apply local law that most closely approximates an absolute
waiver of all civil liability in connection with the Program, unless a
warranty or assumption of liability accompanies a copy of the Program in
return for a fee.</p><p>END OF TERMS AND CONDITIONS</p><p><span class="strong"><strong>How to Apply These Terms to Your New Programs</strong></span></p><p>If you develop a new program, and you want it to be of the greatest
possible use to the public, the best way to achieve this is to make it
free software which everyone can redistribute and change under these
terms.</p><p>To do so, attach the following notices to the program. It is safest to
attach them to the start of each source file to most effectively state
the exclusion of warranty; and each file should have at least the
"copyright" line and a pointer to where the full notice is found.</p><pre class="screen">    &lt;one line to give the program's name and a brief idea of what it does.&gt;
    Copyright (C) &lt;year&gt;  &lt;name of author&gt;

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</pre><p>Also add information on how to contact you by electronic and paper mail.</p><p>If your software can interact with users remotely through a computer
network, you should also make sure that it provides a way for users to
get its source. For example, if your program is a web application, its
interface could display a "Source" link that leads users to an archive
of the code. There are many ways you could offer source, and different
solutions will be better for different programs; see section 13 for the
specific requirements.</p><p>You should also get your employer (if you work as a programmer) or
school, if any, to sign a "copyright disclaimer" for the program, if
necessary. For more information on this, and how to apply and follow the
GNU AGPL, see
&lt;<a class="link" href="http://www.gnu.org/licenses/" target="_top">http://www.gnu.org/licenses/</a>&gt;.</p></div></div><div class="appendix"><div class="titlepage"><div><div><h2 class="title"><a name="appendix_CLA"></a>Appendix&nbsp;C.&nbsp;Contributor License Agreement</h2></div></div></div><div class="informalexample"><p>jPOS Project
Contributor License Agreement V1.0
based on <a class="link" href="http://www.apache.org/licenses/" target="_top">http://www.apache.org/licenses/</a></p><p>Thank you for your interest in the jPOS project by Alejandro P. Revilla
(Uruguayan company #212 752 380 016) conducting business as the jPOS Organization
(jPOS.org).</p><p>In order to clarify the intellectual property license granted with
Contributions from any person or entity, jPOS.org must have a Contributor
License Agreement ("CLA") that has been signed by each Contributor, indicating
agreement to the license terms below.</p><p>This license is for your protection as a
Contributor as well as the protection of jPOS.org and its users; it does not
change your rights to use your own Contributions for any other purpose.</p><p>If you have not already done so, please complete this agreement and
commit it to the jPOS repository at
<a class="link" href="https://github.com/jpos/jPOS" target="_top">https://github.com/jpos/jPOS</a> at legal/cla-USERNAME.txt using
your authenticated SourceForge login. If you do not have commit
privilege to the repository, please email the file to <a class="link" href="mailto:license@jpos.org" target="_top">license@jpos.org</a>.
If possible, digitally sign the committed file, otherwise also send a
signed Agreement to jPOS.org.</p><p>Please read this document carefully before signing and keep a copy for
your records.</p><div class="informaltable"><table style="border: none;"><colgroup><col class="col_1"><col class="col_2"></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Full Name</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>E-Mail</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>Mailing Address:</p></td><td style="" align="left" valign="top">&nbsp;</td></tr></tbody></table></div><p>You accept and agree to the following terms and conditions for Your
present and future Contributions submitted to jPOS.org. In return,
jPOS.org shall not use Your Contributions in a way that is
contrary to the software license in effect at the time of the
Contribution.  Except for the license granted herein to jPOS.org
and recipients of software distributed by jPOS.org, You reserve
all right, title, and interest in and to Your Contributions.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><span class="strong"><strong>Definitions.</strong></span> "You" (or "Your") shall mean the copyright owner or
legal entity authorized by the copyright owner that is making this
Agreement with jPOS.org. For legal entities, the entity making a
Contribution and all other entities that control, are controlled
by, or are under common control with that entity are considered to
be a single Contributor. For the purposes of this definition,
"control" means (i) the power, direct or indirect, to cause the
direction or management of such entity, whether by contract or
otherwise, or (ii) ownership of fifty percent (50%) or more of the
outstanding shares, or (iii) beneficial ownership of such entity.</li><li class="listitem">"Contribution" shall mean any original work of authorship,
including any modifications or additions to an existing work, that
is intentionally submitted by You to jPOS.org for inclusion
in, or documentation of, any of the products owned or managed by
jPOS.org (the "Work"). For the purposes of this definition,
"submitted" means any form of electronic, verbal, or written
communication sent to jPOS.org or its representatives,
including but not limited to communication on electronic mailing
lists, source code control systems, and issue tracking systems that
are managed by, or on behalf of, jPOS.org for the purpose of
discussing and improving the Work, but excluding communication that
is conspicuously marked or otherwise designated in writing by You
as "Not a Contribution."</li><li class="listitem">Grant of Copyright License. Subject to the terms and conditions of
this Agreement, You hereby grant to jPOS.org and to
recipients of software distributed by jPOS.org a perpetual,
worldwide, non-exclusive, no-charge, royalty-free, irrevocable
copyright license to reproduce, prepare derivative works of,
publicly display, publicly perform, sublicense, and distribute Your
Contributions and such derivative works.</li><li class="listitem">Grant of Patent License. Subject to the terms and conditions of
this Agreement, You hereby grant to jPOS.org and to
recipients of software distributed by jPOS.org a perpetual,
worldwide, non-exclusive, no-charge, royalty-free, irrevocable
(except as stated in this section) patent license to make, have
made, use, offer to sell, sell, import, and otherwise transfer the
Work, where such license applies only to those patent claims
licensable by You that are necessarily infringed by Your
Contribution(s) alone or by combination of Your Contribution(s)
with the Work to which such Contribution(s) was submitted. If any
entity institutes patent litigation against You or any other entity
(including a cross-claim or counterclaim in a lawsuit) alleging
that your Contribution, or the Work to which you have contributed,
constitutes direct or contributory patent infringement, then any
patent licenses granted to that entity under this Agreement for
that Contribution or Work shall terminate as of the date such
litigation is filed.</li><li class="listitem">You represent that you are legally entitled to grant the above
license. If your employer(s) has rights to intellectual property
that you create that includes your Contributions, you represent
that you have received permission to make Contributions on behalf
of that employer, that your employer has waived such rights for
your Contributions to jPOS.org, or that your employer has
executed a separate Corporate CLA with jPOS.org.</li><li class="listitem">You represent that each of Your Contributions is Your original
creation (see section 7 for submissions on behalf of others).  You
represent that Your Contribution submissions include complete
details of any third-party license or other restriction (including,
but not limited to, related patents and trademarks) of which you
are personally aware and which are associated with any part of Your
Contributions.</li><li class="listitem">You are not expected to provide support for Your Contributions,
except to the extent You desire to provide support. You may provide
support for free, for a fee, or not at all. Unless required by
applicable law or agreed to in writing, You provide Your
Contributions on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS
OF ANY KIND, either express or implied, including, without
limitation, any warranties or conditions of TITLE, NON-
INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE.</li><li class="listitem">Should You wish to submit work that is not Your original creation,
You may submit it to jPOS.org separately from any
Contribution, identifying the complete details of its source and of
any license or other restriction (including, but not limited to,
related patents, trademarks, and license agreements) of which you
are personally aware, and conspicuously marking the work as
"Submitted on behalf of a third-party: [named here]".</li><li class="listitem">You agree to notify jPOS.org of any facts or circumstances of
which you become aware that would make these representations
inaccurate in any respect.</li></ol></div><p>Date:</p><p>Please sign:</p><p>Name:</p><p>Title:</p></div></div><div class="appendix"><div class="titlepage"><div><div><h2 class="title"><a name="appendix_CCLA"></a>Appendix&nbsp;D.&nbsp;Corporate CLA</h2></div></div></div><div class="informalexample"><p>jPOS Project
Corporate Contributor License Agreement V1.0
based on <a class="link" href="http://www.apache.org/licenses/" target="_top">http://www.apache.org/licenses/</a></p><p>Thank you for your interest in the jPOS project by Alejandro P. Revilla
(Uruguayan company #212 752 380 016) conducting business as the jPOS Organization
(jPOS.org).</p><p>In order to clarify the intellectual property license granted with
Contributions from any person or entity, jPOS.org must have a Contributor
License Agreement ("CLA") that has been signed by each Contributor, indicating
agreement to the license terms below.</p><p>This license is for your protection as a
Contributor as well as the protection of jPOS.org and its users; it does not
change your rights to use your own Contributions for any other purpose.</p><p>If you have not already done so, please complete this agreement and
commit it to the jPOS repository at
<a class="link" href="https://github.com/jpos/jPOS" target="_top">https://github.com/jpos/jPOS</a> at legal/cla-USERNAME.txt using
your authenticated SourceForge login. If you do not have commit
privilege to the repository, please email the file to <a class="link" href="mailto:license@jpos.org" target="_top">license@jpos.org</a>.
If possible, digitally sign the committed file, otherwise also send a
signed Agreement to jPOS.org.</p><p>Please read this document carefully before signing and keep a copy for
your records.</p><div class="informaltable"><table style="border: none;"><colgroup><col class="col_1"><col class="col_2"></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Full Name</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>E-Mail</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>Mailing Address:</p></td><td style="" align="left" valign="top">&nbsp;</td></tr></tbody></table></div><p>You accept and agree to the following terms and conditions for Your
present and future Contributions submitted to jPOS.org. In return,
jPOS.org shall not use Your Contributions in a way that is
contrary to the software license in effect at the time of the
Contribution.  Except for the license granted herein to jPOS.org
and recipients of software distributed by jPOS.org, You reserve
all right, title, and interest in and to Your Contributions.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><span class="strong"><strong>Definitions.</strong></span> "You" (or "Your") shall mean the copyright owner
or legal entity authorized by the copyright owner that is making this
Agreement with jPOS.org. For legal entities, the entity making a
Contribution and all other entities that control, are controlled
by, or are under common control with that entity are considered to
be a single Contributor. For the purposes of this definition,
"control" means (i) the power, direct or indirect, to cause the
direction or management of such entity, whether by contract or
otherwise, or (ii) ownership of fifty percent (50%) or more of the
outstanding shares, or (iii) beneficial ownership of such entity.</li><li class="listitem">"Contribution" shall mean any original work of authorship,
including any modifications or additions to an existing work, that
is intentionally submitted by You to jPOS.org for inclusion
in, or documentation of, any of the products owned or managed by
jPOS.org (the "Work"). For the purposes of this definition,
"submitted" means any form of electronic, verbal, or written
communication sent to jPOS.org or its representatives,
including but not limited to communication on electronic mailing
lists, source code control systems, and issue tracking systems that
are managed by, or on behalf of, jPOS.org for the purpose of
discussing and improving the Work, but excluding communication that
is conspicuously marked or otherwise designated in writing by You
as "Not a Contribution.".</li><li class="listitem">Grant of Copyright License. Subject to the terms and conditions of
this Agreement, You hereby grant to jPOS.org and to
recipients of software distributed by jPOS.org a perpetual,
worldwide, non-exclusive, no-charge, royalty-free, irrevocable
copyright license to reproduce, prepare derivative works of,
publicly display, publicly perform, sublicense, and distribute Your
Contributions and any derived works.</li><li class="listitem">Grant of Patent License. Subject to the terms and conditions of this
Agreement, You hereby grant to jPOS.org and to the recipients of software
distributed by jPOS.org a perpetual, worldwide, non-exclusive, no-charge,
royalty-free, irrevocable (except as stated in this section) patent license to
make, have made, use, offer to sell, sell, import, and otherwise transfer the
Work, where such license applies only to those patent claims licensable by You
that are necessarily infringed by Your Contribution(s) alone or by combination
of Your Contribution(s) with the Work to which such Contribution(s) was
submitted. If any entity institutes patent litigation against You or any other
entity (including a cross-claim or counterclaim in a lawsuit) alleging that
your Contribution, or the Work to which you have contributed, constitutes
direct or contributory patent infringement, then any patent licenses granted to
that entity under this Agreement for that Contribution or Work shall terminate
as of the date such litigation is filed.</li><li class="listitem">You represent that you are legally entitled to grant the above license. If
your employer(s) has rights to intellectual property that you create that
includes your Contributions, you represent that you have received permission to
make Contributions on behalf of that employer, that your employer has waived
such rights for your Contributions to jPOS.org, or that your employer has
executed a separate Corporate CLA with jPOS.org.</li><li class="listitem">You represent that each of Your Contributions is Your original creation (see
section 7 for submissions on behalf of others). You represent that Your
Contribution submissions include complete details of any third-party license or
other restriction (including, but not limited to, related patents and
trademarks) of which you are personally aware and which are associated with any
part of Your Contributions.</li><li class="listitem">You are not expected to provide support for Your Contributions, except to
the extent You desire to provide support. You may provide support for free, for
a fee, or not at all. Unless required by applicable law or agreed to in
writing, You provide Your Contributions on an "AS IS" BASIS, WITHOUT WARRANTIES
OR CONDITIONS OF ANY KIND, either express or implied, including, without
limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT,
MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE.</li><li class="listitem">Should You wish to submit work that is not Your original creation, You may
submit it to jPOS.org separately from any Contribution, identifying the
complete details of its source and of any license or other restriction
(including, but not limited to, related patents, trademarks, and license
agreements) of which you are personally aware, and conspicuously marking the
work as "Submitted on behalf of a third-party: [named here]".</li><li class="listitem">You agree to notify jPOS.org of any facts or circumstances of which you
become aware that would make these representations inaccurate in any respect.</li></ol></div><p>Date:</p><p>Please sign:</p><p>Name:</p><p>Title:</p></div></div></div></div></body></html>